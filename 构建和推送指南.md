# ğŸ”¨ å‰ç«¯æ„å»ºå’Œæ¨é€æŒ‡å—

## âš ï¸ é‡è¦è¯´æ˜

æœ¬é¡¹ç›®çš„ Docker éƒ¨ç½²ä½¿ç”¨**ç®€åŒ–ç‰ˆ Dockerfile**ï¼Œç›´æ¥å¤åˆ¶æœ¬åœ°æ„å»ºçš„ `dist` ç›®å½•ï¼Œè€Œä¸æ˜¯åœ¨å®¹å™¨å†…æ„å»ºã€‚

### ä¸ºä»€ä¹ˆéœ€è¦æœ¬åœ°æ„å»ºï¼Ÿ

1. **Dockerfile é…ç½®**ï¼š`front/sheep-music/Dockerfile` ä½¿ç”¨ `COPY dist` ç›´æ¥å¤åˆ¶æ„å»ºäº§ç‰©
2. **Git é…ç½®**ï¼š`.gitignore` ä¸­ `dist` ç›®å½•**æ²¡æœ‰è¢«å¿½ç•¥**ï¼Œä¼šè¢«æäº¤åˆ° Git
3. **éƒ¨ç½²éœ€è¦**ï¼šæœåŠ¡å™¨ä¸Šçš„ Docker å®¹å™¨éœ€è¦è¿™äº›æ„å»ºå¥½çš„æ–‡ä»¶

### ä»€ä¹ˆæ—¶å€™éœ€è¦é‡æ–°æ„å»ºï¼Ÿ

âœ… **éœ€è¦æ„å»ºçš„æƒ…å†µï¼š**
- ä¿®æ”¹äº†ä»»ä½•å‰ç«¯æºä»£ç ï¼ˆ`.vue`ã€`.js`ã€`.css` ç­‰ï¼‰
- ä¿®æ”¹äº†å‰ç«¯é…ç½®æ–‡ä»¶ï¼ˆ`vite.config.js`ã€`.env.production` ç­‰ï¼‰
- æ›´æ–°äº†å‰ç«¯ä¾èµ–ï¼ˆ`package.json`ï¼‰
- é¦–æ¬¡éƒ¨ç½²é¡¹ç›®

âŒ **ä¸éœ€è¦æ„å»ºçš„æƒ…å†µï¼š**
- åªä¿®æ”¹äº†åç«¯ä»£ç 
- åªä¿®æ”¹äº†æ–‡æ¡£æ–‡ä»¶
- åªä¿®æ”¹äº†é…ç½®æ–‡ä»¶ï¼ˆå¦‚ `docker-compose.yml`ã€`.env`ï¼‰

---

## ğŸ”¨ æ„å»ºæ­¥éª¤

### åœ¨ Windows ç¯å¢ƒä¸‹

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨ PowerShell

```powershell
# è¿›å…¥å‰ç«¯ç›®å½•
cd d:\workspace\java-project\project1\sheep-music\front\sheep-music

# å®‰è£…ä¾èµ–ï¼ˆé¦–æ¬¡æˆ–ä¾èµ–æ›´æ–°æ—¶ï¼‰
npm install --legacy-peer-deps

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd ..\..
```

#### æ–¹å¼äºŒï¼šä½¿ç”¨ WSL

```bash
# è¿›å…¥ WSL
wsl

# å¯¼èˆªåˆ°å‰ç«¯ç›®å½•
cd /mnt/d/workspace/java-project/project1/sheep-music/front/sheep-music

# å®‰è£…ä¾èµ–ï¼ˆé¦–æ¬¡æˆ–ä¾èµ–æ›´æ–°æ—¶ï¼‰
npm install --legacy-peer-deps

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd ../..
```

---

## ğŸ“¤ å®Œæ•´çš„æ„å»ºå’Œæ¨é€æµç¨‹

### æ–¹å¼ä¸€ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# è¿›å…¥ WSL
wsl

# å¯¼èˆªåˆ°é¡¹ç›®æ ¹ç›®å½•
cd /mnt/d/workspace/java-project/project1/sheep-music

# è¿è¡Œæ¨é€è„šæœ¬ï¼ˆä¼šè¯¢é—®æ˜¯å¦éœ€è¦æ„å»ºï¼‰
chmod +x push-to-github.sh
bash push-to-github.sh "ä½ çš„æäº¤ä¿¡æ¯"
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. è¯¢é—®æ˜¯å¦éœ€è¦æ„å»ºå‰ç«¯
2. å¦‚æœé€‰æ‹© Yesï¼Œè‡ªåŠ¨æ„å»ºå‰ç«¯
3. æ·»åŠ æ‰€æœ‰æ›´æ”¹åˆ° Git
4. æäº¤å¹¶æ¨é€åˆ° GitHub

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨æ‰§è¡Œï¼ˆå®Œæ•´ç‰ˆï¼‰

```bash
# 1. è¿›å…¥ WSL
wsl

# 2. å¯¼èˆªåˆ°é¡¹ç›®
cd /mnt/d/workspace/java-project/project1/sheep-music

# 3. æ„å»ºå‰ç«¯
cd front/sheep-music
npm install --legacy-peer-deps  # é¦–æ¬¡æˆ–ä¾èµ–æ›´æ–°æ—¶
npm run build
cd ../..

# 4. æ£€æŸ¥æ„å»ºç»“æœ
ls -lh front/sheep-music/dist/

# 5. æ·»åŠ åˆ° Git
git add .

# 6. æäº¤
git commit -m "éƒ¨ç½²ç‰ˆæœ¬ - $(date '+%Y-%m-%d %H:%M:%S')"

# 7. æ¨é€
git push
```

### æ–¹å¼ä¸‰ï¼šå¿«é€Ÿå‘½ä»¤ï¼ˆä»…æ„å»ºå’Œæ¨é€ï¼‰

```bash
cd /mnt/d/workspace/java-project/project1/sheep-music && \
cd front/sheep-music && npm run build && cd ../.. && \
git add . && \
git commit -m "æ›´æ–° $(date '+%Y%m%d_%H%M%S')" && \
git push
```

---

## ğŸ” éªŒè¯æ„å»ºç»“æœ

### æ£€æŸ¥ dist ç›®å½•

```bash
# æŸ¥çœ‹ dist ç›®å½•å†…å®¹
ls -lh front/sheep-music/dist/

# åº”è¯¥åŒ…å«ï¼š
# - index.html
# - assets/ (åŒ…å« JSã€CSS æ–‡ä»¶)
# - favicon.ico
# - å…¶ä»–é™æ€èµ„æº
```

### æ£€æŸ¥æ„å»ºæ–‡ä»¶å¤§å°

```bash
# æŸ¥çœ‹ dist ç›®å½•å¤§å°
du -sh front/sheep-music/dist/

# æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥æœ‰å‡  MB
```

### æœ¬åœ°é¢„è§ˆæ„å»ºç»“æœ

```bash
cd front/sheep-music

# é¢„è§ˆæ„å»ºç»“æœ
npm run preview

# è®¿é—® http://localhost:4173
```

---

## ğŸ“ æ„å»ºé…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡æ–‡ä»¶

ç¡®ä¿ `front/sheep-music/.env.production` é…ç½®æ­£ç¡®ï¼š

```env
# ç”Ÿäº§ç¯å¢ƒ API åœ°å€
VITE_API_BASE_URL=http://ä½ çš„æœåŠ¡å™¨IP:8080

# æˆ–ä½¿ç”¨åŸŸå
# VITE_API_BASE_URL=https://api.yourdomain.com
```

### Vite é…ç½®

`front/sheep-music/vite.config.js` ä¸­çš„æ„å»ºé…ç½®ï¼š

```javascript
export default defineConfig({
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
    // ... å…¶ä»–é…ç½®
  }
})
```

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ„å»ºå¤±è´¥ï¼šä¾èµ–é—®é¢˜

```bash
# æ¸…ç†å¹¶é‡æ–°å®‰è£…ä¾èµ–
cd front/sheep-music
rm -rf node_modules package-lock.json
npm install --legacy-peer-deps
npm run build
```

### 2. æ„å»ºå¤±è´¥ï¼šå†…å­˜ä¸è¶³

```bash
# å¢åŠ  Node.js å†…å­˜é™åˆ¶
export NODE_OPTIONS="--max-old-space-size=4096"
npm run build
```

### 3. dist ç›®å½•ä¸ºç©ºæˆ–ç¼ºå°‘æ–‡ä»¶

```bash
# æ£€æŸ¥æ„å»ºæ—¥å¿—
npm run build 2>&1 | tee build.log

# æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯
cat build.log
```

### 4. æ¨é€æ—¶ dist ç›®å½•è¢«å¿½ç•¥

æ£€æŸ¥ `.gitignore` æ–‡ä»¶ï¼š

```bash
# ç¡®è®¤ dist ç›®å½•æ²¡æœ‰è¢«å¿½ç•¥
cat .gitignore | grep dist

# åº”è¯¥çœ‹åˆ°ï¼š
# # /front/sheep-music/dist/  ï¼ˆè¿™è¡Œè¢«æ³¨é‡Šäº†ï¼‰
```

### 5. æ„å»ºåæ–‡ä»¶è·¯å¾„é”™è¯¯

ç¡®ä¿ `vite.config.js` ä¸­çš„ `base` é…ç½®æ­£ç¡®ï¼š

```javascript
export default defineConfig({
  base: '/',  // éƒ¨ç½²åœ¨æ ¹è·¯å¾„
  // ...
})
```

---

## ğŸ“Š æ„å»ºä¼˜åŒ–å»ºè®®

### 1. å‡å°æ„å»ºä½“ç§¯

```bash
# åˆ†ææ„å»ºäº§ç‰©
npm run build -- --report

# æŸ¥çœ‹å„ä¸ªæ¨¡å—çš„å¤§å°
```

### 2. å¯ç”¨å‹ç¼©

ç¡®ä¿ `vite.config.js` ä¸­å¯ç”¨äº†å‹ç¼©ï¼š

```javascript
export default defineConfig({
  build: {
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,  // ç§»é™¤ console
      }
    }
  }
})
```

### 3. ä»£ç åˆ†å‰²

```javascript
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'element-plus': ['element-plus'],
          'vue': ['vue', 'vue-router', 'pinia']
        }
      }
    }
  }
})
```

---

## ğŸ”„ CI/CD è‡ªåŠ¨åŒ–ï¼ˆå¯é€‰ï¼‰

å¦‚æœæƒ³è¦è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²ï¼Œå¯ä»¥ä½¿ç”¨ GitHub Actionsï¼š

åˆ›å»º `.github/workflows/deploy.yml`ï¼š

```yaml
name: Build and Deploy

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: |
          cd front/sheep-music
          npm install --legacy-peer-deps
      
      - name: Build
        run: |
          cd front/sheep-music
          npm run build
      
      - name: Commit dist
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add front/sheep-music/dist
          git commit -m "Auto build" || echo "No changes"
          git push
```

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰ç¡®è®¤ï¼š

- [ ] å‰ç«¯ä»£ç å·²ä¿®æ”¹
- [ ] å·²è¿è¡Œ `npm run build`
- [ ] `dist` ç›®å½•å·²ç”Ÿæˆä¸”åŒ…å«æ–‡ä»¶
- [ ] `.env.production` é…ç½®æ­£ç¡®
- [ ] æ„å»ºæ— é”™è¯¯å’Œè­¦å‘Š
- [ ] å·²æ·»åŠ  `dist` åˆ° Git
- [ ] å·²æäº¤å¹¶æ¨é€åˆ° GitHub

---

## ğŸ¯ å¿«é€Ÿå‚è€ƒ

### ä»…æ„å»ºå‰ç«¯

```bash
cd /mnt/d/workspace/java-project/project1/sheep-music/front/sheep-music
npm run build
```

### æ„å»º + æ¨é€

```bash
cd /mnt/d/workspace/java-project/project1/sheep-music
cd front/sheep-music && npm run build && cd ../..
git add . && git commit -m "æ›´æ–°" && git push
```

### ä½¿ç”¨è„šæœ¬

```bash
cd /mnt/d/workspace/java-project/project1/sheep-music
bash push-to-github.sh
```

---

**è®°ä½ï¼šä¿®æ”¹å‰ç«¯ä»£ç åï¼Œå¿…é¡»é‡æ–°æ„å»º dist ç›®å½•ï¼** ğŸ”¨
