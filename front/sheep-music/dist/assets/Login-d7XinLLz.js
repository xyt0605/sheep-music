import{_ as x,c as F,o as b,a as l,d as r,w as u,r as i,f as k,e as p,t as V,g as B,h as _,i as G,j as I,E as v,u as L}from"./index-BnXTIBkP.js";import{G as R}from"./GalaxyFormInput-pRxaQ59S.js";import{G as U}from"./GalaxyButton-W9I68GNq.js";import{l as h}from"./user-B9_tstkr.js";const S={name:"Login",components:{GalaxyFormInput:R,GalaxyButton:U},setup(){const g=L(),e=B(),a=_(null),o=_(!1),s=G({username:"",password:""}),f={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度为3-20个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度为6-20个字符",trigger:"blur"}]};I(()=>{setTimeout(()=>{s.username="",s.password="",a.value&&a.value.clearValidate(),m()},100)});const m=()=>{document.querySelectorAll(".login-form input").forEach(t=>{t.removeAttribute("readonly")})};return{loginFormRef:a,loginForm:s,loginRules:f,loading:o,handleLogin:async()=>{a.value&&await a.value.validate(async n=>{if(n)try{o.value=!0;const t=await h({username:s.username,password:s.password});e.setToken(t.data.token),e.setUserInfo(t.data.userInfo),v.success("登录成功"),s.username="",s.password="",a.value&&a.value.clearValidate(),setTimeout(()=>{g.push("/home")},500)}catch(t){v.error(t.message||"登录失败")}finally{o.value=!1}})},handleUsernameFocus:n=>{n.target.removeAttribute("readonly")},handlePasswordFocus:n=>{n.target.removeAttribute("readonly")},noop:()=>{}}}},A={class:"login-container"},C={class:"login-box"},E={class:"register-link"};function T(g,e,a,o,s,f){const m=i("GalaxyFormInput"),d=i("el-form-item"),c=i("GalaxyButton"),y=i("router-link"),w=i("el-form");return b(),F("div",A,[l("div",C,[e[6]||(e[6]=l("h2",{class:"title"},"Sheep Music",-1)),e[7]||(e[7]=l("p",{class:"subtitle"},"欢迎回来，请登录",-1)),r(w,{ref:"loginFormRef",model:o.loginForm,rules:o.loginRules,class:"login-form",autocomplete:"off"},{default:u(()=>[e[4]||(e[4]=l("input",{type:"text",name:"fake-username",style:{display:"none"},autocomplete:"off"},null,-1)),e[5]||(e[5]=l("input",{type:"password",name:"fake-password",style:{display:"none"},autocomplete:"new-password"},null,-1)),r(d,{prop:"username"},{default:u(()=>[r(m,{modelValue:o.loginForm.username,"onUpdate:modelValue":e[0]||(e[0]=n=>o.loginForm.username=n),label:"用户名",name:"username",autocomplete:"off",onBlur:o.noop},null,8,["modelValue","onBlur"])]),_:1}),r(d,{prop:"password"},{default:u(()=>[r(m,{modelValue:o.loginForm.password,"onUpdate:modelValue":e[1]||(e[1]=n=>o.loginForm.password=n),type:"password",label:"密码",name:"password",autocomplete:"new-password",onBlur:o.noop,onKeyup:k(o.handleLogin,["enter"])},null,8,["modelValue","onBlur","onKeyup"])]),_:1}),r(d,null,{default:u(()=>[r(c,{loading:o.loading,size:"lg",variant:"primary",class:"login-button",onClick:o.handleLogin},{default:u(()=>[p(V(o.loading?"登录中...":"登录"),1)]),_:1},8,["loading","onClick"])]),_:1}),l("div",E,[e[3]||(e[3]=p(" 还没有账号？ ",-1)),r(y,{to:"/register"},{default:u(()=>[...e[2]||(e[2]=[p("立即注册",-1)])]),_:1})])]),_:1},8,["model","rules"])])])}const P=x(S,[["render",T],["__scopeId","data-v-f5fd25ac"]]);export{P as default};
