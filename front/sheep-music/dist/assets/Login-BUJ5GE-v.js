import{m as e,q as a,t as o,H as s,B as l,a8 as r,r as n,h as t,d as u,al as i,W as d,F as m}from"./vue-vendor-BzZaYQKc.js";import{_ as p,u as c}from"./index-Cb8xoRiw.js";import{l as g}from"./user-v6clTCfC.js";import{L as f,P as w}from"./element-plus-CCPVPfgN.js";import"./request-76E38DvM.js";const y={class:"login-container"},v={class:"login-box"},h={class:"register-link"};const F=p({name:"Login",setup(){const e=i(),a=c(),o=n(null),s=n(!1),l=t({username:"",password:""});u(()=>{setTimeout(()=>{l.username="",l.password="",o.value&&o.value.clearValidate(),r()},100)});const r=()=>{document.querySelectorAll(".login-form input").forEach(e=>{e.removeAttribute("readonly")})};return{loginFormRef:o,loginForm:l,loginRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度为3-20个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度为6-20个字符",trigger:"blur"}]},loading:s,handleLogin:async()=>{o.value&&await o.value.validate(async r=>{if(r)try{s.value=!0;const r=await g({username:l.username,password:l.password});a.setToken(r.data.token),a.setUserInfo(r.data.userInfo),f.success("登录成功"),l.username="",l.password="",o.value&&o.value.clearValidate(),setTimeout(()=>{e.push("/home")},500)}catch(n){f.error(n.message||"登录失败")}finally{s.value=!1}})},handleUsernameFocus:e=>{e.target.removeAttribute("readonly")},handlePasswordFocus:e=>{e.target.removeAttribute("readonly")}}}},[["render",function(n,t,u,i,p,c){const g=r("el-input"),f=r("el-form-item"),F=r("el-button"),b=r("router-link"),k=r("el-form");return a(),e("div",y,[o("div",v,[t[6]||(t[6]=o("h2",{class:"title"},"Sheep Music",-1)),t[7]||(t[7]=o("p",{class:"subtitle"},"欢迎回来，请登录",-1)),s(k,{ref:"loginFormRef",model:i.loginForm,rules:i.loginRules,class:"login-form",autocomplete:"off"},{default:l(()=>[t[4]||(t[4]=o("input",{type:"text",name:"fake-username",style:{display:"none"},autocomplete:"off"},null,-1)),t[5]||(t[5]=o("input",{type:"password",name:"fake-password",style:{display:"none"},autocomplete:"new-password"},null,-1)),s(f,{prop:"username"},{default:l(()=>[s(g,{modelValue:i.loginForm.username,"onUpdate:modelValue":t[0]||(t[0]=e=>i.loginForm.username=e),placeholder:"请输入用户名","prefix-icon":"User",size:"large",autocomplete:"off",name:"username",readonly:"",onFocus:i.handleUsernameFocus},null,8,["modelValue","onFocus"])]),_:1}),s(f,{prop:"password"},{default:l(()=>[s(g,{modelValue:i.loginForm.password,"onUpdate:modelValue":t[1]||(t[1]=e=>i.loginForm.password=e),type:"password",placeholder:"请输入密码","prefix-icon":"Lock",size:"large","show-password":"",autocomplete:"new-password",name:"password",readonly:"",onFocus:i.handlePasswordFocus,onKeyup:d(i.handleLogin,["enter"])},null,8,["modelValue","onFocus","onKeyup"])]),_:1}),s(f,null,{default:l(()=>[s(F,{type:"primary",size:"large",loading:i.loading,onClick:i.handleLogin,class:"login-button"},{default:l(()=>[m(w(i.loading?"登录中...":"登录"),1)]),_:1},8,["loading","onClick"])]),_:1}),o("div",h,[t[3]||(t[3]=m(" 还没有账号？ ",-1)),s(b,{to:"/register"},{default:l(()=>[...t[2]||(t[2]=[m("立即注册",-1)])]),_:1})])]),_:1},8,["model","rules"])])])}],["__scopeId","data-v-847f91fb"]]);export{F as default};
