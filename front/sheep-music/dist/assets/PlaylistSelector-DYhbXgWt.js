import{P as S,c as z,h as L,j as U}from"./PlaylistCover-8S-uaouD.js";import{_ as E,ac as M,S as q,a8 as A,g,l as I,q as B,o as c,w as s,E as u,r as n,a as _,d as o,c as p,e as k,I as T,J as j,K as J,z as K,t as N}from"./index-DUIxZ2bH.js";const G={name:"PlaylistSelector",components:{PlaylistCover:S,Plus:A,Loading:q,Check:M},props:{modelValue:Boolean,songId:{type:Number,default:null}},emits:["update:modelValue","success"],setup(f,{emit:e}){const m=g(!1),l=g(!1),h=g([]),P="https://via.placeholder.com/60?text=Playlist",v=g(!1),i=g({name:"",category:""});I(()=>f.modelValue,a=>{m.value=a,a&&d()}),I(m,a=>{e("update:modelValue",a)});const d=async()=>{l.value=!0;try{const a=await U();a.code===200&&(h.value=a.data||[])}catch(a){console.error("加载歌单失败:",a)}finally{l.value=!1}},C=async a=>{var y,r;if(!(a.disabled||!f.songId))try{(await L(a.id,f.songId)).code===200&&(u.success("已添加到歌单"),e("success"),m.value=!1)}catch(b){const V=((r=(y=b.response)==null?void 0:y.data)==null?void 0:r.message)||"添加失败";V.includes("已在歌单中")?(a.disabled=!0,u.info("该歌曲已在此歌单中")):u.error(V)}};return{visible:m,loading:l,playlists:h,defaultCover:P,createDialogVisible:v,createForm:i,loadPlaylists:d,selectPlaylist:C,showCreateDialog:()=>{i.value={name:"",category:""},v.value=!0},handleCreate:async()=>{if(!i.value.name.trim()){u.warning("请输入歌单名称");return}try{const a=await z({name:i.value.name,category:i.value.category,isPublic:!1});a.code===200&&(u.success("创建成功"),v.value=!1,await d(),f.songId&&a.data&&C(a.data))}catch{u.error("创建失败")}},handleClose:()=>{m.value=!1}}}},H={class:"playlist-selector"},O={class:"create-new"},Q={key:0,class:"loading"},R={key:1,class:"playlist-list"},W=["onClick"],X={class:"playlist-info"},Y={class:"playlist-name"},Z={class:"playlist-count"},$={key:2,class:"empty-state"};function ee(f,e,m,l,h,P){const v=n("Plus"),i=n("el-icon"),d=n("el-button"),C=n("Loading"),w=n("PlaylistCover"),x=n("Check"),D=n("el-empty"),a=n("el-input"),y=n("el-form-item"),r=n("el-option"),b=n("el-select"),V=n("el-form"),F=n("el-dialog");return c(),B(F,{modelValue:l.visible,"onUpdate:modelValue":e[4]||(e[4]=t=>l.visible=t),title:"添加到歌单",width:"500px",onClose:l.handleClose},{default:s(()=>[_("div",H,[_("div",O,[o(d,{type:"primary",size:"small",onClick:l.showCreateDialog},{default:s(()=>[o(i,null,{default:s(()=>[o(v)]),_:1}),e[5]||(e[5]=k(" 创建新歌单 ",-1))]),_:1},8,["onClick"])]),l.loading?(c(),p("div",Q,[o(i,{class:"is-loading"},{default:s(()=>[o(C)]),_:1}),e[6]||(e[6]=_("span",null,"加载中...",-1))])):l.playlists.length>0?(c(),p("div",R,[(c(!0),p(T,null,j(l.playlists,t=>(c(),p("div",{key:t.id,class:J(["playlist-item",{disabled:t.disabled}]),onClick:le=>l.selectPlaylist(t)},[o(w,{cover:t.cover,size:50,"default-cover":l.defaultCover,class:"playlist-cover"},null,8,["cover","default-cover"]),_("div",X,[_("div",Y,N(t.name),1),_("div",Z,N(t.songCount||0)+" 首歌曲",1)]),t.disabled?(c(),B(i,{key:0,class:"check-icon",color:"#67C23A"},{default:s(()=>[o(x)]),_:1})):K("",!0)],10,W))),128))])):(c(),p("div",$,[o(D,{description:"还没有歌单"},{default:s(()=>[o(d,{type:"primary",onClick:l.showCreateDialog},{default:s(()=>[...e[7]||(e[7]=[k("创建第一个歌单",-1)])]),_:1},8,["onClick"])]),_:1})]))]),o(F,{modelValue:l.createDialogVisible,"onUpdate:modelValue":e[3]||(e[3]=t=>l.createDialogVisible=t),title:"创建歌单",width:"400px","append-to-body":""},{footer:s(()=>[o(d,{onClick:e[2]||(e[2]=t=>l.createDialogVisible=!1)},{default:s(()=>[...e[8]||(e[8]=[k("取消",-1)])]),_:1}),o(d,{type:"primary",onClick:l.handleCreate},{default:s(()=>[...e[9]||(e[9]=[k("创建",-1)])]),_:1},8,["onClick"])]),default:s(()=>[o(V,{model:l.createForm,"label-width":"80px"},{default:s(()=>[o(y,{label:"歌单名称",required:""},{default:s(()=>[o(a,{modelValue:l.createForm.name,"onUpdate:modelValue":e[0]||(e[0]=t=>l.createForm.name=t),placeholder:"请输入歌单名称",maxlength:"50"},null,8,["modelValue"])]),_:1}),o(y,{label:"分类"},{default:s(()=>[o(b,{modelValue:l.createForm.category,"onUpdate:modelValue":e[1]||(e[1]=t=>l.createForm.category=t),placeholder:"选择分类"},{default:s(()=>[o(r,{label:"流行",value:"流行"}),o(r,{label:"摇滚",value:"摇滚"}),o(r,{label:"民谣",value:"民谣"}),o(r,{label:"电子",value:"电子"}),o(r,{label:"纯音乐",value:"纯音乐"}),o(r,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","onClose"])}const te=E(G,[["render",ee],["__scopeId","data-v-67efc172"]]);export{te as P};
