import{_ as G,g as B,k as L,l as J,i as K,m as W,v as O,n as t,o as i,c as m,a as n,d as s,t as _,w as l,r as p,T as Q,p as X,q as w,s as Y,x as Z,y as ee,z as g,A as te,B as se,C as oe,D as ne,F as ae,G as le,H as ie,I as D,J as U,K as q,L as re,e as S,M as ce,f as de,N as ue,E as j,u as me}from"./index-C5bpx5EP.js";import{u as _e}from"./player-BQpaZ7da.js";import"./song-BK1efH3L.js";import"./request-WXopXHOE.js";const pe={class:"music-player"},fe={class:"player-main"},ye={class:"player-left"},he=["src"],ve={class:"song-info"},ge={class:"song-name"},ke={class:"song-artist"},Ce={class:"player-center"},we={class:"player-controls"},Se={class:"player-progress"},xe={class:"time-text"},Me={class:"time-text"},Ve={class:"player-right"},be={class:"volume-control"},Ie={key:0,class:"lyric-panel"},Le={class:"lyric-header"},Pe={key:0,class:"no-lyric"},Te={class:"playlist-content"},$e=["onClick"],ze={class:"playlist-item-info"},Ne={class:"playlist-item-name"},Be={class:"playlist-item-artist"},Ae={key:0,class:"empty-playlist"},Ee="https://via.placeholder.com/60?text=Music",He={__name:"MusicPlayer",setup(x){const e=_e(),C=B(null),d=B(null),M=B(!1),v=L({get:()=>e.duration>0?e.currentTime/e.duration*100:0,set:a=>{const o=a/100*e.duration;e.seek(o)}}),P=B(e.volume*100),A=a=>{const o=a/100*e.duration;e.seek(o)},V=a=>{e.setVolume(a/100)},T=a=>{if(!a||isNaN(a))return"00:00";const o=Math.floor(a/60),c=Math.floor(a%60);return`${o.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`},$=a=>a?a.artists&&a.artists.length>0?a.artists.map(o=>o.name).join(" / "):a.artistName?a.artistName:"未知歌手":"未知歌手",E=L(()=>({list:"列表循环",random:"随机播放",single:"单曲循环"})[e.playMode]||"列表循环"),b=L(()=>{var f;const a=(f=e.currentSong)==null?void 0:f.lyric;if(!a)return[];const o=a.split(`
`),c=[];return o.forEach(h=>{const y=h.match(/\[(\d{2}):(\d{2})\.?(\d{2,3})?\](.*)/);if(y){const H=parseInt(y[1]),z=parseInt(y[2]),N=y[3]?parseInt(y[3].padEnd(3,"0")):0,r=H*60+z+N/1e3,k=y[4].trim();k&&c.push({time:r,text:k})}else h.trim()&&!h.startsWith("[")&&c.push({time:0,text:h.trim()})}),c.sort((h,y)=>h.time-y.time)}),u=L(()=>{const a=e.currentTime;for(let o=b.value.length-1;o>=0;o--)if(a>=b.value[o].time)return o;return-1});J(u,async a=>{if(a>=0&&d.value){await ce();const o=d.value.querySelector(".lyric-line.active");o&&o.scrollIntoView({behavior:"smooth",block:"center"})}});const I=()=>{e.toggleLyric()};return K(()=>{C.value&&e.initAudio(C.value)}),(a,o)=>{var z,N;const c=p("el-icon"),f=p("el-button"),h=p("el-slider"),y=p("el-tooltip"),H=p("el-dialog");return W((i(),m("div",pe,[n("audio",{ref_key:"audioRef",ref:C},null,512),n("div",fe,[n("div",ye,[n("img",{src:((z=t(e).currentSong)==null?void 0:z.cover)||Ee,alt:"封面",class:"song-cover",onClick:I},null,8,he),n("div",ve,[n("div",ge,_(((N=t(e).currentSong)==null?void 0:N.title)||"暂无播放"),1),n("div",ke,_($(t(e).currentSong)),1)])]),n("div",Ce,[n("div",we,[s(f,{circle:"",size:"small",disabled:!t(e).hasPrevSong,onClick:t(e).prev},{default:l(()=>[s(c,null,{default:l(()=>[s(t(X))]),_:1})]),_:1},8,["disabled","onClick"]),s(f,{circle:"",type:"primary",size:"large",onClick:t(e).togglePlay,disabled:!t(e).currentSong},{default:l(()=>[t(e).isPlaying?(i(),w(c,{key:0},{default:l(()=>[s(t(Y))]),_:1})):(i(),w(c,{key:1},{default:l(()=>[s(t(Z))]),_:1}))]),_:1},8,["onClick","disabled"]),s(f,{circle:"",size:"small",disabled:!t(e).hasNextSong,onClick:t(e).next},{default:l(()=>[s(c,null,{default:l(()=>[s(t(ee))]),_:1})]),_:1},8,["disabled","onClick"])]),n("div",Se,[n("span",xe,_(T(t(e).currentTime)),1),s(h,{modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=r=>v.value=r),"show-tooltip":!1,onChange:A,class:"progress-slider"},null,8,["modelValue"]),n("span",Me,_(T(t(e).duration)),1)])]),n("div",Ve,[s(y,{content:E.value,placement:"top"},{default:l(()=>[s(f,{circle:"",size:"small",onClick:t(e).togglePlayMode},{default:l(()=>[s(c,null,{default:l(()=>[t(e).playMode==="list"?(i(),w(t(te),{key:0})):g("",!0),t(e).playMode==="random"?(i(),w(t(se),{key:1})):g("",!0),t(e).playMode==="single"?(i(),w(t(oe),{key:2})):g("",!0)]),_:1})]),_:1},8,["onClick"])]),_:1},8,["content"]),s(f,{circle:"",size:"small",type:t(e).showLyric?"primary":"",onClick:I},{default:l(()=>[s(c,null,{default:l(()=>[s(t(ne))]),_:1})]),_:1},8,["type"]),n("div",be,[s(c,null,{default:l(()=>[s(t(ae))]),_:1}),s(h,{modelValue:P.value,"onUpdate:modelValue":o[1]||(o[1]=r=>P.value=r),"show-tooltip":!1,onInput:V,style:{width:"100px","margin-left":"10px"}},null,8,["modelValue"])]),s(f,{circle:"",size:"small",onClick:o[2]||(o[2]=r=>M.value=!0)},{default:l(()=>[s(c,null,{default:l(()=>[s(t(le))]),_:1})]),_:1})])]),s(Q,{name:"lyric-slide"},{default:l(()=>{var r,k;return[t(e).showLyric?(i(),m("div",Ie,[n("div",Le,[n("h3",null,_((r=t(e).currentSong)==null?void 0:r.title),1),s(f,{circle:"",size:"small",onClick:t(e).toggleLyric},{default:l(()=>[s(c,null,{default:l(()=>[s(t(ie))]),_:1})]),_:1},8,["onClick"])]),n("div",{class:"lyric-content",ref_key:"lyricContentRef",ref:d},[(i(!0),m(D,null,U(b.value,(R,F)=>(i(),m("div",{key:F,class:q(["lyric-line",{active:F===u.value}])},_(R.text),3))),128)),(k=t(e).currentSong)!=null&&k.lyric?g("",!0):(i(),m("div",Pe," 暂无歌词 "))],512)])):g("",!0)]}),_:1}),s(H,{modelValue:M.value,"onUpdate:modelValue":o[3]||(o[3]=r=>M.value=r),title:"播放列表",width:"500px"},{default:l(()=>[n("div",Te,[(i(!0),m(D,null,U(t(e).playlist,(r,k)=>(i(),m("div",{key:r.id,class:q(["playlist-item",{active:k===t(e).currentIndex}]),onClick:R=>t(e).play(r)},[n("div",ze,[n("span",Ne,_(r.title),1),n("span",Be,_($(r)),1)]),s(f,{link:"",type:"danger",size:"small",onClick:re(R=>t(e).removeFromPlaylist(r.id),["stop"])},{default:l(()=>[...o[4]||(o[4]=[S(" 删除 ",-1)])]),_:1},8,["onClick"])],10,$e))),128)),t(e).playlist.length===0?(i(),m("div",Ae," 播放列表为空 ")):g("",!0)])]),_:1},8,["modelValue"])],512)),[[O,t(e).showPlayer]])}}},Re=G(He,[["__scopeId","data-v-c14f3cfc"]]),De={name:"Layout",components:{MusicPlayer:Re},setup(){const x=me(),e=de(),C=L(()=>{const v=[{name:"首页",path:"/home",icon:"🏠"},{name:"发现",path:"/discover",icon:"✨"},{name:"搜索",path:"/search",icon:"🔍"},{name:"歌单广场",path:"/playlist",icon:"📃"},{name:"排行榜",path:"/rank",icon:"📊"},{name:"我的音乐",path:"/my-music"}];return e.isAdmin&&v.push({name:"管理后台",path:"/admin",icon:"🔧"}),v});return{userStore:e,menuItems:C,goHome:()=>{x.push("/home")},handleCommand:async v=>{switch(v){case"profile":x.push("/profile");break;case"settings":j.info("设置功能待开发");break;case"logout":ue.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{e.logout(),j.success("已退出登录"),x.push("/login")}).catch(()=>{});break}}}}},Ue={class:"app-layout"},Fe={class:"app-header"},qe={class:"header-content"},je={class:"nav-menu"},Ge={key:0,class:"menu-icon"},Je={class:"user-section"},Ke={class:"user-info"},We={class:"username"},Oe={key:0,class:"admin-badge"},Qe={class:"app-main"};function Xe(x,e,C,d,M,v){const P=p("router-link"),A=p("el-avatar"),V=p("el-dropdown-item"),T=p("el-dropdown-menu"),$=p("el-dropdown"),E=p("router-view"),b=p("MusicPlayer");return i(),m("div",Ue,[n("header",Fe,[n("div",qe,[n("div",{class:"logo",onClick:e[0]||(e[0]=(...u)=>d.goHome&&d.goHome(...u))},[...e[1]||(e[1]=[n("span",{class:"logo-icon"},"🎵",-1),n("span",{class:"logo-text"},"Sheep Music",-1)])]),n("nav",je,[(i(!0),m(D,null,U(d.menuItems,u=>(i(),w(P,{key:u.path,to:u.path,class:"nav-item","active-class":"active"},{default:l(()=>[u.icon?(i(),m("span",Ge,_(u.icon),1)):g("",!0),S(" "+_(u.name),1)]),_:2},1032,["to"]))),128))]),n("div",Je,[s($,{onCommand:d.handleCommand},{dropdown:l(()=>[s(T,null,{default:l(()=>[s(V,{command:"profile"},{default:l(()=>[...e[2]||(e[2]=[S("个人中心",-1)])]),_:1}),s(V,{command:"settings"},{default:l(()=>[...e[3]||(e[3]=[S("设置",-1)])]),_:1}),s(V,{divided:"",command:"logout"},{default:l(()=>[...e[4]||(e[4]=[S("退出登录",-1)])]),_:1})]),_:1})]),default:l(()=>{var u,I;return[n("div",Ke,[s(A,{src:(u=d.userStore.userInfo)==null?void 0:u.avatar,size:"default"},{default:l(()=>{var a,o;return[S(_((o=(a=d.userStore.userInfo)==null?void 0:a.nickname)==null?void 0:o.charAt(0)),1)]}),_:1},8,["src"]),n("span",We,_((I=d.userStore.userInfo)==null?void 0:I.nickname),1),d.userStore.isAdmin?(i(),m("span",Oe,"管理员")):g("",!0)])]}),_:1},8,["onCommand"])])])]),n("main",Qe,[s(E)]),s(b)])}const st=G(De,[["render",Xe],["__scopeId","data-v-7a736215"]]);export{st as default};
