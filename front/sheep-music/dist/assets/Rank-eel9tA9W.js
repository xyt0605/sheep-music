import{m as a,q as e,t,H as l,A as s,D as o,B as n,a8 as i,G as r,Y as c,r as d,h as g,c as u,e as p,d as v,am as m,al as h,L as y}from"./vue-vendor-BzZaYQKc.js";import{u as k}from"./player-BodKjA0D.js";import{_ as f,u as C}from"./index-Cb8xoRiw.js";import{g as S,a as b}from"./song-C8TMBuSO.js";import{t as T,b as P}from"./favorite-CBOsHs95.js";import{a5 as w,Y as z,a4 as j,P as A,L as V,o as F}from"./element-plus-CCPVPfgN.js";import{P as L}from"./PlaylistSelector-BQ_G-bWe.js";import"./request-76E38DvM.js";import"./PlaylistCover-D3NetioR.js";const _={class:"rank-page"},x={class:"page-header"},D={class:"subtitle"},$={key:0,class:"loading-state"},q={key:1,class:"song-list"},R=["onClick"],H=["src"],I={class:"song-info"},U={class:"song-name"},M={class:"song-artist"},Y=["onClick"],B={key:0},E={key:0},G={class:"song-stats"},J={key:0,class:"stat-item"},K={class:"stat-item"},N={class:"song-actions"},O={key:2,class:"empty-state"};const Q=f({name:"Rank",components:{Loading:j,Headset:z,Clock:w,PlaylistSelector:L},setup(){const a=m(),e=h(),t=k(),l=C(),s=d("hot"),o=d(!1),n=d([]),i=d({}),r=g({page:1,size:50,total:0}),c=d(!1),y=d(null),f=u(()=>"hot"===s.value?"🔥 热门歌曲排行榜":"🎵 新歌速递排行榜"),w=u(()=>"hot"===s.value?"最受欢迎的热门歌曲":"最新发布的音乐作品"),z=async()=>{o.value=!0;try{const a={page:r.page-1,size:r.size},e="hot"===s.value?await S(a):await b(a);200===e.code&&(n.value=e.data.content||[],r.total=e.data.totalElements||0,await j())}catch(a){console.error("加载排行榜失败:",a),V.error("加载排行榜失败")}finally{o.value=!1}},j=async()=>{if(l.isLogin&&0!==n.value.length)try{const a=n.value.map(a=>a.id),e=await P(a);200===e.code&&(i.value=e.data||{})}catch(a){console.error("加载收藏状态失败:",a)}};return p(()=>a.query.type,a=>{"hot"!==a&&"new"!==a||(s.value=a,r.page=1,z())},{immediate:!0}),v(()=>{a.query.type||z()}),{activeTab:s,loading:o,songs:n,defaultCover:"https://via.placeholder.com/60?text=Music",favoriteSongs:i,pagination:r,pageTitle:f,pageSubtitle:w,playlistSelectorVisible:c,selectedSongId:y,handleTabChange:()=>{r.page=1,z()},handlePlaySong:a=>{t.play(a,n.value)},handleAddToPlaylist:a=>{t.addToPlaylist(a),V.success(`已添加到播放列表: ${a.title}`)},handleToggleFavorite:async a=>{if(!l.isLogin)return V.warning("请先登录"),void e.push("/login");try{const e=await T(a);200===e.code&&(i.value[a]=e.data.isFavorite,V.success(e.data.isFavorite?"收藏成功":"取消收藏成功"))}catch(t){V.error("操作失败")}},goToArtist:a=>{a&&e.push(`/artist/${a}`)},showAddToPlaylistDialog:a=>{if(!l.isLogin)return V.warning("请先登录"),void e.push("/login");y.value=a,c.value=!0},handleAddSuccess:()=>{},getRankClass:a=>0===a?"rank-first":1===a?"rank-second":2===a?"rank-third":"",formatCount:a=>a?a>=1e4?(a/1e4).toFixed(1)+"万":a:0,formatDuration:a=>{if(!a)return"--:--";return`${Math.floor(a/60)}:${(a%60).toString().padStart(2,"0")}`},loadSongs:z}}},[["render",function(d,g,u,p,v,m){const h=i("el-tab-pane"),k=i("el-tabs"),f=i("Loading"),C=i("el-icon"),S=i("Headset"),b=i("Clock"),T=i("el-button"),P=i("el-empty"),w=i("el-pagination"),z=i("PlaylistSelector");return e(),a("div",_,[t("div",x,[t("h2",null,"📊 "+A(p.pageTitle),1),t("p",D,A(p.pageSubtitle),1)]),l(k,{modelValue:p.activeTab,"onUpdate:modelValue":g[0]||(g[0]=a=>p.activeTab=a),class:"rank-tabs",onTabChange:p.handleTabChange},{default:n(()=>[l(h,{label:"🔥 热门歌曲",name:"hot"}),l(h,{label:"🎵 新歌速递",name:"new"})]),_:1},8,["modelValue","onTabChange"]),p.loading?(e(),a("div",$,[l(C,{class:"is-loading"},{default:n(()=>[l(f)]),_:1}),g[3]||(g[3]=t("p",null,"加载中...",-1))])):p.songs.length>0?(e(),a("div",q,[(e(!0),a(r,null,c(p.songs,(s,i)=>(e(),a("div",{key:s.id,class:F(["song-item",{"top-item":i<3}]),onClick:a=>p.handlePlaySong(s)},[t("div",{class:F(["song-rank",p.getRankClass(i)])},A(i+1),3),t("img",{src:s.cover||p.defaultCover,class:"song-cover"},null,8,H),t("div",I,[t("div",U,A(s.title),1),t("div",M,[(e(!0),a(r,null,c(s.artists||[],(l,n)=>{var i;return e(),a(r,{key:l.id},[t("span",{class:"clickable",onClick:y(a=>p.goToArtist(l.id),["stop"])},A(l.name),9,Y),n<((null==(i=s.artists)?void 0:i.length)||0)-1?(e(),a("span",B," / ")):o("",!0)],64)}),128)),s.artists&&0!==s.artists.length?o("",!0):(e(),a("span",E,"未知歌手"))])]),t("div",G,["hot"===p.activeTab?(e(),a("div",J,[l(C,null,{default:n(()=>[l(S)]),_:1}),t("span",null,A(p.formatCount(s.playCount)),1)])):o("",!0),t("div",K,[l(C,null,{default:n(()=>[l(b)]),_:1}),t("span",null,A(p.formatDuration(s.duration)),1)])]),t("div",N,[l(T,{icon:"CaretRight",circle:"",size:"small",onClick:y(a=>p.handlePlaySong(s),["stop"]),title:"播放"},null,8,["onClick"]),l(T,{icon:"Plus",circle:"",size:"small",onClick:y(a=>p.handleAddToPlaylist(s),["stop"]),title:"添加到播放列表"},null,8,["onClick"]),l(T,{icon:"FolderAdd",circle:"",size:"small",onClick:y(a=>p.showAddToPlaylistDialog(s.id),["stop"]),title:"添加到歌单"},null,8,["onClick"]),l(T,{icon:p.favoriteSongs[s.id]?"StarFilled":"Star",circle:"",size:"small",type:p.favoriteSongs[s.id]?"danger":"",onClick:y(a=>p.handleToggleFavorite(s.id),["stop"]),title:"收藏"},null,8,["icon","type","onClick"])])],10,R))),128))])):(e(),a("div",O,[l(P,{description:`暂无${"hot"===p.activeTab?"热门":"最新"}歌曲`},null,8,["description"])])),p.pagination.total>p.pagination.size?(e(),s(w,{key:3,"current-page":p.pagination.page,"onUpdate:currentPage":g[1]||(g[1]=a=>p.pagination.page=a),"page-size":p.pagination.size,total:p.pagination.total,layout:"prev, pager, next, total",class:"pagination",onCurrentChange:p.loadSongs},null,8,["current-page","page-size","total","onCurrentChange"])):o("",!0),l(z,{modelValue:p.playlistSelectorVisible,"onUpdate:modelValue":g[2]||(g[2]=a=>p.playlistSelectorVisible=a),"song-id":p.selectedSongId,onSuccess:p.handleAddSuccess},null,8,["modelValue","song-id","onSuccess"])])}],["__scopeId","data-v-a80b3b04"]]);export{Q as default};
