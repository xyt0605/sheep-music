import{_ as q,a4 as G,a8 as J,a6 as Q,A as W,R as j,F as K,G as X,Q as Y,S as Z,c as d,o as r,d as l,a as e,w as c,r as u,z as S,q as P,t as y,e as g,I as U,J as O,f as $,g as z,k as ss,i as ts,u as os,W as es,E as v,N as ls,L as H}from"./index-LKNASSCX.js";import{u as ns}from"./player-Bmv1q0yE.js";import{P as as,e as is,i as rs,r as cs,f as ds}from"./PlaylistCover-BqxCqI1K.js";import{P as us}from"./PlaylistSelector-DeJAY7A3.js";import"./song-FYgzkVSR.js";import"./request-BJQTzVY9.js";const ys={name:"PlaylistDetail",components:{PlaylistCover:as,PlaylistSelector:us,Loading:Z,User:Y,List:X,Headset:K,CaretRight:j,Refresh:W,Edit:Q,Plus:J,Delete:G},setup(){const k=os(),o=es(),w=ns(),s=$(),b=z(!1),h=z(null),m=z([]),f="https://via.placeholder.com/200?text=Music",T=z(!1),C=z(null),E=ss(()=>h.value&&s.userInfo&&h.value.userId===s.userInfo.id),L=async()=>{b.value=!0;try{const t=o.params.id,n=await is(t);n.code===200&&(h.value=n.data,await B(t),rs(t).catch(()=>{}))}catch(t){console.error("加载歌单失败:",t),v.error("加载歌单失败")}finally{b.value=!1}},B=async t=>{try{const n=await ds(t,{page:0,size:500});n.code===200&&(m.value=n.data.content||[])}catch(n){console.error("加载歌曲列表失败:",n)}},I=(t=!1)=>{if(m.value.length===0){v.warning("歌单没有歌曲");return}const n=m.value.map(i=>i.song).filter(i=>i);if(t){const i=[...n].sort(()=>Math.random()-.5);w.play(i[0],i)}else w.play(n[0],n);v.success(t?"开始随机播放":"开始播放全部")},_=(t,n)=>{if(!t)return;const i=m.value.map(p=>p.song).filter(p=>p);w.play(t,i)},M=t=>{t&&(w.addToPlaylist(t),v.success(`已添加到播放列表: ${t.title}`))},N=async t=>{try{await ls.confirm("确定要从歌单中移除这首歌吗？","确认移除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await cs(h.value.id,t)).code===200&&(v.success("移除成功"),await L())}catch(n){n!=="cancel"&&v.error("移除失败")}},A=()=>{k.push("/my-music?tab=playlists")},F=t=>{t&&k.push(`/artist/${t}`)},R=t=>{if(!t)return"--:--";const n=Math.floor(t/60),i=t%60;return`${n}:${i.toString().padStart(2,"0")}`},a=t=>t?new Date(t).toLocaleDateString("zh-CN"):"",D=t=>t?t>=1e4?(t/1e4).toFixed(1)+"万":t:0,V=t=>{if(t){if(!s.isLogin){v.warning("请先登录"),k.push("/login");return}C.value=t,T.value=!0}},x=()=>{};return ts(()=>{L()}),{loading:b,playlist:h,songs:m,defaultCover:f,isOwner:E,playAll:I,playSong:_,addToPlaylist:M,removeSong:N,goToEdit:A,goToArtist:F,formatDuration:R,formatDate:a,formatCount:D,router:k,playlistSelectorVisible:T,selectedSongId:C,showAddToPlaylistDialog:V,handleAddSuccess:x}}},_s={class:"playlist-detail"},gs={key:0,class:"loading-container"},fs={key:1,class:"detail-container"},ps={class:"playlist-header"},ms={class:"cover-section"},vs={class:"info-section"},ks={class:"playlist-tag"},hs={class:"playlist-name"},Cs={class:"creator-info"},Ss={key:0,class:"playlist-description"},Ps={class:"playlist-stats"},ws={class:"stat-item"},Ds={class:"stat-item"},zs={class:"action-buttons"},bs={class:"songs-section"},Ts={class:"section-header"},Ls={class:"song-count"},As={key:0,class:"song-list"},Rs=["onClick"],Vs={class:"song-index"},xs=["src"],Es={class:"song-info"},Bs={class:"song-name"},Is={class:"song-artist"},Ms=["onClick"],Ns={key:0},Fs={key:1},Us={class:"song-duration"},Os={key:1,class:"empty-state"},Hs={key:2,class:"error-state"};function qs(k,o,w,s,b,h){var R;const m=u("Loading"),f=u("el-icon"),T=u("PlaylistCover"),C=u("el-tag"),E=u("User"),L=u("List"),B=u("Headset"),I=u("CaretRight"),_=u("el-button"),M=u("Refresh"),N=u("Edit"),A=u("el-empty"),F=u("PlaylistSelector");return r(),d("div",_s,[s.loading?(r(),d("div",gs,[l(f,{class:"is-loading"},{default:c(()=>[l(m)]),_:1}),o[5]||(o[5]=e("p",null,"加载中...",-1))])):s.playlist?(r(),d("div",fs,[e("div",ps,[e("div",ms,[l(T,{cover:s.playlist.cover,size:250,"default-cover":s.defaultCover,class:"playlist-cover"},null,8,["cover","default-cover"])]),e("div",vs,[e("div",ks,[s.playlist.category?(r(),P(C,{key:0,type:"primary",size:"small"},{default:c(()=>[g(y(s.playlist.category),1)]),_:1})):S("",!0),s.playlist.isPublic?(r(),P(C,{key:1,type:"success",size:"small"},{default:c(()=>[...o[6]||(o[6]=[g("公开",-1)])]),_:1})):(r(),P(C,{key:2,type:"info",size:"small"},{default:c(()=>[...o[7]||(o[7]=[g("私有",-1)])]),_:1}))]),e("h1",hs,y(s.playlist.name),1),e("div",Cs,[l(f,null,{default:c(()=>[l(E)]),_:1}),e("span",null,"创建者："+y(((R=s.playlist.creator)==null?void 0:R.nickname)||"未知"),1),o[8]||(o[8]=e("span",{class:"separator"},"|",-1)),e("span",null,y(s.formatDate(s.playlist.createTime)),1)]),s.playlist.description?(r(),d("p",Ss,y(s.playlist.description),1)):S("",!0),e("div",Ps,[e("span",ws,[l(f,null,{default:c(()=>[l(L)]),_:1}),g(" "+y(s.playlist.songCount||0)+" 首歌曲 ",1)]),e("span",Ds,[l(f,null,{default:c(()=>[l(B)]),_:1}),g(" 播放 "+y(s.formatCount(s.playlist.playCount))+" 次 ",1)])]),e("div",zs,[l(_,{type:"primary",size:"large",onClick:s.playAll},{default:c(()=>[l(f,null,{default:c(()=>[l(I)]),_:1}),o[9]||(o[9]=g(" 播放全部 ",-1))]),_:1},8,["onClick"]),l(_,{size:"large",onClick:o[0]||(o[0]=a=>s.playAll(!0))},{default:c(()=>[l(f,null,{default:c(()=>[l(M)]),_:1}),o[10]||(o[10]=g(" 随机播放 ",-1))]),_:1}),s.isOwner?(r(),P(_,{key:0,size:"large",onClick:s.goToEdit},{default:c(()=>[l(f,null,{default:c(()=>[l(N)]),_:1}),o[11]||(o[11]=g(" 编辑 ",-1))]),_:1},8,["onClick"])):S("",!0)])])]),e("div",bs,[e("div",Ts,[o[12]||(o[12]=e("h3",null,"歌曲列表",-1)),e("span",Ls,"共 "+y(s.songs.length)+" 首",1)]),s.songs.length>0?(r(),d("div",As,[(r(!0),d(U,null,O(s.songs,(a,D)=>{var V,x,t,n;return r(),d("div",{key:a.id,class:"song-item",onClick:i=>s.playSong(a.song,D)},[e("div",Vs,y(D+1),1),e("img",{src:((V=a.song)==null?void 0:V.cover)||s.defaultCover,class:"song-cover"},null,8,xs),e("div",Es,[e("div",Bs,y(((x=a.song)==null?void 0:x.title)||"未知歌曲"),1),e("div",Is,[(t=a.song)!=null&&t.artists&&a.song.artists.length>0?(r(!0),d(U,{key:0},O(a.song.artists,(i,p)=>(r(),d("span",{key:i.id},[e("span",{class:"clickable",onClick:H(Gs=>s.goToArtist(i.id),["stop"])},y(i.name),9,Ms),p<a.song.artists.length-1?(r(),d("span",Ns," / ")):S("",!0)]))),128)):(r(),d("span",Fs,"未知歌手"))])]),e("div",Us,y(s.formatDuration((n=a.song)==null?void 0:n.duration)),1),e("div",{class:"song-actions",onClick:o[1]||(o[1]=H(()=>{},["stop"]))},[l(_,{icon:"CaretRight",circle:"",size:"small",onClick:i=>s.playSong(a.song,D),title:"播放"},null,8,["onClick"]),l(_,{icon:"Plus",circle:"",size:"small",onClick:i=>s.addToPlaylist(a.song),title:"添加到播放列表"},null,8,["onClick"]),l(_,{icon:"FolderAdd",circle:"",size:"small",onClick:i=>{var p;return s.showAddToPlaylistDialog((p=a.song)==null?void 0:p.id)},title:"添加到其他歌单"},null,8,["onClick"]),s.isOwner?(r(),P(_,{key:0,icon:"Delete",circle:"",size:"small",onClick:i=>s.removeSong(a.songId),title:"从歌单移除"},null,8,["onClick"])):S("",!0)])],8,Rs)}),128))])):(r(),d("div",Os,[l(A,{description:"歌单还没有歌曲"},{default:c(()=>[s.isOwner?(r(),P(_,{key:0,type:"primary",onClick:o[2]||(o[2]=a=>s.router.push("/"))},{default:c(()=>[...o[13]||(o[13]=[g("去首页添加歌曲",-1)])]),_:1})):S("",!0)]),_:1})]))])])):(r(),d("div",Hs,[l(A,{description:"歌单不存在或已被删除"},{default:c(()=>[l(_,{type:"primary",onClick:o[3]||(o[3]=a=>k.$router.back())},{default:c(()=>[...o[14]||(o[14]=[g("返回",-1)])]),_:1})]),_:1})])),l(F,{modelValue:s.playlistSelectorVisible,"onUpdate:modelValue":o[4]||(o[4]=a=>s.playlistSelectorVisible=a),"song-id":s.selectedSongId,onSuccess:s.handleAddSuccess},null,8,["modelValue","song-id","onSuccess"])])}const Ys=q(ys,[["render",qs],["__scopeId","data-v-bb9b777c"]]);export{Ys as default};
