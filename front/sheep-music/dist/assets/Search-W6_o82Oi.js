import{a8 as F,_ as we,q as Ce,g as Se,h as n,v as He,j as Te,x as $e,c as r,o as l,a,k as y,d as o,r as H,w as i,m as g,a3 as ze,f as Ve,a9 as Le,F as T,D as b,a0 as Ae,e as Pe,Z as be,z as Q,t as f,a7 as Fe,T as W,a2 as Me,u as xe,n as De,aa as Ee,ab as Re,H as $,Y as Ue,E as d,ac as Be}from"./index-CEcgZmW7.js";import{g as Ke}from"./artist-gtceIKmx.js";import{t as Ne,b as qe}from"./favorite-DftkDNKP.js";import{P as je}from"./PlaylistSelector-DSSPFk9Y.js";import"./playlist-DGjpedJ1.js";import"./PlaylistCover-Cv9naroc.js";const Ie=(w=10)=>F({url:"/api/user/search-history/hot",method:"get",params:{limit:w}}),Oe=()=>F({url:"/api/user/search-history",method:"get"}),Ye=w=>F({url:"/api/user/search-history",method:"post",data:{keyword:w}}),Ze=w=>F({url:`/api/user/search-history/${w}`,method:"delete"}),Ge=()=>F({url:"/api/user/search-history/clear",method:"delete"}),Je={class:"search-page"},Qe={class:"search-header"},We={class:"search-container"},Xe={key:0,class:"initial-state"},es={class:"hot-search-section"},ss={class:"section-header"},ts={class:"hot-search-list"},as=["onClick"],os={class:"hot-keyword"},ls={key:0,class:"search-history-section"},rs={class:"section-header"},ns={class:"history-list"},cs=["onClick"],is={class:"history-keyword"},us={key:1,class:"loading-state"},ds={key:0,class:"search-results"},vs={key:0,class:"songs-container"},hs={class:"result-header"},_s={class:"song-list"},ps=["onClick"],ys={class:"song-index"},gs=["src"],ms={class:"song-info"},fs=["innerHTML"],ks={class:"song-artist"},ws=["onClick","innerHTML"],Cs={key:0},Ss={key:0},Hs={class:"song-duration"},Ts={class:"song-actions"},$s={key:1,class:"empty-state"},zs={key:0,class:"search-results"},Vs={key:0,class:"artists-container"},Ls={class:"result-header"},As={class:"artist-grid"},Ps=["onClick"],bs={class:"artist-avatar-wrapper"},Fs=["src"],Ms={class:"artist-overlay"},xs={class:"artist-info"},Ds=["innerHTML"],Es={class:"artist-region"},Rs={key:1,class:"empty-state"},Us="/default-cover.svg",Bs="/default-artist.svg",Ks={__name:"Search",setup(w){const D=xe(),q=Ce(),E=Se(),c=n(""),v=n("songs"),z=n(!1),V=n(!1),C=n(1),M=n(20),X=[{label:"ðŸŽµ å•æ›²",value:"songs"},{label:"ðŸ‘¤ æ­Œæ‰‹",value:"artists"}],m=n([]),L=n(0),A=n([]),R=n(0),j=n([]),U=n([]),k=n([]),x=n({}),B=n(!1),I=n(null);let K=null;const ee=He(()=>v.value==="songs"?"æœç´¢æ­Œæ›²åç§°":"æœç´¢æ­Œæ‰‹åç§°");Te(()=>{se(),O(),le()});const se=async()=>{try{const e=await Ie(10);e.code===200&&(U.value=e.data||[])}catch(e){console.error("åŠ è½½çƒ­é—¨æœç´¢å¤±è´¥:",e),U.value=["å‘¨æ°ä¼¦","ä¸ƒé‡Œé¦™","æž—ä¿Šæ°","è–›ä¹‹è°¦","æ¼”å‘˜"]}},O=async()=>{try{const e=await Oe();e.code===200&&(k.value=e.data||[])}catch(e){console.error("åŠ è½½æœç´¢åŽ†å²å¤±è´¥:",e),k.value=[]}},te=async e=>{if(e.trim())try{await Ye(e),await O()}catch(s){console.error("ä¿å­˜æœç´¢åŽ†å²å¤±è´¥:",s)}},ae=async()=>{try{const e=await Ge();e.code===200?(k.value=[],d.success("å·²æ¸…ç©ºæœç´¢åŽ†å²")):d.error(e.message||"æ¸…ç©ºå¤±è´¥")}catch(e){console.error("æ¸…ç©ºæœç´¢åŽ†å²å¤±è´¥:",e),d.error("æ¸…ç©ºå¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}},oe=async e=>{try{const s=await Ze(e);s.code===200?(k.value=k.value.filter(u=>u.id!==e),d.success("å·²åˆ é™¤")):d.error(s.message||"åˆ é™¤å¤±è´¥")}catch(s){console.error("åˆ é™¤æœç´¢åŽ†å²å¤±è´¥:",s),d.error("åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}},le=async()=>{try{const e=await Ke({page:0,size:100});e.code===200&&(j.value=e.data.content||[])}catch(e){console.error("åŠ è½½æ­Œæ‰‹åˆ—è¡¨å¤±è´¥:",e)}};$e(v,()=>{c.value.trim()&&V.value&&(C.value=1,S())});const S=async()=>{if(!c.value.trim()){m.value=[],A.value=[],V.value=!1;return}z.value=!0,V.value=!0,te(c.value.trim());try{v.value==="songs"?await re():await ie()}catch(e){console.error("æœç´¢å¤±è´¥:",e),d.error("æœç´¢å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}finally{z.value=!1}},re=async()=>{try{const e=await Be({keyword:c.value.trim(),page:C.value-1,size:M.value});e.code===200&&(m.value=e.data.content||[],L.value=e.data.totalElements||0,await ne())}catch(e){throw console.error("æœç´¢æ­Œæ›²å¤±è´¥:",e),e}},ne=async()=>{if(!(!E.isLogin||m.value.length===0))try{const e=m.value.map(u=>u.id),s=await qe(e);s.code===200&&(x.value=s.data||{})}catch(e){console.error("åŠ è½½æ”¶è—çŠ¶æ€å¤±è´¥:",e)}},ce=async e=>{if(!E.isLogin){d.warning("è¯·å…ˆç™»å½•"),D.push("/login");return}try{const s=await Ne(e);if(s.code===200){const u=s.data.isFavorite;x.value[e]=u,d.success(u?"æ”¶è—æˆåŠŸ":"å–æ¶ˆæ”¶è—æˆåŠŸ")}else d.error(s.message||"æ“ä½œå¤±è´¥")}catch(s){console.error("æ”¶è—æ“ä½œå¤±è´¥:",s),d.error("æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}},ie=async()=>{try{const e=c.value.trim().toLowerCase(),s=j.value.filter(u=>u.name.toLowerCase().includes(e)||u.region&&u.region.toLowerCase().includes(e));A.value=s,R.value=s.length}catch(e){throw console.error("æœç´¢æ­Œæ‰‹å¤±è´¥:",e),e}},ue=()=>{if(!c.value.trim()){m.value=[],A.value=[],V.value=!1,L.value=0,R.value=0;return}K&&clearTimeout(K),K=setTimeout(()=>{C.value=1,S()},500)},de=e=>{c.value=e,v.value="songs",S()},ve=e=>{c.value=e,v.value="songs",S()},Y=e=>{q.play(e,m.value)},he=e=>{q.addToPlaylist(e),d.success(`å·²æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨: ${e.title}`)},_e=e=>{if(!e)return"--:--";const s=Math.floor(e/60),u=e%60;return`${s}:${u.toString().padStart(2,"0")}`},N=e=>{if(!c.value||!e)return e;const s=new RegExp(`(${c.value})`,"gi");return e.replace(s,'<span class="highlight">$1</span>')},pe=()=>{S(),window.scrollTo({top:0,behavior:"smooth"})},Z=e=>{e&&D.push(`/artist/${e}`)},ye=e=>{if(!E.isLogin){d.warning("è¯·å…ˆç™»å½•"),D.push("/login");return}I.value=e,B.value=!0},ge=()=>{};return(e,s)=>{const u=H("el-segmented"),h=H("el-icon"),me=H("el-input"),P=H("el-button"),fe=H("el-pagination"),G=H("el-empty");return l(),r("div",Je,[a("div",Qe,[a("div",We,[o(u,{modelValue:v.value,"onUpdate:modelValue":s[0]||(s[0]=t=>v.value=t),options:X,size:"large",class:"search-type-selector"},null,8,["modelValue"]),o(me,{modelValue:c.value,"onUpdate:modelValue":s[1]||(s[1]=t=>c.value=t),placeholder:ee.value,clearable:"",size:"large",class:"search-input",onInput:ue,onKeyup:Ve(S,["enter"])},{prefix:i(()=>[o(h,null,{default:i(()=>[o(g(ze))]),_:1})]),_:1},8,["modelValue","placeholder"])])]),!c.value&&!V.value?(l(),r("div",Xe,[a("div",es,[a("div",ss,[o(h,{class:"header-icon"},{default:i(()=>[o(g(Le))]),_:1}),s[4]||(s[4]=a("h3",null,"çƒ­é—¨æœç´¢",-1))]),a("div",ts,[(l(!0),r(T,null,b(U.value,(t,_)=>(l(),r("div",{key:_,class:"hot-search-item",onClick:p=>de(t)},[a("span",{class:De(["hot-rank",{"top-three":_<3}])},f(_+1),3),a("span",os,f(t),1),_<3?(l(),Q(h,{key:0,class:"hot-icon"},{default:i(()=>[o(g(Ee))]),_:1})):y("",!0)],8,as))),128))])]),k.value.length>0?(l(),r("div",ls,[a("div",rs,[o(h,{class:"header-icon"},{default:i(()=>[o(g(Ae))]),_:1}),s[6]||(s[6]=a("h3",null,"æœç´¢åŽ†å²",-1)),o(P,{text:"",type:"danger",size:"small",onClick:ae},{default:i(()=>[...s[5]||(s[5]=[Pe(" æ¸…ç©ºåŽ†å² ",-1)])]),_:1})]),a("div",ns,[(l(!0),r(T,null,b(k.value,t=>(l(),r("div",{key:t.id,class:"history-item",onClick:_=>ve(t.keyword)},[a("span",is,f(t.keyword),1),o(h,{class:"delete-icon",onClick:$(_=>oe(t.id),["stop"])},{default:i(()=>[o(g(Re))]),_:1},8,["onClick"])],8,cs))),128))])])):y("",!0)])):y("",!0),z.value?(l(),r("div",us,[o(h,{class:"is-loading"},{default:i(()=>[o(g(be))]),_:1}),s[7]||(s[7]=a("p",null,"æœç´¢ä¸­...",-1))])):y("",!0),o(W,{name:"fade"},{default:i(()=>[!z.value&&c.value&&v.value==="songs"?(l(),r("div",ds,[m.value.length>0?(l(),r("div",vs,[a("div",hs,[a("h3",null,"æ‰¾åˆ° "+f(L.value)+" é¦–æ­Œæ›²",1)]),a("div",_s,[(l(!0),r(T,null,b(m.value,(t,_)=>(l(),r("div",{key:t.id,class:"song-item",onClick:p=>Y(t)},[a("div",ys,f((C.value-1)*M.value+_+1),1),a("img",{src:t.cover||Us,class:"song-cover"},null,8,gs),a("div",ms,[a("div",{class:"song-name",innerHTML:N(t.title)},null,8,fs),a("div",ks,[(l(!0),r(T,null,b(t.artists||[],(p,ke)=>{var J;return l(),r(T,{key:p.id},[a("span",{class:"clickable",onClick:$(Ns=>Z(p.id),["stop"]),innerHTML:N(p.name)},null,8,ws),ke<(((J=t.artists)==null?void 0:J.length)||0)-1?(l(),r("span",Cs," / ")):y("",!0)],64)}),128)),!t.artists||t.artists.length===0?(l(),r("span",Ss,"æœªçŸ¥æ­Œæ‰‹")):y("",!0)])]),a("div",Hs,f(_e(t.duration)),1),a("div",Ts,[o(P,{icon:"CaretRight",circle:"",size:"small",onClick:$(p=>Y(t),["stop"]),title:"æ’­æ”¾"},null,8,["onClick"]),o(P,{icon:"Plus",circle:"",size:"small",onClick:$(p=>he(t),["stop"]),title:"æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨"},null,8,["onClick"]),o(P,{icon:"FolderAdd",circle:"",size:"small",onClick:$(p=>ye(t.id),["stop"]),title:"æ·»åŠ åˆ°æ­Œå•"},null,8,["onClick"]),o(P,{icon:x.value[t.id]?"StarFilled":"Star",circle:"",size:"small",type:x.value[t.id]?"danger":"",onClick:$(p=>ce(t.id),["stop"]),title:"æ”¶è—"},null,8,["icon","type","onClick"])])],8,ps))),128))]),L.value>M.value?(l(),Q(fe,{key:0,"current-page":C.value,"onUpdate:currentPage":s[2]||(s[2]=t=>C.value=t),"page-size":M.value,total:L.value,layout:"prev, pager, next",class:"pagination",onCurrentChange:pe},null,8,["current-page","page-size","total"])):y("",!0)])):(l(),r("div",$s,[o(G,{description:"æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ­Œæ›²"},{image:i(()=>[o(h,{class:"empty-icon"},{default:i(()=>[o(g(Fe))]),_:1})]),_:1})]))])):y("",!0)]),_:1}),o(W,{name:"fade"},{default:i(()=>[!z.value&&c.value&&v.value==="artists"?(l(),r("div",zs,[A.value.length>0?(l(),r("div",Vs,[a("div",Ls,[a("h3",null,"æ‰¾åˆ° "+f(R.value)+" ä½æ­Œæ‰‹",1)]),a("div",As,[(l(!0),r(T,null,b(A.value,t=>(l(),r("div",{key:t.id,class:"artist-card",onClick:_=>Z(t.id)},[a("div",bs,[a("img",{src:t.avatar||Bs,class:"artist-avatar"},null,8,Fs),a("div",Ms,[o(h,{class:"play-icon"},{default:i(()=>[o(g(Ue))]),_:1})])]),a("div",xs,[a("div",{class:"artist-name",innerHTML:N(t.name)},null,8,Ds),a("div",Es,f(t.region||"æœªçŸ¥åœ°åŒº"),1)])],8,Ps))),128))])])):(l(),r("div",Rs,[o(G,{description:"æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ­Œæ‰‹"},{image:i(()=>[o(h,{class:"empty-icon"},{default:i(()=>[o(g(Me))]),_:1})]),_:1})]))])):y("",!0)]),_:1}),o(je,{modelValue:B.value,"onUpdate:modelValue":s[3]||(s[3]=t=>B.value=t),"song-id":I.value,onSuccess:ge},null,8,["modelValue","song-id"])])}}},Gs=we(Ks,[["__scopeId","data-v-40fc487e"]]);export{Gs as default};
