import{_ as se,aq as te,ai as le,ad as oe,ah as ne,af as ae,ar as ie,Y as re,R as ce,W as de,X as ue,Z as ge,as as me,at as _e,c as u,o as i,d as n,a as l,w as c,r as d,k as P,z,e as p,t as m,F as J,D as K,q as fe,g as ye,h as D,v as $,x as ve,j as he,u as pe,a1 as ke,E as v,O as Ce,H as ee}from"./index-nrl4pEAu.js";import{e as Se,i as Pe,r as De,f as be}from"./playlist-DxnxwXFm.js";import{P as we}from"./PlaylistCover-CcsQgdqR.js";import{P as Ve}from"./PlaylistSelector-9XXFHm3Q.js";const ze={name:"PlaylistDetail",components:{PlaylistCover:we,PlaylistSelector:Ve,CommentList:_e,ShareDialog:me,Loading:ge,User:ue,List:de,Headset:ce,CaretRight:re,Refresh:ie,Edit:ae,Plus:ne,Delete:oe,Star:le,Share:te},setup(){const b=pe(),t=ke(),x=fe(),e=ye(),U=D(!1),h=D(null),k=D([]),C="/default-cover.svg",M=D(!1),A=D(null),R=D(!1),E=D("playlist"),I=D({}),_=D(null),f=$(()=>{if(!_.value)return null;const s=k.value.find(a=>{var r;return((r=a.song)==null?void 0:r.id)===_.value});return(s==null?void 0:s.song)||null}),H=$(()=>h.value&&e.userInfo&&h.value.userId===e.userInfo.id),O=async()=>{U.value=!0;try{const s=t.params.id,a=await Se(s);a.code===200&&(h.value=a.data,await j(s),Pe(s).catch(()=>{}))}catch(s){console.error("加载歌单失败:",s),v.error("加载歌单失败")}finally{U.value=!1}},j=async s=>{var a;try{const r=await be(s,{page:0,size:500});if(r.code===200&&(k.value=r.data.content||[],!_.value)){const g=k.value.find(y=>{var Q;return(Q=y.song)==null?void 0:Q.id});_.value=((a=g==null?void 0:g.song)==null?void 0:a.id)||null}}catch(r){console.error("加载歌曲列表失败:",r)}},F=(s=!1)=>{var r,g;if(k.value.length===0){v.warning("歌单没有歌曲");return}const a=k.value.map(y=>y.song).filter(y=>y);if(a.length===0){v.warning("歌单没有可播放的歌曲");return}if(s){const y=[...a].sort(()=>Math.random()-.5);x.play(y[0],y),_.value=((r=y[0])==null?void 0:r.id)||null}else x.play(a[0],a),_.value=((g=a[0])==null?void 0:g.id)||null;v.success(s?"开始随机播放":"开始播放全部")},q=(s,a)=>{if(!s)return;const r=k.value.map(g=>g.song).filter(g=>g);x.play(s,r),s.id&&(_.value=s.id)},W=s=>{s&&(x.addToPlaylist(s),v.success(`已添加到播放列表: ${s.title}`))},X=async s=>{try{await Ce.confirm("确定要从歌单中移除这首歌吗？","确认移除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await De(h.value.id,s)).code===200&&(v.success("移除成功"),await O())}catch(a){a!=="cancel"&&v.error("移除失败")}},Y=()=>{b.push("/my-music?tab=playlists")},Z=s=>{s&&b.push(`/artist/${s}`)},N=s=>{if(!s)return"--:--";const a=Math.floor(s/60),r=s%60;return`${a}:${r.toString().padStart(2,"0")}`},o=s=>s?new Date(s).toLocaleDateString("zh-CN"):"",w=s=>s?s>=1e4?(s/1e4).toFixed(1)+"万":s:0,V=(s=[])=>!s||s.length===0?"未知歌手":s.map(a=>a.name).join(" / "),L=s=>{if(s){if(!e.isLogin){v.warning("请先登录"),b.push("/login");return}A.value=s,M.value=!0}},T=()=>{};return ve(k,s=>{var a;if(!s||s.length===0){_.value=null;return}if(!s.some(r=>{var g;return((g=r.song)==null?void 0:g.id)===_.value})){const r=s.find(g=>{var y;return(y=g.song)==null?void 0:y.id});_.value=((a=r==null?void 0:r.song)==null?void 0:a.id)||null}}),he(()=>{O()}),{loading:U,playlist:h,songs:k,defaultCover:C,isOwner:H,playAll:F,playSong:q,addToPlaylist:W,removeSong:X,goToEdit:Y,goToArtist:Z,formatDuration:N,formatDate:o,formatCount:w,formatArtists:V,router:b,playlistSelectorVisible:M,selectedSongId:A,showAddToPlaylistDialog:L,handleAddSuccess:T,commentSongId:_,commentSong:f,shareDialogVisible:R,shareType:E,shareData:I,sharePlaylistClick:()=>{if(!e.isLogin){v.warning("请先登录"),b.push("/login");return}h.value&&(E.value="playlist",I.value={id:h.value.id,name:h.value.name,cover:h.value.cover,subtitle:`${h.value.songCount||0} 首歌曲`},R.value=!0)},shareSongClick:s=>{if(!e.isLogin){v.warning("请先登录"),b.push("/login");return}if(!s||!s.id){v.error("歌曲信息无效");return}E.value="song",I.value={id:s.id,name:s.title||s.name,cover:s.cover,subtitle:V(s.artists)},R.value=!0},handleShareSuccess:()=>{v.success("分享成功，已发布到分享广场")}}}},Le={class:"playlist-detail"},Te={key:0,class:"loading-container"},Ae={key:1,class:"detail-container"},xe={class:"playlist-header"},Re={class:"cover-section"},Ee={class:"info-section"},Ie={class:"playlist-tag"},Be={class:"playlist-name"},Ue={class:"creator-info"},Me={key:0,class:"playlist-description"},Oe={class:"playlist-stats"},Fe={class:"stat-item"},Ne={class:"stat-item"},He={class:"action-buttons"},je={class:"songs-section"},qe={class:"section-header"},We={class:"song-count"},Xe={key:0,class:"song-list"},Ye=["onClick"],Ze={class:"song-index"},Ge=["src"],Je={class:"song-info"},Ke={class:"song-name"},Qe={class:"song-artist"},$e=["onClick"],es={key:0},ss={key:1},ts={class:"song-duration"},ls={key:1,class:"empty-state"},os={key:0,class:"comments-section"},ns={class:"section-header comment-header"},as={key:0},is={class:"comment-song-info"},rs=["src"],cs={class:"comment-song-text"},ds={key:2,class:"error-state"};function us(b,t,x,e,U,h){var N;const k=d("Loading"),C=d("el-icon"),M=d("PlaylistCover"),A=d("el-tag"),R=d("User"),E=d("List"),I=d("Headset"),_=d("CaretRight"),f=d("el-button"),H=d("Refresh"),O=d("Edit"),j=d("Share"),F=d("el-empty"),q=d("el-option"),W=d("el-select"),X=d("CommentList"),Y=d("PlaylistSelector"),Z=d("ShareDialog");return i(),u("div",Le,[e.loading?(i(),u("div",Te,[n(C,{class:"is-loading"},{default:c(()=>[n(k)]),_:1}),t[7]||(t[7]=l("p",null,"加载中...",-1))])):e.playlist?(i(),u("div",Ae,[l("div",xe,[l("div",Re,[n(M,{cover:e.playlist.cover,size:250,"default-cover":e.defaultCover,class:"playlist-cover"},null,8,["cover","default-cover"])]),l("div",Ee,[l("div",Ie,[e.playlist.category?(i(),z(A,{key:0,type:"primary",size:"small"},{default:c(()=>[p(m(e.playlist.category),1)]),_:1})):P("",!0),e.playlist.isPublic?(i(),z(A,{key:1,type:"success",size:"small"},{default:c(()=>[...t[8]||(t[8]=[p("公开",-1)])]),_:1})):(i(),z(A,{key:2,type:"info",size:"small"},{default:c(()=>[...t[9]||(t[9]=[p("私有",-1)])]),_:1}))]),l("h1",Be,m(e.playlist.name),1),l("div",Ue,[n(C,null,{default:c(()=>[n(R)]),_:1}),l("span",null,"创建者："+m(((N=e.playlist.creator)==null?void 0:N.nickname)||"未知"),1),t[10]||(t[10]=l("span",{class:"separator"},"|",-1)),l("span",null,m(e.formatDate(e.playlist.createTime)),1)]),e.playlist.description?(i(),u("p",Me,m(e.playlist.description),1)):P("",!0),l("div",Oe,[l("span",Fe,[n(C,null,{default:c(()=>[n(E)]),_:1}),p(" "+m(e.playlist.songCount||0)+" 首歌曲 ",1)]),l("span",Ne,[n(C,null,{default:c(()=>[n(I)]),_:1}),p(" 播放 "+m(e.formatCount(e.playlist.playCount))+" 次 ",1)])]),l("div",He,[n(f,{type:"primary",size:"large",onClick:e.playAll},{default:c(()=>[n(C,null,{default:c(()=>[n(_)]),_:1}),t[11]||(t[11]=p(" 播放全部 ",-1))]),_:1},8,["onClick"]),n(f,{size:"large",onClick:t[0]||(t[0]=o=>e.playAll(!0))},{default:c(()=>[n(C,null,{default:c(()=>[n(H)]),_:1}),t[12]||(t[12]=p(" 随机播放 ",-1))]),_:1}),e.isOwner?(i(),z(f,{key:0,size:"large",onClick:e.goToEdit},{default:c(()=>[n(C,null,{default:c(()=>[n(O)]),_:1}),t[13]||(t[13]=p(" 编辑 ",-1))]),_:1},8,["onClick"])):P("",!0),e.isOwner?(i(),z(f,{key:1,size:"large",type:"primary",plain:"",onClick:e.sharePlaylistClick},{default:c(()=>[n(C,null,{default:c(()=>[n(j)]),_:1}),t[14]||(t[14]=p(" 分享到广场 ",-1))]),_:1},8,["onClick"])):P("",!0)])])]),l("div",je,[l("div",qe,[t[15]||(t[15]=l("h3",null,"歌曲列表",-1)),l("span",We,"共 "+m(e.songs.length)+" 首",1)]),e.songs.length>0?(i(),u("div",Xe,[(i(!0),u(J,null,K(e.songs,(o,w)=>{var V,L,T,G;return i(),u("div",{key:o.id,class:"song-item",onClick:S=>e.playSong(o.song,w)},[l("div",Ze,m(w+1),1),l("img",{src:((V=o.song)==null?void 0:V.cover)||e.defaultCover,class:"song-cover"},null,8,Ge),l("div",Je,[l("div",Ke,m(((L=o.song)==null?void 0:L.title)||"未知歌曲"),1),l("div",Qe,[(T=o.song)!=null&&T.artists&&o.song.artists.length>0?(i(!0),u(J,{key:0},K(o.song.artists,(S,B)=>(i(),u("span",{key:S.id},[l("span",{class:"clickable",onClick:ee(s=>e.goToArtist(S.id),["stop"])},m(S.name),9,$e),B<o.song.artists.length-1?(i(),u("span",es," / ")):P("",!0)]))),128)):(i(),u("span",ss,"未知歌手"))])]),l("div",ts,m(e.formatDuration((G=o.song)==null?void 0:G.duration)),1),l("div",{class:"song-actions",onClick:t[1]||(t[1]=ee(()=>{},["stop"]))},[n(f,{icon:"CaretRight",circle:"",size:"small",onClick:S=>e.playSong(o.song,w),title:"播放"},null,8,["onClick"]),n(f,{icon:"Plus",circle:"",size:"small",onClick:S=>e.addToPlaylist(o.song),title:"添加到播放列表"},null,8,["onClick"]),n(f,{icon:"FolderAdd",circle:"",size:"small",onClick:S=>{var B;return e.showAddToPlaylistDialog((B=o.song)==null?void 0:B.id)},title:"添加到其他歌单"},null,8,["onClick"]),n(f,{icon:"Share",circle:"",size:"small",onClick:S=>e.shareSongClick(o.song),title:"分享歌曲"},null,8,["onClick"]),e.isOwner?(i(),z(f,{key:0,icon:"Delete",circle:"",size:"small",onClick:S=>e.removeSong(o.songId),title:"从歌单移除"},null,8,["onClick"])):P("",!0)])],8,Ye)}),128))])):(i(),u("div",ls,[n(F,{description:"歌单还没有歌曲"},{default:c(()=>[e.isOwner?(i(),z(f,{key:0,type:"primary",onClick:t[2]||(t[2]=o=>e.router.push("/"))},{default:c(()=>[...t[16]||(t[16]=[p("去首页添加歌曲",-1)])]),_:1})):P("",!0)]),_:1})]))]),e.songs.length>0?(i(),u("div",os,[l("div",ns,[t[17]||(t[17]=l("div",{class:"comment-title"},[l("h3",null,"评论区"),l("p",{class:"comment-subtitle"},"请选择歌曲查看评论并参与讨论")],-1)),n(W,{modelValue:e.commentSongId,"onUpdate:modelValue":t[3]||(t[3]=o=>e.commentSongId=o),placeholder:"选择评论的歌曲",size:"small",class:"comment-selector",filterable:"",teleported:!1},{default:c(()=>[(i(!0),u(J,null,K(e.songs,o=>{var w,V,L,T;return i(),z(q,{key:(w=o.song)==null?void 0:w.id,label:((V=o.song)==null?void 0:V.title)||"未知歌曲",value:(L=o.song)==null?void 0:L.id,disabled:!((T=o.song)!=null&&T.id)},null,8,["label","value","disabled"])}),128))]),_:1},8,["modelValue"])]),e.commentSong?(i(),u("div",as,[l("div",is,[l("img",{src:e.commentSong.cover||e.defaultCover,class:"comment-song-cover"},null,8,rs),l("div",cs,[l("h4",null,m(e.commentSong.title),1),l("p",null,m(e.formatArtists(e.commentSong.artists)),1)])]),n(X,{"song-id":e.commentSong.id,"show-rating":!0},null,8,["song-id"])])):P("",!0)])):P("",!0)])):(i(),u("div",ds,[n(F,{description:"歌单不存在或已被删除"},{default:c(()=>[n(f,{type:"primary",onClick:t[4]||(t[4]=o=>b.$router.back())},{default:c(()=>[...t[18]||(t[18]=[p("返回",-1)])]),_:1})]),_:1})])),n(Y,{modelValue:e.playlistSelectorVisible,"onUpdate:modelValue":t[5]||(t[5]=o=>e.playlistSelectorVisible=o),"song-id":e.selectedSongId,onSuccess:e.handleAddSuccess},null,8,["modelValue","song-id","onSuccess"]),n(Z,{modelValue:e.shareDialogVisible,"onUpdate:modelValue":t[6]||(t[6]=o=>e.shareDialogVisible=o),type:e.shareType,"share-data":e.shareData,onSuccess:e.handleShareSuccess},null,8,["modelValue","type","share-data","onSuccess"])])}const ys=se(ze,[["render",us],["__scopeId","data-v-dfb2d9e8"]]);export{ys as default};
