import{_ as K,c as l,o,F as f,D as P,d as a,r as h,b as se,a as s,n as Y,P as oe,Q as ne,R as le,k as S,H as y,t as C,w as p,e as U,g as ie,q as ae,h as b,v as J,j as re,x as O,S as ce,U as de,E as F,u as ue,z as X}from"./index-Beme91KK.js";import{b as ve,t as me}from"./favorite-CHHGmpDI.js";import{P as _e}from"./PlaylistSelector-JxXz7Ku-.js";import{G as he}from"./GalaxyButton-C500AY3T.js";import"./playlist-Klzj7SBW.js";import"./PlaylistCover-BRG8nYFY.js";const ge={class:"skeleton-loader"},ke={key:0,class:"skeleton-song-list"},ye={key:1,class:"skeleton-song-grid"},fe={key:2,class:"skeleton-artist-grid"},Se={key:3,class:"skeleton-default"},pe={__name:"SkeletonLoader",props:{type:{type:String,default:"default"},rows:{type:Number,default:5}},setup(d){return(n,m)=>{const e=h("el-skeleton");return o(),l("div",ge,[d.type==="song-list"?(o(),l("div",ke,[(o(!0),l(f,null,P(d.rows,g=>(o(),l("div",{key:g,class:"skeleton-song-item"},[...m[0]||(m[0]=[se('<div class="skeleton-index shimmer" data-v-d37660d9></div><div class="skeleton-cover shimmer" data-v-d37660d9></div><div class="skeleton-info" data-v-d37660d9><div class="skeleton-title shimmer" data-v-d37660d9></div><div class="skeleton-artist shimmer" data-v-d37660d9></div></div><div class="skeleton-stats shimmer" data-v-d37660d9></div><div class="skeleton-actions" data-v-d37660d9><div class="skeleton-btn shimmer" data-v-d37660d9></div><div class="skeleton-btn shimmer" data-v-d37660d9></div><div class="skeleton-btn shimmer" data-v-d37660d9></div></div>',5)])]))),128))])):d.type==="song-grid"?(o(),l("div",ye,[(o(!0),l(f,null,P(d.rows,g=>(o(),l("div",{key:g,class:"skeleton-card"},[...m[1]||(m[1]=[s("div",{class:"skeleton-card-cover shimmer"},null,-1),s("div",{class:"skeleton-card-title shimmer"},null,-1),s("div",{class:"skeleton-card-artist shimmer"},null,-1)])]))),128))])):d.type==="artist-grid"?(o(),l("div",fe,[(o(!0),l(f,null,P(d.rows,g=>(o(),l("div",{key:g,class:"skeleton-artist-card"},[...m[2]||(m[2]=[s("div",{class:"skeleton-artist-avatar shimmer"},null,-1),s("div",{class:"skeleton-artist-name shimmer"},null,-1),s("div",{class:"skeleton-artist-stats shimmer"},null,-1)])]))),128))])):(o(),l("div",Se,[a(e,{rows:d.rows,animated:""},null,8,["rows"])]))])}}},we=K(pe,[["__scopeId","data-v-d37660d9"]]),Ce={__name:"GalaxyLoader",props:{size:{type:String,default:"md"}},setup(d){return(n,m)=>(o(),l("div",{class:Y(["galaxy-loader",d.size])},[...m[0]||(m[0]=[s("div",{class:"ring"},null,-1),s("div",{class:"core"},null,-1)])],2))}},be=K(Ce,[["__scopeId","data-v-1e9fcbbc"]]),Pe={name:"Home",components:{Headset:le,MagicStick:ne,ArrowRight:oe,PlaylistSelector:_e,SkeletonLoader:we,GalaxyButton:he,GalaxyLoader:be},setup(){const d=ue(),n=ie(),m=ae(),e=b([]),g=b([]),I=b(!1),L=b(!1),B="/default-cover.svg",D=b({}),G=b(!1),V=b(null),w=b(!0),T=b(!0),_=t=>{var r;return`${((r=n.userInfo)==null?void 0:r.id)||"guest"}:${t}`},H=()=>{w.value=!1;try{sessionStorage.setItem(_("hide_welcome_section"),"1")}catch{}},M=()=>{T.value=!1;try{sessionStorage.setItem(_("hide_recommend_banner"),"1")}catch{}},N=async()=>{I.value=!0;try{const t=await ce({page:0,size:10});t.code===200&&(e.value=t.data.content||[])}catch(t){console.error("åŠ è½½çƒ­é—¨æ­Œæ›²å¤±è´¥:",t)}finally{I.value=!1}},q=async()=>{L.value=!0;try{const t=await de({page:0,size:10});t.code===200&&(g.value=t.data.content||[])}catch(t){console.error("åŠ è½½æœ€æ–°æ­Œæ›²å¤±è´¥:",t)}finally{L.value=!1}},W=t=>{m.play(t,e.value.concat(g.value))},v=t=>{m.addToPlaylist(t),F.success(`å·²æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨: ${t.title}`)},x=t=>t>=1e4?(t/1e4).toFixed(1)+"ä¸‡":t||0,i=t=>{if(!t)return"--:--";const r=Math.floor(t/60),u=t%60;return`${r}:${u.toString().padStart(2,"0")}`},z=t=>{t&&d.push(`/artist/${t}`)},c=t=>{d.push({path:"/rank",query:{type:t}})},R=()=>{d.push("/discover")},A=async()=>{var t,r;if(n.isLogin)try{const u=[...e.value,...g.value],k=[...new Set(u.map(E=>E.id))];if(k.length>0){const E=await ve(k);E.code===200&&(D.value=E.data||{})}}catch(u){console.error("åŠ è½½æ”¶è—çŠ¶æ€å¤±è´¥:",u),F.error("æŸ¥è¯¢å¤±è´¥: "+(((r=(t=u.response)==null?void 0:t.data)==null?void 0:r.message)||u.message))}},j=async t=>{if(!n.isLogin){F.warning("è¯·å…ˆç™»å½•"),d.push("/login");return}try{const r=await me(t);r.code===200&&(D.value[t]=r.data.isFavorite,F.success(r.message||(r.data.isFavorite?"æ”¶è—æˆåŠŸ":"å–æ¶ˆæ”¶è—æˆåŠŸ")))}catch{F.error("æ“ä½œå¤±è´¥")}},Z=t=>{if(!n.isLogin){F.warning("è¯·å…ˆç™»å½•"),d.push("/login");return}V.value=t,G.value=!0},$=()=>{},Q=(t,r=5)=>{const u=[];for(let k=0;k<t.length;k+=r)u.push(t.slice(k,k+r));return u},ee=J(()=>Q(e.value,5)),te=J(()=>Q(g.value,5));return re(async()=>{try{w.value=sessionStorage.getItem(_("hide_welcome_section"))!=="1",T.value=sessionStorage.getItem(_("hide_recommend_banner"))!=="1"}catch{}await N(),await q(),await A()}),O(()=>{var t;return(t=n.userInfo)==null?void 0:t.id},()=>{try{w.value=!0,T.value=!0}catch{w.value=!0,T.value=!0}}),O(()=>n.isLogin,t=>{if(!t)try{const r=[];for(let u=0;u<sessionStorage.length;u++){const k=sessionStorage.key(u);k&&(k.endsWith(":hide_welcome_section")||k.endsWith(":hide_recommend_banner"))&&r.push(k)}r.forEach(u=>sessionStorage.removeItem(u))}catch{}w.value=!0,T.value=!0}),{userStore:n,hotSongs:e,newSongs:g,hotSongsLoading:I,newSongsLoading:L,hotSongsChunks:ee,newSongsChunks:te,defaultCover:B,favoriteSongs:D,handlePlaySong:W,handleAddToPlaylist:v,handleToggleFavorite:j,showAddToPlaylistDialog:Z,handleAddSuccess:$,playlistSelectorVisible:G,selectedSongId:V,formatPlayCount:x,formatDuration:i,goToArtist:z,goToRank:c,goToDiscover:R,showWelcome:w,showBanner:T,hideWelcome:H,hideBanner:M}}},Te={class:"home"},xe={key:0,class:"welcome-section"},Ae={class:"banner-content"},ze={class:"banner-icon"},Fe={class:"banner-action"},Le={class:"content-section"},Be={class:"section-header"},De={key:0,class:"loader-wrap"},Ve={key:1,class:"carousel-container"},Re={class:"song-list"},Ie=["onClick"],Ge=["src"],He={class:"song-info"},Me={class:"song-name"},Ne={class:"song-artist"},We=["onClick"],Ee={key:0},Ue={key:0},qe={class:"song-play-count"},je={class:"song-actions"},Ke={key:2,class:"empty-state"},Qe={class:"content-section"},Je={class:"section-header"},Oe={key:0,class:"loader-wrap"},Xe={key:1,class:"carousel-container"},Ye={class:"song-list"},Ze=["onClick"],$e={class:"song-index"},et=["src"],tt={class:"song-info"},st={class:"song-name"},ot={class:"song-artist"},nt=["onClick"],lt={key:0},it={key:0},at={class:"song-time"},rt={class:"song-actions"},ct={key:2,class:"empty-state"};function dt(d,n,m,e,g,I){var W;const L=h("MagicStick"),B=h("el-icon"),D=h("ArrowRight"),G=h("GalaxyButton"),V=h("el-link"),w=h("GalaxyLoader"),T=h("Headset"),_=h("el-button"),H=h("el-carousel-item"),M=h("el-carousel"),N=h("el-empty"),q=h("PlaylistSelector");return o(),l("div",Te,[e.showWelcome?(o(),l("div",xe,[s("div",{class:"section-close",title:"éšè—æ­¤åŒºåŸŸ",onClick:n[0]||(n[0]=y((...v)=>e.hideWelcome&&e.hideWelcome(...v),["stop"]))},"âœ•"),s("h2",null,"ä½ å¥½ï¼Œ"+C(((W=e.userStore.userInfo)==null?void 0:W.nickname)||"éŸ³ä¹çˆ±å¥½è€…"),1),n[6]||(n[6]=s("p",{class:"welcome-text"}," æ¬¢è¿Žæ¥åˆ° Sheep Musicï¼Œå¼€å§‹ä½ çš„éŸ³ä¹ä¹‹æ—… ",-1))])):S("",!0),e.showBanner?(o(),l("div",{key:1,class:"recommend-banner",onClick:n[2]||(n[2]=(...v)=>e.goToDiscover&&e.goToDiscover(...v))},[s("div",Ae,[s("div",ze,[a(B,null,{default:p(()=>[a(L)]),_:1})]),n[8]||(n[8]=s("div",{class:"banner-text"},[s("h3",null,"âœ¨ å‘çŽ°ä½ çš„ä¸“å±žéŸ³ä¹"),s("p",null,"åŸºäºŽä½ çš„å–œå¥½ï¼Œä¸ºä½ æŽ¨èç²¾é€‰æ­Œæ›²å’Œæ­Œå•")],-1)),s("div",Fe,[a(G,{size:"md",variant:"secondary",onClick:e.goToDiscover},{default:p(()=>[n[7]||(n[7]=U(" ç«‹å³å‘çŽ° ",-1)),a(B,{class:"ml-5"},{default:p(()=>[a(D)]),_:1})]),_:1},8,["onClick"])]),s("div",{class:"section-close",title:"éšè—æ­¤åŒºåŸŸ",onClick:n[1]||(n[1]=y((...v)=>e.hideBanner&&e.hideBanner(...v),["stop"]))},"âœ•")])])):S("",!0),s("section",Le,[s("div",Be,[n[10]||(n[10]=s("h3",null,"ðŸ”¥ çƒ­é—¨æ­Œæ›²",-1)),a(V,{type:"primary",onClick:n[3]||(n[3]=v=>e.goToRank("hot"))},{default:p(()=>[...n[9]||(n[9]=[U("æŸ¥çœ‹æ›´å¤š â€º",-1)])]),_:1})]),e.hotSongsLoading?(o(),l("div",De,[a(w,{size:"lg"})])):e.hotSongs.length>0?(o(),l("div",Ve,[a(M,{interval:5e3,arrow:"always",height:"400px","indicator-position":"outside"},{default:p(()=>[(o(!0),l(f,null,P(e.hotSongsChunks,(v,x)=>(o(),X(H,{key:x},{default:p(()=>[s("div",Re,[(o(!0),l(f,null,P(v,(i,z)=>(o(),l("div",{key:i.id,class:"song-item",onClick:c=>e.handlePlaySong(i)},[s("div",{class:Y(["song-index",{"top-three":x*5+z<3}])},C(x*5+z+1),3),s("img",{src:i.cover||e.defaultCover,class:"song-cover"},null,8,Ge),s("div",He,[s("div",Me,C(i.title),1),s("div",Ne,[(o(!0),l(f,null,P(i.artists||[],(c,R)=>{var A;return o(),l(f,{key:c.id},[s("span",{class:"clickable",onClick:y(j=>e.goToArtist(c.id),["stop"])},C(c.name),9,We),R<(((A=i.artists)==null?void 0:A.length)||0)-1?(o(),l("span",Ee," / ")):S("",!0)],64)}),128)),!i.artists||i.artists.length===0?(o(),l("span",Ue,"æœªçŸ¥æ­Œæ‰‹")):S("",!0)])]),s("div",qe,[a(B,null,{default:p(()=>[a(T)]),_:1}),U(" "+C(e.formatPlayCount(i.playCount)),1)]),s("div",je,[a(_,{icon:"CaretRight",circle:"",size:"small",onClick:y(c=>e.handlePlaySong(i),["stop"]),title:"æ’­æ”¾"},null,8,["onClick"]),a(_,{icon:"Plus",circle:"",size:"small",onClick:y(c=>e.handleAddToPlaylist(i),["stop"]),title:"æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨"},null,8,["onClick"]),a(_,{icon:"FolderAdd",circle:"",size:"small",onClick:y(c=>e.showAddToPlaylistDialog(i.id),["stop"]),title:"æ·»åŠ åˆ°æ­Œå•"},null,8,["onClick"]),a(_,{icon:e.favoriteSongs[i.id]?"StarFilled":"Star",circle:"",size:"small",type:e.favoriteSongs[i.id]?"danger":"",onClick:y(c=>e.handleToggleFavorite(i.id),["stop"]),title:"æ”¶è—"},null,8,["icon","type","onClick"])])],8,Ie))),128))])]),_:2},1024))),128))]),_:1})])):S("",!0),e.hotSongs.length===0?(o(),l("div",Ke,[a(N,{description:"æš‚æ— çƒ­é—¨æ­Œæ›²"})])):S("",!0)]),s("section",Qe,[s("div",Je,[n[12]||(n[12]=s("h3",null,"ðŸŽµ æ–°æ­Œé€Ÿé€’",-1)),a(V,{type:"primary",onClick:n[4]||(n[4]=v=>e.goToRank("new"))},{default:p(()=>[...n[11]||(n[11]=[U("æŸ¥çœ‹æ›´å¤š â€º",-1)])]),_:1})]),e.newSongsLoading?(o(),l("div",Oe,[a(w,{size:"lg"})])):e.newSongs.length>0?(o(),l("div",Xe,[a(M,{interval:5e3,arrow:"always",height:"400px","indicator-position":"outside"},{default:p(()=>[(o(!0),l(f,null,P(e.newSongsChunks,(v,x)=>(o(),X(H,{key:x},{default:p(()=>[s("div",Ye,[(o(!0),l(f,null,P(v,(i,z)=>(o(),l("div",{key:i.id,class:"song-item",onClick:c=>e.handlePlaySong(i)},[s("div",$e,C(x*5+z+1),1),s("img",{src:i.cover||e.defaultCover,class:"song-cover"},null,8,et),s("div",tt,[s("div",st,C(i.title),1),s("div",ot,[(o(!0),l(f,null,P(i.artists||[],(c,R)=>{var A;return o(),l(f,{key:c.id},[s("span",{class:"clickable",onClick:y(j=>e.goToArtist(c.id),["stop"])},C(c.name),9,nt),R<(((A=i.artists)==null?void 0:A.length)||0)-1?(o(),l("span",lt," / ")):S("",!0)],64)}),128)),!i.artists||i.artists.length===0?(o(),l("span",it,"æœªçŸ¥æ­Œæ‰‹")):S("",!0)])]),s("div",at,C(e.formatDuration(i.duration)),1),s("div",rt,[a(_,{icon:"CaretRight",circle:"",size:"small",onClick:y(c=>e.handlePlaySong(i),["stop"]),title:"æ’­æ”¾"},null,8,["onClick"]),a(_,{icon:"Plus",circle:"",size:"small",onClick:y(c=>e.handleAddToPlaylist(i),["stop"]),title:"æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨"},null,8,["onClick"]),a(_,{icon:"FolderAdd",circle:"",size:"small",onClick:y(c=>e.showAddToPlaylistDialog(i.id),["stop"]),title:"æ·»åŠ åˆ°æ­Œå•"},null,8,["onClick"]),a(_,{icon:e.favoriteSongs[i.id]?"StarFilled":"Star",circle:"",size:"small",type:e.favoriteSongs[i.id]?"danger":"",onClick:y(c=>e.handleToggleFavorite(i.id),["stop"]),title:"æ”¶è—"},null,8,["icon","type","onClick"])])],8,Ze))),128))])]),_:2},1024))),128))]),_:1})])):S("",!0),e.newSongs.length===0?(o(),l("div",ct,[a(N,{description:"æš‚æ— æœ€æ–°æ­Œæ›²"})])):S("",!0)]),a(q,{modelValue:e.playlistSelectorVisible,"onUpdate:modelValue":n[5]||(n[5]=v=>e.playlistSelectorVisible=v),"song-id":e.selectedSongId,onSuccess:e.handleAddSuccess},null,8,["modelValue","song-id","onSuccess"])])}const kt=K(Pe,[["render",dt],["__scopeId","data-v-33d2fd03"]]);export{kt as default};
