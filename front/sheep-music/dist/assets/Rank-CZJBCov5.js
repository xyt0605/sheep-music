import{_ as j,K as G,q as J,I as O,c as r,o as i,a as o,d as n,B as Q,k as P,t as _,w as z,r as g,F as E,l as M,v as W,f as X,g as v,h as Y,x as N,y as Z,i as $,L as tt,z as et,A as at,E as f,u as ot,n as U,s as C}from"./index-CxmcMKp9.js";import{t as nt,b as st}from"./favorite-BkE7D9vH.js";import{P as lt}from"./PlaylistSelector-DozRFERd.js";import"./playlist-D_Dp_PwR.js";import"./PlaylistCover-DOR4-nAK.js";const it={name:"Rank",components:{Loading:O,Headset:J,Clock:G,PlaylistSelector:lt},setup(){const F=tt(),l=ot(),V=W(),e=X(),p=v("hot"),S=v(!1),u=v([]),A="/default-cover.svg",y=v({}),c=Y({page:1,size:50,total:0}),b=v(!1),T=v(null),h=N(()=>p.value==="hot"?"ðŸ”¥ çƒ­é—¨æ­Œæ›²æŽ’è¡Œæ¦œ":"ðŸŽµ æ–°æ­Œé€Ÿé€’æŽ’è¡Œæ¦œ"),L=N(()=>p.value==="hot"?"æœ€å—æ¬¢è¿Žçš„çƒ­é—¨æ­Œæ›²":"æœ€æ–°å‘å¸ƒçš„éŸ³ä¹ä½œå“"),m=async()=>{S.value=!0;try{const t={page:c.page-1,size:c.size},s=p.value==="hot"?await et(t):await at(t);s.code===200&&(u.value=s.data.content||[],c.total=s.data.totalElements||0,await R())}catch(t){console.error("åŠ è½½æŽ’è¡Œæ¦œå¤±è´¥:",t),f.error("åŠ è½½æŽ’è¡Œæ¦œå¤±è´¥")}finally{S.value=!1}},R=async()=>{if(!(!e.isLogin||u.value.length===0))try{const t=u.value.map(D=>D.id),s=await st(t);s.code===200&&(y.value=s.data||{})}catch(t){console.error("åŠ è½½æ”¶è—çŠ¶æ€å¤±è´¥:",t)}},a=async t=>{if(!e.isLogin){f.warning("è¯·å…ˆç™»å½•"),l.push("/login");return}try{const s=await nt(t);s.code===200&&(y.value[t]=s.data.isFavorite,f.success(s.data.isFavorite?"æ”¶è—æˆåŠŸ":"å–æ¶ˆæ”¶è—æˆåŠŸ"))}catch{f.error("æ“ä½œå¤±è´¥")}},k=()=>{c.page=1,m()},d=t=>{V.play(t,u.value)},B=t=>{V.addToPlaylist(t),f.success(`å·²æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨: ${t.title}`)},w=t=>{t&&l.push(`/artist/${t}`)},H=t=>{if(!e.isLogin){f.warning("è¯·å…ˆç™»å½•"),l.push("/login");return}T.value=t,b.value=!0},q=()=>{},x=t=>t===0?"rank-first":t===1?"rank-second":t===2?"rank-third":"",I=t=>t?t>=1e4?(t/1e4).toFixed(1)+"ä¸‡":t:0,K=t=>{if(!t)return"--:--";const s=Math.floor(t/60),D=t%60;return`${s}:${D.toString().padStart(2,"0")}`};return Z(()=>F.query.type,t=>{(t==="hot"||t==="new")&&(p.value=t,c.page=1,m())},{immediate:!0}),$(()=>{F.query.type||m()}),{activeTab:p,loading:S,songs:u,defaultCover:A,favoriteSongs:y,pagination:c,pageTitle:h,pageSubtitle:L,playlistSelectorVisible:b,selectedSongId:T,handleTabChange:k,handlePlaySong:d,handleAddToPlaylist:B,handleToggleFavorite:a,goToArtist:w,showAddToPlaylistDialog:H,handleAddSuccess:q,getRankClass:x,formatCount:I,formatDuration:K,loadSongs:m}}},rt={class:"rank-page"},ct={class:"page-header"},dt={class:"subtitle"},gt={key:0,class:"loading-state"},ut={key:1,class:"song-list"},_t=["onClick"],pt=["src"],ht={class:"song-info"},mt={class:"song-name"},vt={class:"song-artist"},ft=["onClick"],yt={key:0},kt={key:0},Ct={class:"song-stats"},St={key:0,class:"stat-item"},bt={class:"stat-item"},Tt={class:"song-actions"},wt={key:2,class:"empty-state"};function Pt(F,l,V,e,p,S){const u=g("el-tab-pane"),A=g("el-tabs"),y=g("Loading"),c=g("el-icon"),b=g("Headset"),T=g("Clock"),h=g("el-button"),L=g("el-empty"),m=g("el-pagination"),R=g("PlaylistSelector");return i(),r("div",rt,[o("div",ct,[o("h2",null,"ðŸ“Š "+_(e.pageTitle),1),o("p",dt,_(e.pageSubtitle),1)]),n(A,{modelValue:e.activeTab,"onUpdate:modelValue":l[0]||(l[0]=a=>e.activeTab=a),class:"rank-tabs",onTabChange:e.handleTabChange},{default:z(()=>[n(u,{label:"ðŸ”¥ çƒ­é—¨æ­Œæ›²",name:"hot"}),n(u,{label:"ðŸŽµ æ–°æ­Œé€Ÿé€’",name:"new"})]),_:1},8,["modelValue","onTabChange"]),e.loading?(i(),r("div",gt,[n(c,{class:"is-loading"},{default:z(()=>[n(y)]),_:1}),l[3]||(l[3]=o("p",null,"åŠ è½½ä¸­...",-1))])):e.songs.length>0?(i(),r("div",ut,[(i(!0),r(E,null,M(e.songs,(a,k)=>(i(),r("div",{key:a.id,class:U(["song-item",{"top-item":k<3}]),onClick:d=>e.handlePlaySong(a)},[o("div",{class:U(["song-rank",e.getRankClass(k)])},_(k+1),3),o("img",{src:a.cover||e.defaultCover,class:"song-cover"},null,8,pt),o("div",ht,[o("div",mt,_(a.title),1),o("div",vt,[(i(!0),r(E,null,M(a.artists||[],(d,B)=>{var w;return i(),r(E,{key:d.id},[o("span",{class:"clickable",onClick:C(H=>e.goToArtist(d.id),["stop"])},_(d.name),9,ft),B<(((w=a.artists)==null?void 0:w.length)||0)-1?(i(),r("span",yt," / ")):P("",!0)],64)}),128)),!a.artists||a.artists.length===0?(i(),r("span",kt,"æœªçŸ¥æ­Œæ‰‹")):P("",!0)])]),o("div",Ct,[e.activeTab==="hot"?(i(),r("div",St,[n(c,null,{default:z(()=>[n(b)]),_:1}),o("span",null,_(e.formatCount(a.playCount)),1)])):P("",!0),o("div",bt,[n(c,null,{default:z(()=>[n(T)]),_:1}),o("span",null,_(e.formatDuration(a.duration)),1)])]),o("div",Tt,[n(h,{icon:"CaretRight",circle:"",size:"small",onClick:C(d=>e.handlePlaySong(a),["stop"]),title:"æ’­æ”¾"},null,8,["onClick"]),n(h,{icon:"Plus",circle:"",size:"small",onClick:C(d=>e.handleAddToPlaylist(a),["stop"]),title:"æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨"},null,8,["onClick"]),n(h,{icon:"FolderAdd",circle:"",size:"small",onClick:C(d=>e.showAddToPlaylistDialog(a.id),["stop"]),title:"æ·»åŠ åˆ°æ­Œå•"},null,8,["onClick"]),n(h,{icon:e.favoriteSongs[a.id]?"StarFilled":"Star",circle:"",size:"small",type:e.favoriteSongs[a.id]?"danger":"",onClick:C(d=>e.handleToggleFavorite(a.id),["stop"]),title:"æ”¶è—"},null,8,["icon","type","onClick"])])],10,_t))),128))])):(i(),r("div",wt,[n(L,{description:`æš‚æ— ${e.activeTab==="hot"?"çƒ­é—¨":"æœ€æ–°"}æ­Œæ›²`},null,8,["description"])])),e.pagination.total>e.pagination.size?(i(),Q(m,{key:3,"current-page":e.pagination.page,"onUpdate:currentPage":l[1]||(l[1]=a=>e.pagination.page=a),"page-size":e.pagination.size,total:e.pagination.total,layout:"prev, pager, next, total",class:"pagination",onCurrentChange:e.loadSongs},null,8,["current-page","page-size","total","onCurrentChange"])):P("",!0),n(R,{modelValue:e.playlistSelectorVisible,"onUpdate:modelValue":l[2]||(l[2]=a=>e.playlistSelectorVisible=a),"song-id":e.selectedSongId,onSuccess:e.handleAddSuccess},null,8,["modelValue","song-id","onSuccess"])])}const Rt=j(it,[["render",Pt],["__scopeId","data-v-22cc177e"]]);export{Rt as default};
