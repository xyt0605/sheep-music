import{_ as v,c as F,o as b,a as l,d as t,w as i,r as u,f as k,g as y,h as x,i as V,E as _,u as h,j as U,e as p,t as L}from"./index-C5bpx5EP.js";import{l as R}from"./user-B5kT0Bhb.js";import"./request-WXopXHOE.js";const S={name:"Login",setup(){const c=h(),e=k(),n=y(null),o=y(!1),r=x({username:"",password:""}),g={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度为3-20个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度为6-20个字符",trigger:"blur"}]};V(()=>{setTimeout(()=>{r.username="",r.password="",n.value&&n.value.clearValidate(),d()},100)});const d=()=>{document.querySelectorAll(".login-form input").forEach(s=>{s.removeAttribute("readonly")})};return{loginFormRef:n,loginForm:r,loginRules:g,loading:o,handleLogin:async()=>{n.value&&await n.value.validate(async a=>{if(a)try{o.value=!0;const s=await R({username:r.username,password:r.password});e.setToken(s.data.token),e.setUserInfo(s.data.userInfo),_.success("登录成功"),r.username="",r.password="",n.value&&n.value.clearValidate(),setTimeout(()=>{c.push("/home")},500)}catch(s){_.error(s.message||"登录失败")}finally{o.value=!1}})},handleUsernameFocus:a=>{a.target.removeAttribute("readonly")},handlePasswordFocus:a=>{a.target.removeAttribute("readonly")}}}},A={class:"login-container"},C={class:"login-box"},E={class:"register-link"};function T(c,e,n,o,r,g){const d=u("el-input"),m=u("el-form-item"),f=u("el-button"),w=u("router-link"),a=u("el-form");return b(),F("div",A,[l("div",C,[e[6]||(e[6]=l("h2",{class:"title"},"Sheep Music",-1)),e[7]||(e[7]=l("p",{class:"subtitle"},"欢迎回来，请登录",-1)),t(a,{ref:"loginFormRef",model:o.loginForm,rules:o.loginRules,class:"login-form",autocomplete:"off"},{default:i(()=>[e[4]||(e[4]=l("input",{type:"text",name:"fake-username",style:{display:"none"},autocomplete:"off"},null,-1)),e[5]||(e[5]=l("input",{type:"password",name:"fake-password",style:{display:"none"},autocomplete:"new-password"},null,-1)),t(m,{prop:"username"},{default:i(()=>[t(d,{modelValue:o.loginForm.username,"onUpdate:modelValue":e[0]||(e[0]=s=>o.loginForm.username=s),placeholder:"请输入用户名","prefix-icon":"User",size:"large",autocomplete:"off",name:"username",readonly:"",onFocus:o.handleUsernameFocus},null,8,["modelValue","onFocus"])]),_:1}),t(m,{prop:"password"},{default:i(()=>[t(d,{modelValue:o.loginForm.password,"onUpdate:modelValue":e[1]||(e[1]=s=>o.loginForm.password=s),type:"password",placeholder:"请输入密码","prefix-icon":"Lock",size:"large","show-password":"",autocomplete:"new-password",name:"password",readonly:"",onFocus:o.handlePasswordFocus,onKeyup:U(o.handleLogin,["enter"])},null,8,["modelValue","onFocus","onKeyup"])]),_:1}),t(m,null,{default:i(()=>[t(f,{type:"primary",size:"large",loading:o.loading,onClick:o.handleLogin,class:"login-button"},{default:i(()=>[p(L(o.loading?"登录中...":"登录"),1)]),_:1},8,["loading","onClick"])]),_:1}),l("div",E,[e[3]||(e[3]=p(" 还没有账号？ ",-1)),t(w,{to:"/register"},{default:i(()=>[...e[2]||(e[2]=[p("立即注册",-1)])]),_:1})])]),_:1},8,["model","rules"])])])}const I=v(S,[["render",T],["__scopeId","data-v-847f91fb"]]);export{I as default};
