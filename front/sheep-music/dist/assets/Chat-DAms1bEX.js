const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DKwCkw1b.js","assets/index-CfilBRBR.css"])))=>i.map(i=>d[i]);
import{_ as he,q as Ae,v as X,h as k,x as me,r as y,a4 as ye,z as W,o as c,w as l,a as n,d as s,c as v,m as C,av as ve,t as $,e as O,A as te,k as L,F as ae,D as se,ac as je,E as V,W as ce,g as Be,j as Fe,a1 as Ee,aw as Z,N as Je,ar as Ke,X as ie,f as He,H as We,ax as fe,u as qe,n as _e,ay as Xe,O as Ge}from"./index-DKwCkw1b.js";import{u as Qe,m as Me,g as Ye,e as pe,f as Ze,h as et}from"./social-xdTTRlYp.js";import{j as tt}from"./playlist-x2Up78hp.js";import{w as ee}from"./client-BkyLSk0h.js";const at={class:"song-selector"},st={class:"search-box"},rt={key:0,class:"current-song"},nt={class:"image-error"},ot={class:"song-info"},lt={class:"song-name"},it={class:"song-artist"},ct={key:1,class:"empty-state"},dt={class:"song-list"},ut={key:0,class:"empty-state"},vt=["onClick"],ft={class:"image-error"},_t={class:"song-info"},pt={class:"song-name"},ht={class:"song-artist"},mt={class:"song-list"},yt={key:0,class:"empty-state"},wt=["onClick"],Ct={class:"image-error"},kt={class:"song-info"},St={class:"song-name"},It={class:"song-artist"},gt={__name:"SongSelector",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","select"],setup(re,{emit:B}){const q=re,x=B,R=Ae(),z=X({get:()=>q.modelValue,set:d=>x("update:modelValue",d)}),T=k("current"),I=k(""),N=k(!1),M=k([]);let A=null;const _=X(()=>{const d=R.currentSong;if(!d)return null;let o="未知歌手";return d.artist?o=Array.isArray(d.artist)?d.artist.join(", "):d.artist:d.artists?o=Array.isArray(d.artists)?d.artists.join(", "):d.artists:d.artistName&&(o=d.artistName),{...d,cover:d.cover||d.avatar||d.picUrl||"",artist:o}}),w=X(()=>(R.playlist||[]).map(o=>{let U="未知歌手";return o.artist?U=Array.isArray(o.artist)?o.artist.join(", "):o.artist:o.artists?U=Array.isArray(o.artists)?o.artists.join(", "):o.artists:o.artistName&&(U=o.artistName),{...o,cover:o.cover||o.avatar||o.picUrl||"",artist:U}})),g=d=>{d==="search"&&I.value&&D()},f=()=>{if(T.value!=="search"&&(T.value="search"),A&&clearTimeout(A),!I.value.trim()){M.value=[];return}A=setTimeout(()=>{D()},500)},D=async()=>{var d;if(!I.value.trim()){M.value=[];return}N.value=!0;try{const o=await je({keyword:I.value,page:0,size:20});if(o.code===200){const j=(((d=o.data)==null?void 0:d.content)||[]).map(h=>{let m="未知歌手";h.artist?Array.isArray(h.artist)?m=h.artist.map(p=>typeof p=="object"&&p!==null&&(p.name||p.artistName)||String(p)).join(", "):m=h.artist:h.artists?Array.isArray(h.artists)?m=h.artists.map(p=>typeof p=="object"&&p!==null&&(p.name||p.artistName)||String(p)).join(", "):m=h.artists:h.artistName&&(m=h.artistName);const J=h.name||h.songName||h.title||"未知歌曲";return{id:h.id,name:J,cover:h.cover||h.avatar||h.picUrl||"",artist:m}});M.value=j}}catch(o){console.error("搜索歌曲失败:",o),V.error("搜索失败")}finally{N.value=!1}},F=d=>{d&&(x("select",d),z.value=!1)},E=()=>{I.value="",M.value=[],T.value="current"};return me(z,d=>{d||E()}),(d,o)=>{const U=y("el-input"),j=y("el-icon"),h=y("el-image"),m=y("el-button"),J=y("el-empty"),p=y("el-tab-pane"),de=y("el-tabs"),ue=y("el-dialog"),ne=ye("loading");return c(),W(ue,{modelValue:z.value,"onUpdate:modelValue":o[3]||(o[3]=S=>z.value=S),title:"选择歌曲",width:"600px",onClose:E},{default:l(()=>[n("div",at,[n("div",st,[s(U,{modelValue:I.value,"onUpdate:modelValue":o[0]||(o[0]=S=>I.value=S),placeholder:"搜索歌曲名称或歌手","prefix-icon":"Search",clearable:"",onInput:f},null,8,["modelValue"])]),s(de,{modelValue:T.value,"onUpdate:modelValue":o[2]||(o[2]=S=>T.value=S),onTabChange:g},{default:l(()=>[s(p,{label:"当前播放",name:"current"},{default:l(()=>[_.value?(c(),v("div",rt,[n("div",{class:"song-item",onClick:o[1]||(o[1]=S=>F(_.value))},[s(h,{src:_.value.cover,fit:"cover",class:"song-cover"},{error:l(()=>[n("div",nt,[s(j,null,{default:l(()=>[s(C(ve))]),_:1})])]),_:1},8,["src"]),n("div",ot,[n("div",lt,$(_.value.name),1),n("div",it,$(_.value.artist),1)]),s(m,{type:"primary",size:"small"},{default:l(()=>[...o[4]||(o[4]=[O("选择",-1)])]),_:1})])])):(c(),v("div",ct,[s(J,{description:"当前没有播放歌曲"})]))]),_:1}),s(p,{label:"播放列表",name:"playlist"},{default:l(()=>[te((c(),v("div",dt,[w.value.length===0&&!N.value?(c(),v("div",ut,[s(J,{description:"播放列表为空"})])):L("",!0),(c(!0),v(ae,null,se(w.value,S=>(c(),v("div",{key:S.id,class:"song-item",onClick:oe=>F(S)},[s(h,{src:S.cover,fit:"cover",class:"song-cover"},{error:l(()=>[n("div",ft,[s(j,null,{default:l(()=>[s(C(ve))]),_:1})])]),_:1},8,["src"]),n("div",_t,[n("div",pt,$(S.name),1),n("div",ht,$(S.artist),1)]),s(m,{type:"primary",size:"small"},{default:l(()=>[...o[5]||(o[5]=[O("选择",-1)])]),_:1})],8,vt))),128))])),[[ne,N.value]])]),_:1}),s(p,{label:"搜索",name:"search"},{default:l(()=>[te((c(),v("div",mt,[M.value.length===0&&!N.value?(c(),v("div",yt,[s(J,{description:I.value?"没有找到相关歌曲":"请输入关键词搜索"},null,8,["description"])])):L("",!0),(c(!0),v(ae,null,se(M.value,S=>(c(),v("div",{key:S.id,class:"song-item",onClick:oe=>F(S)},[s(h,{src:S.cover,fit:"cover",class:"song-cover"},{error:l(()=>[n("div",Ct,[s(j,null,{default:l(()=>[s(C(ve))]),_:1})])]),_:1},8,["src"]),n("div",kt,[n("div",St,$(S.name),1),n("div",It,$(S.artist),1)]),s(m,{type:"primary",size:"small"},{default:l(()=>[...o[6]||(o[6]=[O("选择",-1)])]),_:1})],8,wt))),128))])),[[ne,N.value]])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])}}},$t=he(gt,[["__scopeId","data-v-9d690710"]]),Dt={class:"playlist-selector"},bt={class:"search-box"},Vt={class:"playlist-list"},Nt={key:0,class:"empty-state"},xt=["onClick"],Tt={class:"image-error"},Mt={class:"playlist-info"},At={class:"playlist-name"},Rt={class:"playlist-desc"},zt={key:0},Ut={__name:"PlaylistShareSelector",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","select"],setup(re,{emit:B}){const q=re,x=B,R=X({get:()=>q.modelValue,set:f=>x("update:modelValue",f)}),z=k(!1),T=k([]),I=k(""),N=X(()=>{if(!I.value)return T.value;const f=I.value.toLowerCase();return T.value.filter(D=>D.name.toLowerCase().includes(f))}),M=f=>f>=1e4?(f/1e4).toFixed(1)+"万":f,A=async()=>{z.value=!0;try{const f=await tt();f.code===200&&(T.value=f.data||[])}catch(f){console.error("加载歌单失败:",f),V.error("加载歌单失败")}finally{z.value=!1}},_=f=>{f&&(x("select",f),R.value=!1)},w=()=>{V.info('请先在"我的歌单"页面创建歌单'),R.value=!1},g=()=>{I.value=""};return me(R,f=>{f?A():g()}),(f,D)=>{const F=y("el-input"),E=y("el-button"),d=y("el-empty"),o=y("el-icon"),U=y("el-image"),j=y("el-dialog"),h=ye("loading");return c(),W(j,{modelValue:R.value,"onUpdate:modelValue":D[1]||(D[1]=m=>R.value=m),title:"选择歌单",width:"600px",onClose:g},{default:l(()=>[n("div",Dt,[n("div",bt,[s(F,{modelValue:I.value,"onUpdate:modelValue":D[0]||(D[0]=m=>I.value=m),placeholder:"搜索歌单名称","prefix-icon":"Search",clearable:""},null,8,["modelValue"])]),te((c(),v("div",Vt,[N.value.length===0&&!z.value?(c(),v("div",Nt,[s(d,{description:"还没有歌单"},{default:l(()=>[s(E,{type:"primary",onClick:w},{default:l(()=>[...D[2]||(D[2]=[O("创建第一个歌单",-1)])]),_:1})]),_:1})])):L("",!0),(c(!0),v(ae,null,se(N.value,m=>(c(),v("div",{key:m.id,class:"playlist-item",onClick:J=>_(m)},[s(U,{src:m.cover,fit:"cover",class:"playlist-cover"},{error:l(()=>[n("div",Tt,[s(o,null,{default:l(()=>[s(C(ce))]),_:1})])]),_:1},8,["src"]),n("div",Mt,[n("div",At,$(m.name),1),n("div",Rt,[n("span",null,$(m.songCount||0)+" 首歌曲",1),m.playCount?(c(),v("span",zt," · "+$(M(m.playCount))+" 次播放",1)):L("",!0)])]),s(E,{type:"primary",size:"small"},{default:l(()=>[...D[3]||(D[3]=[O("选择",-1)])]),_:1})],8,xt))),128))])),[[h,z.value]])])]),_:1},8,["modelValue"])}}},Pt=he(Ut,[["__scopeId","data-v-9c08eef6"]]),Lt={class:"chat-page"},Ot={class:"conversation-list"},jt={class:"list-header"},Bt={class:"search-box"},Ft={class:"conversations"},Et={key:0,class:"empty-state"},Jt=["onClick"],Kt={class:"conv-info"},Ht={class:"conv-name"},Wt={class:"conv-message"},qt={class:"conv-time"},Xt={class:"chat-window"},Gt={key:0,class:"chat-container"},Qt={class:"chat-header"},Yt={class:"header-info"},Zt={class:"friend-name"},ea={key:0,class:"empty-messages"},ta={class:"message-content"},aa={key:0,class:"message-text"},sa=["onClick"],ra={class:"share-cover-error"},na={key:1,class:"share-cover-error"},oa={class:"share-content"},la={class:"share-title"},ia={class:"share-subtitle"},ca=["onClick"],da={class:"share-cover-error"},ua={key:1,class:"share-cover-error"},va={class:"share-content"},fa={class:"share-title"},_a={class:"share-subtitle"},pa={key:3,class:"message-recalled"},ha={class:"message-time"},ma={class:"chat-input"},ya={class:"input-actions"},wa={key:1,class:"empty-chat"},Ca={__name:"Chat",setup(re){const B=Ee(),q=qe(),x=Be(),R=Qe(),z=Ae(),T=k(!1),I=k(!1),N=k(!1),M=k(""),A=k([]),_=k(null),w=k(null),g=k([]),f=k(""),D=k(null),F=k(0),E=k(!0),d=k(!1),o=k(!1),U=X(()=>{if(!M.value)return A.value;const t=M.value.toLowerCase();return A.value.filter(a=>a.friendName.toLowerCase().includes(t))}),j=t=>{if(!t.lastMessage)return"暂无消息";let a=t.lastMessage;if(a==="[分享了歌曲]"||a==="[分享了歌单]")return a;if(a.startsWith("{")||a.startsWith("["))try{const e=JSON.parse(a);if(e.id&&e.title)return"[分享了歌曲]";if(e.id&&e.name)return"[分享了歌单]"}catch{}return a.length>30?a.substring(0,30)+"...":a},h=t=>{if(!t)return"";const a=new Date(t),i=new Date-a,u=Math.floor(i/(1e3*60*60*24));return u===0?a.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):u===1?"昨天":u<7?`${u}天前`:a.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})},m=t=>t?new Date(t).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):"",J=async()=>{try{const t=await pe();if(t.code===200&&t.data){const a=new Map;if(t.data.forEach(e=>{e.friend&&a.set(e.friendId,{avatar:e.friend.avatar,nickname:e.friend.nickname||e.friend.username})}),A.value=A.value.map(e=>{const i=a.get(e.friendId);return i?{...e,friendAvatar:i.avatar,friendName:i.nickname}:e}),_.value){const e=a.get(_.value);e&&w.value&&(w.value={...w.value,avatar:e.avatar,nickname:e.nickname})}}}catch(t){console.error("更新好友信息失败:",t)}},p=async()=>{T.value=!0;try{const t=await Ye();t.code===200&&(A.value=t.data||[],await J())}catch(t){console.error("加载会话列表失败:",t)}finally{T.value=!1}},de=()=>{p(),R.loadConversations()},ue=t=>{Number(B.params.id)!==t.friendId&&q.push(`/chat/${t.friendId}`)},ne=async(t,a=!0)=>{a&&(F.value=0,g.value=[],E.value=!0),I.value=!0;try{const e=await Ze(t,{page:F.value,size:50});if(e.code===200){const i=e.data,u=(i.content||[]).map(b=>{if((b.type==="song"||b.type==="playlist")&&b.content&&!b.shareData)try{b.shareData=JSON.parse(b.content)}catch(K){console.error("解析分享数据失败:",K)}return b});a?g.value=u.reverse():g.value=[...u.reverse(),...g.value],E.value=!i.first,await Z(),G()}}catch(e){console.error("加载聊天记录失败:",e)}finally{I.value=!1}},S=async t=>{if(!(!t||!t.id)){try{await Ge.confirm("确定撤回这条消息吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}catch{return}try{(await et(t.id)).code===200&&(t.isRecalled=!0,t.type==="text"&&(t.content=""),V.success("已撤回"))}catch(a){console.error("撤回消息失败:",a),V.error("撤回失败")}}},oe=async()=>{var t;if(!(!f.value.trim()||!_.value)){N.value=!0;try{const a={receiverId:_.value,type:"text",content:f.value.trim()};ee.sendChatMessage(a);const e=`tmp-${Date.now()}`;g.value.push({clientId:e,local:!0,senderId:(t=x.userInfo)==null?void 0:t.id,receiverId:_.value,type:"text",content:a.content,createTime:new Date().toISOString(),isRecalled:!1}),f.value="",await Z(),G(),await p()}catch(a){console.error("发送消息失败:",a)}finally{N.value=!1}}},Re=()=>{if(!_.value){V.warning("请先选择聊天对象");return}d.value=!0},ze=()=>{if(!_.value){V.warning("请先选择聊天对象");return}o.value=!0},Ue=async t=>{var a;if(!(!t||!_.value)){N.value=!0;try{const e={receiverId:_.value,type:"song",content:JSON.stringify({id:t.id,name:t.name,artist:t.artist,cover:t.cover})};ee.sendChatMessage(e);const i=`tmp-${Date.now()}`;g.value.push({clientId:i,local:!0,senderId:(a=x.userInfo)==null?void 0:a.id,receiverId:_.value,type:"song",content:e.content,shareData:{id:t.id,name:t.name,artist:t.artist,cover:t.cover},createTime:new Date().toISOString(),isRecalled:!1}),await Z(),G(),await p(),V.success("分享成功")}catch(e){console.error("分享歌曲失败:",e),V.error("分享失败")}finally{N.value=!1}}},Pe=async t=>{var a;if(!(!t||!_.value)){N.value=!0;try{const e={receiverId:_.value,type:"playlist",content:JSON.stringify({id:t.id,name:t.name,cover:t.cover,songCount:t.songCount})};ee.sendChatMessage(e);const i=`tmp-${Date.now()}`;g.value.push({clientId:i,local:!0,senderId:(a=x.userInfo)==null?void 0:a.id,receiverId:_.value,type:"playlist",content:e.content,shareData:{id:t.id,name:t.name,cover:t.cover,songCount:t.songCount},createTime:new Date().toISOString(),isRecalled:!1}),await Z(),G(),await p(),V.success("分享成功")}catch(e){console.error("分享歌单失败:",e),V.error("分享失败")}finally{N.value=!1}}},Le=async t=>{var a;if(!t.shareData&&t.content)try{t.shareData=JSON.parse(t.content)}catch(e){console.error("解析歌曲数据失败:",e),V.error("歌曲数据解析失败");return}if(console.log("点击分享的歌曲:",t.shareData),!((a=t.shareData)!=null&&a.id)){V.warning("歌曲信息不完整");return}try{if(t.shareData.url)z.play(t.shareData),V.success("开始播放");else{V.info("正在加载歌曲...");const{getMusicDetail:e}=await Xe(async()=>{const{getMusicDetail:u}=await import("./index-DKwCkw1b.js").then(b=>b.ie);return{getMusicDetail:u}},__vite__mapDeps([0,1])),i=await e(t.shareData.id);if(i.code===200&&i.data){const u={...t.shareData,...i.data};z.play(u),V.success("开始播放")}else V.error("获取歌曲信息失败")}}catch(e){console.error("播放歌曲失败:",e),V.error("播放失败")}},Oe=t=>{var a;if(!t.shareData&&t.content)try{t.shareData=JSON.parse(t.content)}catch(e){console.error("解析歌单数据失败:",e)}(a=t.shareData)!=null&&a.id&&q.push(`/playlist/${t.shareData.id}`)},G=()=>{D.value&&(D.value.scrollTop=D.value.scrollHeight)};return me(()=>B.params.id,async t=>{if(t){const a=Number(t);_.value=a;const e=A.value.find(i=>i.friendId===a);e&&(w.value={id:a,nickname:e.friendName,avatar:e.friendAvatar});try{const i=await pe();if(i.code===200){const u=i.data.find(b=>b.friendId===a);u&&u.friend&&(w.value={id:a,nickname:u.friend.nickname||u.friend.username,avatar:u.friend.avatar,username:u.friend.username})}}catch(i){console.error("获取最新好友信息失败:",i)}await ne(a,!0);try{await Me(a),await R.updateUnreadMessageCount(),(!e||e.unreadCount>0)&&await p()}catch{}if(!w.value||w.value.id!==a)try{const i=await pe();if(i.code===200){const u=i.data.find(b=>b.friendId===a);u&&(w.value=u.friend||{id:a,nickname:u.friendName,avatar:u.friendAvatar})}}catch{}}else _.value=null,w.value=null,g.value=[]},{immediate:!0}),Fe(async()=>{if(await p(),B.params.id&&!w.value){const e=Number(B.params.id),i=A.value.find(u=>u.friendId===e);i&&(w.value={id:e,nickname:i.friendName,avatar:i.friendAvatar})}const t=ee.onChatMessage(async e=>{try{if(!e)return;await p()}catch(i){console.error("更新会话列表失败:",i)}}),a=ee.onChatMessage(async e=>{var i;try{if(!e||!_.value)return;const u=_.value;if(e.senderId===u||e.receiverId===u){if((e.type==="song"||e.type==="playlist")&&e.content&&!e.shareData)try{e.shareData=JSON.parse(e.content)}catch(H){console.error("解析分享数据失败:",H)}if(e.senderId===((i=x.userInfo)==null?void 0:i.id)){const H=(P,le)=>{const r=new Date(P).getTime(),Y=new Date(le).getTime();return Math.abs(r-Y)<1e4},Q=g.value.findIndex(P=>P.local===!0&&P.senderId===e.senderId&&P.receiverId===e.receiverId&&P.type===e.type&&P.content===e.content&&P.createTime&&e.createTime&&H(P.createTime,e.createTime));Q!==-1?g.value[Q]={...e}:g.value.push(e)}else if(g.value.push(e),e.id&&e.senderId===u)try{await Me(u),await R.updateUnreadMessageCount(),await p()}catch(H){console.error("标记已读失败:",H)}await Z(),G()}}catch{}});Je(()=>{typeof a=="function"&&a(),typeof t=="function"&&t()})}),(t,a)=>{const e=y("el-icon"),i=y("el-button"),u=y("el-input"),b=y("el-empty"),K=y("el-avatar"),H=y("el-badge"),Q=y("el-image"),P=y("el-button-group"),le=ye("loading");return c(),v("div",Lt,[n("div",Ot,[n("div",jt,[a[4]||(a[4]=n("h3",null,"聊天",-1)),s(i,{text:"",onClick:de},{default:l(()=>[s(e,null,{default:l(()=>[s(C(Ke))]),_:1})]),_:1})]),n("div",Bt,[s(u,{modelValue:M.value,"onUpdate:modelValue":a[0]||(a[0]=r=>M.value=r),placeholder:"搜索好友","prefix-icon":"Search",clearable:""},null,8,["modelValue"])]),te((c(),v("div",Ft,[U.value.length===0&&!T.value?(c(),v("div",Et,[s(b,{description:"暂无会话"})])):L("",!0),(c(!0),v(ae,null,se(U.value,r=>(c(),v("div",{key:r.id,class:_e(["conversation-item",{active:_.value===r.friendId}]),onClick:Y=>ue(r)},[s(H,{value:r.unreadCount,hidden:!r.unreadCount,max:99,class:"conversation-badge"},{default:l(()=>[s(K,{src:r.friendAvatar,size:45},{default:l(()=>[s(e,null,{default:l(()=>[s(C(ie))]),_:1})]),_:1},8,["src"])]),_:2},1032,["value","hidden"]),n("div",Kt,[n("div",Ht,$(r.friendName),1),n("div",Wt,$(j(r)),1)]),n("div",qt,$(h(r.lastMessageTime)),1)],10,Jt))),128))])),[[le,T.value]])]),n("div",Xt,[w.value?(c(),v("div",Gt,[n("div",Qt,[s(K,{src:w.value.avatar,size:40},{default:l(()=>[s(e,null,{default:l(()=>[s(C(ie))]),_:1})]),_:1},8,["src"]),n("div",Yt,[n("div",Zt,$(w.value.nickname||w.value.username),1),a[5]||(a[5]=n("div",{class:"friend-status"},"在线",-1))])]),te((c(),v("div",{ref_key:"messageListRef",ref:D,class:"message-list"},[g.value.length===0&&!I.value?(c(),v("div",ea,[s(b,{description:"开始聊天吧~"})])):L("",!0),(c(!0),v(ae,null,se(g.value,r=>{var Y,we,Ce,ke,Se,Ie,ge,$e,De,be,Ve,Ne,xe;return c(),v("div",{key:r.id||r.clientId,class:_e(["message-item",{"is-self":r.senderId===((Y=C(x).userInfo)==null?void 0:Y.id)}])},[r.senderId!==((we=C(x).userInfo)==null?void 0:we.id)?(c(),W(K,{key:0,src:(Ce=w.value)==null?void 0:Ce.avatar,size:35},{default:l(()=>[s(e,null,{default:l(()=>[s(C(ie))]),_:1})]),_:1},8,["src"])):L("",!0),n("div",ta,[n("div",{class:_e(["message-bubble",{"is-self":r.senderId===((ke=C(x).userInfo)==null?void 0:ke.id)}])},[r.type==="text"&&!r.isRecalled?(c(),v("div",aa,$(r.content),1)):r.type==="song"&&!r.isRecalled?(c(),v("div",{key:1,class:"message-share",onClick:Te=>Le(r)},[(Se=r.shareData)!=null&&Se.cover?(c(),W(Q,{key:0,src:r.shareData.cover,fit:"cover",class:"share-cover"},{error:l(()=>[n("div",ra,[s(e,null,{default:l(()=>[s(C(fe))]),_:1})])]),_:1},8,["src"])):(c(),v("div",na,[s(e,null,{default:l(()=>[s(C(fe))]),_:1})])),n("div",oa,[n("div",la,$(((Ie=r.shareData)==null?void 0:Ie.name)||"歌曲"),1),n("div",ia,$(((ge=r.shareData)==null?void 0:ge.artist)||""),1)])],8,sa)):r.type==="playlist"&&!r.isRecalled?(c(),v("div",{key:2,class:"message-share",onClick:Te=>Oe(r)},[($e=r.shareData)!=null&&$e.cover?(c(),W(Q,{key:0,src:r.shareData.cover,fit:"cover",class:"share-cover"},{error:l(()=>[n("div",da,[s(e,null,{default:l(()=>[s(C(ce))]),_:1})])]),_:1},8,["src"])):(c(),v("div",ua,[s(e,null,{default:l(()=>[s(C(ce))]),_:1})])),n("div",va,[n("div",fa,$(((De=r.shareData)==null?void 0:De.name)||"歌单"),1),n("div",_a,$(((be=r.shareData)==null?void 0:be.songCount)||0)+" 首歌曲",1)])],8,ca)):L("",!0),r.isRecalled?(c(),v("div",pa," [消息已撤回] ")):L("",!0)],2),n("div",ha,[O($(m(r.createTime))+" ",1),r.senderId===((Ve=C(x).userInfo)==null?void 0:Ve.id)&&!r.isRecalled&&r.id?(c(),W(i,{key:0,text:"",size:"small",class:"recall-btn",onClick:Te=>S(r)},{default:l(()=>[...a[6]||(a[6]=[O("撤回",-1)])]),_:1},8,["onClick"])):L("",!0)])]),r.senderId===((Ne=C(x).userInfo)==null?void 0:Ne.id)?(c(),W(K,{key:1,src:(xe=C(x).userInfo)==null?void 0:xe.avatar,size:35},{default:l(()=>[s(e,null,{default:l(()=>[s(C(ie))]),_:1})]),_:1},8,["src"])):L("",!0)],2)}),128))])),[[le,I.value]]),n("div",ma,[s(u,{modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=r=>f.value=r),type:"textarea",rows:3,placeholder:"输入消息...",maxlength:"2000","show-word-limit":"",resize:"none",onKeyup:He(We(oe,["ctrl"]),["enter"])},null,8,["modelValue","onKeyup"]),n("div",ya,[s(P,null,{default:l(()=>[s(i,{text:"",onClick:Re},{default:l(()=>[s(e,null,{default:l(()=>[s(C(fe))]),_:1}),a[7]||(a[7]=O(" 分享歌曲 ",-1))]),_:1}),s(i,{text:"",onClick:ze},{default:l(()=>[s(e,null,{default:l(()=>[s(C(ce))]),_:1}),a[8]||(a[8]=O(" 分享歌单 ",-1))]),_:1})]),_:1}),s(i,{type:"primary",onClick:oe,loading:N.value,disabled:!f.value.trim()},{default:l(()=>[...a[9]||(a[9]=[O(" 发送 ",-1)])]),_:1},8,["loading","disabled"])])])])):(c(),v("div",wa,[s(b,{description:"选择一个好友开始聊天"})]))]),s($t,{modelValue:d.value,"onUpdate:modelValue":a[2]||(a[2]=r=>d.value=r),onSelect:Ue},null,8,["modelValue"]),s(Pt,{modelValue:o.value,"onUpdate:modelValue":a[3]||(a[3]=r=>o.value=r),onSelect:Pe},null,8,["modelValue"])])}}},$a=he(Ca,[["__scopeId","data-v-a273e213"]]);export{$a as default};
