import{r as e,c as a,e as l,d as s,C as t,I as n,u as i,q as o,m as r,t as c,H as u,B as d,a8 as m,T as p,A as v,D as y,G as f,Y as g,L as h,F as k,n as _,al as C}from"./vue-vendor-BzZaYQKc.js";import{_ as S,u as x}from"./index-Cb8xoRiw.js";import{u as w}from"./player-BodKjA0D.js";import{P as I,Q as b,R as M,S as V,T as P,U as z,V as j,W as L,X as T,Y as A,Z as N,_ as H,o as U,$ as q,L as B}from"./element-plus-CCPVPfgN.js";import"./song-C8TMBuSO.js";import"./request-76E38DvM.js";const R={class:"music-player"},$={class:"player-main"},E={class:"player-left"},F=["src"],W={class:"song-info"},Y={class:"song-name"},D={class:"song-artist"},G={class:"player-center"},Q={class:"player-controls"},X={class:"player-progress"},Z={class:"time-text"},J={class:"time-text"},K={class:"player-right"},O={class:"volume-control"},ee={key:0,class:"lyric-panel"},ae={class:"lyric-header"},le={key:0,class:"no-lyric"},se={class:"playlist-content"},te=["onClick"],ne={class:"playlist-item-info"},ie={class:"playlist-item-name"},oe={class:"playlist-item-artist"},re={key:0,class:"empty-playlist"},ce={class:"app-layout"},ue={class:"app-header"},de={class:"header-content"},me={class:"nav-menu"},pe={key:0,class:"menu-icon"},ve={class:"user-section"},ye={class:"user-info"},fe={class:"username"},ge={key:0,class:"admin-badge"},he={class:"app-main"};const ke=S({name:"Layout",components:{MusicPlayer:S({__name:"MusicPlayer",setup(C){const S=w(),x=e(null),q=e(null),B=e(!1),ce=a({get:()=>S.duration>0?S.currentTime/S.duration*100:0,set:e=>{const a=e/100*S.duration;S.seek(a)}}),ue=e(100*S.volume),de=e=>{const a=e/100*S.duration;S.seek(a)},me=e=>{S.setVolume(e/100)},pe=e=>{if(!e||isNaN(e))return"00:00";const a=Math.floor(e/60),l=Math.floor(e%60);return`${a.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`},ve=e=>e?e.artists&&e.artists.length>0?e.artists.map(e=>e.name).join(" / "):e.artistName?e.artistName:"未知歌手":"未知歌手",ye=a(()=>({list:"列表循环",random:"随机播放",single:"单曲循环"}[S.playMode]||"列表循环")),fe=a(()=>{var e;const a=null==(e=S.currentSong)?void 0:e.lyric;if(!a)return[];const l=a.split("\n"),s=[];return l.forEach(e=>{const a=e.match(/\[(\d{2}):(\d{2})\.?(\d{2,3})?\](.*)/);if(a){const e=60*parseInt(a[1])+parseInt(a[2])+(a[3]?parseInt(a[3].padEnd(3,"0")):0)/1e3,l=a[4].trim();l&&s.push({time:e,text:l})}else e.trim()&&!e.startsWith("[")&&s.push({time:0,text:e.trim()})}),s.sort((e,a)=>e.time-a.time)}),ge=a(()=>{const e=S.currentTime;for(let a=fe.value.length-1;a>=0;a--)if(e>=fe.value[a].time)return a;return-1});l(ge,async e=>{if(e>=0&&q.value){await _();const e=q.value.querySelector(".lyric-line.active");e&&e.scrollIntoView({behavior:"smooth",block:"center"})}});const he=()=>{S.toggleLyric()};return s(()=>{x.value&&S.initAudio(x.value)}),(e,a)=>{var l,s;const _=m("el-icon"),C=m("el-button"),w=m("el-slider"),ke=m("el-tooltip"),_e=m("el-dialog");return t((o(),r("div",R,[c("audio",{ref_key:"audioRef",ref:x},null,512),c("div",$,[c("div",E,[c("img",{src:(null==(l=i(S).currentSong)?void 0:l.cover)||"https://via.placeholder.com/60?text=Music",alt:"封面",class:"song-cover",onClick:he},null,8,F),c("div",W,[c("div",Y,I((null==(s=i(S).currentSong)?void 0:s.title)||"暂无播放"),1),c("div",D,I(ve(i(S).currentSong)),1)])]),c("div",G,[c("div",Q,[u(C,{circle:"",size:"small",disabled:!i(S).hasPrevSong,onClick:i(S).prev},{default:d(()=>[u(_,null,{default:d(()=>[u(i(b))]),_:1})]),_:1},8,["disabled","onClick"]),u(C,{circle:"",type:"primary",size:"large",onClick:i(S).togglePlay,disabled:!i(S).currentSong},{default:d(()=>[i(S).isPlaying?(o(),v(_,{key:0},{default:d(()=>[u(i(M))]),_:1})):(o(),v(_,{key:1},{default:d(()=>[u(i(V))]),_:1}))]),_:1},8,["onClick","disabled"]),u(C,{circle:"",size:"small",disabled:!i(S).hasNextSong,onClick:i(S).next},{default:d(()=>[u(_,null,{default:d(()=>[u(i(P))]),_:1})]),_:1},8,["disabled","onClick"])]),c("div",X,[c("span",Z,I(pe(i(S).currentTime)),1),u(w,{modelValue:ce.value,"onUpdate:modelValue":a[0]||(a[0]=e=>ce.value=e),"show-tooltip":!1,onChange:de,class:"progress-slider"},null,8,["modelValue"]),c("span",J,I(pe(i(S).duration)),1)])]),c("div",K,[u(ke,{content:ye.value,placement:"top"},{default:d(()=>[u(C,{circle:"",size:"small",onClick:i(S).togglePlayMode},{default:d(()=>[u(_,null,{default:d(()=>["list"===i(S).playMode?(o(),v(i(z),{key:0})):y("",!0),"random"===i(S).playMode?(o(),v(i(j),{key:1})):y("",!0),"single"===i(S).playMode?(o(),v(i(L),{key:2})):y("",!0)]),_:1})]),_:1},8,["onClick"])]),_:1},8,["content"]),u(C,{circle:"",size:"small",type:i(S).showLyric?"primary":"",onClick:he},{default:d(()=>[u(_,null,{default:d(()=>[u(i(T))]),_:1})]),_:1},8,["type"]),c("div",O,[u(_,null,{default:d(()=>[u(i(A))]),_:1}),u(w,{modelValue:ue.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ue.value=e),"show-tooltip":!1,onInput:me,style:{width:"100px","margin-left":"10px"}},null,8,["modelValue"])]),u(C,{circle:"",size:"small",onClick:a[2]||(a[2]=e=>B.value=!0)},{default:d(()=>[u(_,null,{default:d(()=>[u(i(N))]),_:1})]),_:1})])]),u(p,{name:"lyric-slide"},{default:d(()=>{var e,a;return[i(S).showLyric?(o(),r("div",ee,[c("div",ae,[c("h3",null,I(null==(e=i(S).currentSong)?void 0:e.title),1),u(C,{circle:"",size:"small",onClick:i(S).toggleLyric},{default:d(()=>[u(_,null,{default:d(()=>[u(i(H))]),_:1})]),_:1},8,["onClick"])]),c("div",{class:"lyric-content",ref_key:"lyricContentRef",ref:q},[(o(!0),r(f,null,g(fe.value,(e,a)=>(o(),r("div",{key:a,class:U(["lyric-line",{active:a===ge.value}])},I(e.text),3))),128)),(null==(a=i(S).currentSong)?void 0:a.lyric)?y("",!0):(o(),r("div",le," 暂无歌词 "))],512)])):y("",!0)]}),_:1}),u(_e,{modelValue:B.value,"onUpdate:modelValue":a[3]||(a[3]=e=>B.value=e),title:"播放列表",width:"500px"},{default:d(()=>[c("div",se,[(o(!0),r(f,null,g(i(S).playlist,(e,l)=>(o(),r("div",{key:e.id,class:U(["playlist-item",{active:l===i(S).currentIndex}]),onClick:a=>i(S).play(e)},[c("div",ne,[c("span",ie,I(e.title),1),c("span",oe,I(ve(e)),1)]),u(C,{link:"",type:"danger",size:"small",onClick:h(a=>i(S).removeFromPlaylist(e.id),["stop"])},{default:d(()=>[...a[4]||(a[4]=[k(" 删除 ",-1)])]),_:1},8,["onClick"])],10,te))),128)),0===i(S).playlist.length?(o(),r("div",re," 播放列表为空 ")):y("",!0)])]),_:1},8,["modelValue"])],512)),[[n,i(S).showPlayer]])}}},[["__scopeId","data-v-c14f3cfc"]])},setup(){const e=C(),l=x(),s=a(()=>{const e=[{name:"首页",path:"/home",icon:"🏠"},{name:"发现",path:"/discover",icon:"✨"},{name:"搜索",path:"/search",icon:"🔍"},{name:"歌单广场",path:"/playlist",icon:"📃"},{name:"排行榜",path:"/rank",icon:"📊"},{name:"我的音乐",path:"/my-music"}];return l.isAdmin&&e.push({name:"管理后台",path:"/admin",icon:"🔧"}),e});return{userStore:l,menuItems:s,goHome:()=>{e.push("/home")},handleCommand:async a=>{switch(a){case"profile":e.push("/profile");break;case"settings":B.info("设置功能待开发");break;case"logout":q.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{l.logout(),B.success("已退出登录"),e.push("/login")}).catch(()=>{})}}}}},[["render",function(e,a,l,s,t,n){const i=m("router-link"),p=m("el-avatar"),h=m("el-dropdown-item"),_=m("el-dropdown-menu"),C=m("el-dropdown"),S=m("router-view"),x=m("MusicPlayer");return o(),r("div",ce,[c("header",ue,[c("div",de,[c("div",{class:"logo",onClick:a[0]||(a[0]=(...e)=>s.goHome&&s.goHome(...e))},[...a[1]||(a[1]=[c("span",{class:"logo-icon"},"🎵",-1),c("span",{class:"logo-text"},"Sheep Music",-1)])]),c("nav",me,[(o(!0),r(f,null,g(s.menuItems,e=>(o(),v(i,{key:e.path,to:e.path,class:"nav-item","active-class":"active"},{default:d(()=>[e.icon?(o(),r("span",pe,I(e.icon),1)):y("",!0),k(" "+I(e.name),1)]),_:2},1032,["to"]))),128))]),c("div",ve,[u(C,{onCommand:s.handleCommand},{dropdown:d(()=>[u(_,null,{default:d(()=>[u(h,{command:"profile"},{default:d(()=>[...a[2]||(a[2]=[k("个人中心",-1)])]),_:1}),u(h,{command:"settings"},{default:d(()=>[...a[3]||(a[3]=[k("设置",-1)])]),_:1}),u(h,{divided:"",command:"logout"},{default:d(()=>[...a[4]||(a[4]=[k("退出登录",-1)])]),_:1})]),_:1})]),default:d(()=>{var e,a;return[c("div",ye,[u(p,{src:null==(e=s.userStore.userInfo)?void 0:e.avatar,size:"default"},{default:d(()=>{var e,a;return[k(I(null==(a=null==(e=s.userStore.userInfo)?void 0:e.nickname)?void 0:a.charAt(0)),1)]}),_:1},8,["src"]),c("span",fe,I(null==(a=s.userStore.userInfo)?void 0:a.nickname),1),s.userStore.isAdmin?(o(),r("span",ge,"管理员")):y("",!0)])]}),_:1},8,["onCommand"])])])]),c("main",he,[u(S)]),u(x)])}],["__scopeId","data-v-7a736215"]]);export{ke as default};
