import{_ as a,u as e}from"./index-Cb8xoRiw.js";import{u as l,a as s}from"./user-v6clTCfC.js";import{L as o,P as r}from"./element-plus-CCPVPfgN.js";import{m as d,q as i,t,H as n,B as u,a8 as m,r as c,c as p,h as w,F as f,A as v}from"./vue-vendor-BzZaYQKc.js";import"./request-76E38DvM.js";const g={class:"profile-page"},h={class:"user-info-card"},b={class:"user-basic-info"},P={class:"avatar-container"},V={class:"user-details"},y={class:"username"},k={class:"info-list"},_={class:"info-item"},F={class:"value"},S={class:"info-item"},U={class:"value"},D={class:"actions"},I={class:"avatar-edit"},A={class:"avatar-actions"},x={class:"dialog-footer"},C={class:"dialog-footer"};const L=a({name:"Profile",setup(){const a=e(),r=c(null),d=c(null),i=c(!1),t=c(!1),n=c(!1),u=c(!1),m=c(!1),f=p(()=>({Authorization:`Bearer ${localStorage.getItem("token")}`})),v=w({nickname:"",email:"",avatar:""}),g=w({oldPassword:"",newPassword:"",confirmPassword:""});return{userStore:a,editFormRef:r,passwordFormRef:d,editDialogVisible:i,passwordDialogVisible:t,editLoading:n,passwordLoading:u,uploadLoading:m,uploadAction:"/api/upload/avatar",uploadHeaders:f,editForm:v,passwordForm:g,editRules:{nickname:[{required:!0,message:"è¯·è¾“å…¥æ˜µç§°",trigger:"blur"},{min:1,max:50,message:"æ˜µç§°é•¿åº¦ä¸º1-50ä¸ªå­—ç¬¦",trigger:"blur"}],email:[{validator:(a,e,l)=>{e&&!/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/.test(e)?l(new Error("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")):l()},trigger:"blur"}]},passwordRules:{oldPassword:[{required:!0,message:"è¯·è¾“å…¥æ—§å¯†ç ",trigger:"blur"}],newPassword:[{required:!0,message:"è¯·è¾“å…¥æ–°å¯†ç ",trigger:"blur"},{min:6,max:20,message:"å¯†ç é•¿åº¦ä¸º6-20ä¸ªå­—ç¬¦",trigger:"blur"}],confirmPassword:[{required:!0,message:"è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ",trigger:"blur"},{validator:(a,e,l)=>{e!==g.newPassword?l(new Error("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´")):l()},trigger:"blur"}]},formatDate:a=>{if(!a)return"æœªçŸ¥";return new Date(a).toLocaleDateString("zh-CN")},showEditDialog:()=>{var e,l,s;v.nickname=(null==(e=a.userInfo)?void 0:e.nickname)||"",v.email=(null==(l=a.userInfo)?void 0:l.email)||"",v.avatar=(null==(s=a.userInfo)?void 0:s.avatar)||"",i.value=!0},showPasswordDialog:()=>{g.oldPassword="",g.newPassword="",g.confirmPassword="",t.value=!0},handleEditSubmit:async()=>{r.value&&await r.value.validate(async e=>{if(e)try{n.value=!0;const e=await l({nickname:v.nickname,email:v.email||null,avatar:v.avatar||null});a.setUserInfo(e.data),o.success("èµ„æ–™æ›´æ–°æˆåŠŸ"),i.value=!1}catch(s){o.error(s.message||"æ›´æ–°å¤±è´¥")}finally{n.value=!1}})},handlePasswordSubmit:async()=>{d.value&&await d.value.validate(async a=>{if(a)try{u.value=!0,await s({oldPassword:g.oldPassword,newPassword:g.newPassword}),o.success("å¯†ç ä¿®æ”¹æˆåŠŸ"),t.value=!1,g.oldPassword="",g.newPassword="",g.confirmPassword=""}catch(e){o.error(e.message||"ä¿®æ”¹å¤±è´¥")}finally{u.value=!1}})},beforeAvatarUpload:a=>{const e=a.type.startsWith("image/"),l=a.size/1024/1024<2;return e?!!l||(o.error("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 2MB!"),!1):(o.error("åªèƒ½ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶!"),!1)},handleUploadProgress:()=>{m.value=!0},handleAvatarSuccess:e=>{m.value=!1;const s=e&&e.data&&e.data.url||e&&e.url;if(s){const e={...a.userInfo,avatar:s};a.setUserInfo(e),l({avatar:s}).then(()=>{o.success("å¤´åƒæ›´æ–°æˆåŠŸ")}).catch(()=>{o.warning("å¤´åƒæ˜¾ç¤ºæˆåŠŸï¼Œä½†åŒæ­¥å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢")})}else o.error(e&&e.message||"ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•")},handleUploadError:a=>{m.value=!1;try{const e=JSON.parse(a.message);o.error(e.message||"ä¸Šä¼ å¤±è´¥")}catch(e){o.error("ä¸Šä¼ å¤±è´¥")}}}}},[["render",function(a,e,l,s,o,c){const p=m("el-avatar"),w=m("el-button"),L=m("el-upload"),z=m("el-tag"),R=m("el-divider"),E=m("el-card"),j=m("el-input"),q=m("el-form-item"),B=m("el-text"),H=m("el-form"),N=m("el-dialog");return i(),d("div",g,[e[21]||(e[21]=t("div",{class:"page-header"},[t("h2",null,"ğŸ‘¤ ä¸ªäººä¸­å¿ƒ"),t("p",{class:"subtitle"},"ç®¡ç†ä½ çš„ä¸ªäººä¿¡æ¯")],-1)),t("div",h,[n(E,{shadow:"hover"},{default:u(()=>{var a,l,o,d,m;return[t("div",b,[t("div",P,[n(p,{size:100,src:null==(a=s.userStore.userInfo)?void 0:a.avatar},{default:u(()=>{var a,e;return[f(r(null==(e=null==(a=s.userStore.userInfo)?void 0:a.nickname)?void 0:e.charAt(0)),1)]}),_:1},8,["src"]),n(L,{class:"avatar-uploader",action:s.uploadAction,headers:s.uploadHeaders,"show-file-list":!1,"on-success":s.handleAvatarSuccess,"before-upload":s.beforeAvatarUpload,"on-progress":s.handleUploadProgress,"on-error":s.handleUploadError},{default:u(()=>[n(w,{size:"small",type:"primary",loading:s.uploadLoading},{default:u(()=>[f(r(s.uploadLoading?"ä¸Šä¼ ä¸­...":"æ›´æ¢å¤´åƒ"),1)]),_:1},8,["loading"])]),_:1},8,["action","headers","on-success","before-upload","on-progress","on-error"])]),t("div",V,[t("h3",null,r(null==(l=s.userStore.userInfo)?void 0:l.nickname),1),t("p",y,"@"+r(null==(o=s.userStore.userInfo)?void 0:o.username),1),s.userStore.isAdmin?(i(),v(z,{key:0,type:"danger",size:"small"},{default:u(()=>[...e[10]||(e[10]=[f("ç®¡ç†å‘˜",-1)])]),_:1})):(i(),v(z,{key:1,type:"success",size:"small"},{default:u(()=>[...e[11]||(e[11]=[f("æ™®é€šç”¨æˆ·",-1)])]),_:1}))])]),n(R),t("div",k,[t("div",_,[e[12]||(e[12]=t("span",{class:"label"},"é‚®ç®±ï¼š",-1)),t("span",F,r((null==(d=s.userStore.userInfo)?void 0:d.email)||"æœªè®¾ç½®"),1)]),t("div",S,[e[13]||(e[13]=t("span",{class:"label"},"æ³¨å†Œæ—¶é—´ï¼š",-1)),t("span",U,r(s.formatDate(null==(m=s.userStore.userInfo)?void 0:m.createdAt)),1)])]),n(R),t("div",D,[n(w,{type:"primary",onClick:s.showEditDialog},{default:u(()=>[...e[14]||(e[14]=[f("ç¼–è¾‘èµ„æ–™",-1)])]),_:1},8,["onClick"]),n(w,{onClick:s.showPasswordDialog},{default:u(()=>[...e[15]||(e[15]=[f("ä¿®æ”¹å¯†ç ",-1)])]),_:1},8,["onClick"])])]}),_:1})]),n(N,{modelValue:s.editDialogVisible,"onUpdate:modelValue":e[4]||(e[4]=a=>s.editDialogVisible=a),title:"ç¼–è¾‘èµ„æ–™",width:"500px","close-on-click-modal":!1},{footer:u(()=>[t("span",x,[n(w,{onClick:e[3]||(e[3]=a=>s.editDialogVisible=!1)},{default:u(()=>[...e[17]||(e[17]=[f("å–æ¶ˆ",-1)])]),_:1}),n(w,{type:"primary",loading:s.editLoading,onClick:s.handleEditSubmit},{default:u(()=>[...e[18]||(e[18]=[f(" ç¡®å®š ",-1)])]),_:1},8,["loading","onClick"])])]),default:u(()=>[n(H,{ref:"editFormRef",model:s.editForm,rules:s.editRules,"label-width":"80px"},{default:u(()=>[n(q,{label:"æ˜µç§°",prop:"nickname"},{default:u(()=>[n(j,{modelValue:s.editForm.nickname,"onUpdate:modelValue":e[0]||(e[0]=a=>s.editForm.nickname=a),placeholder:"è¯·è¾“å…¥æ˜µç§°",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),n(q,{label:"é‚®ç®±",prop:"email"},{default:u(()=>[n(j,{modelValue:s.editForm.email,"onUpdate:modelValue":e[1]||(e[1]=a=>s.editForm.email=a),placeholder:"è¯·è¾“å…¥é‚®ç®±",type:"email"},null,8,["modelValue"])]),_:1}),n(q,{label:"å¤´åƒ",prop:"avatar"},{default:u(()=>[t("div",I,[n(p,{size:80,src:s.editForm.avatar},{default:u(()=>{var a;return[f(r(null==(a=s.editForm.nickname)?void 0:a.charAt(0)),1)]}),_:1},8,["src"]),t("div",A,[n(j,{modelValue:s.editForm.avatar,"onUpdate:modelValue":e[2]||(e[2]=a=>s.editForm.avatar=a),placeholder:"å¤´åƒURLï¼ˆå¯é€‰ï¼Œå»ºè®®ä½¿ç”¨ä¸Šä¼ åŠŸèƒ½ï¼‰",type:"url",style:{"margin-bottom":"10px"}},null,8,["modelValue"]),n(B,{type:"info",size:"small"},{default:u(()=>[...e[16]||(e[16]=[f('æç¤ºï¼šå…³é—­å¯¹è¯æ¡†åï¼Œå¯ç‚¹å‡»ä¸ªäººä¸­å¿ƒçš„"æ›´æ¢å¤´åƒ"æŒ‰é’®ä¸Šä¼ å›¾ç‰‡',-1)])]),_:1})])])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),n(N,{modelValue:s.passwordDialogVisible,"onUpdate:modelValue":e[9]||(e[9]=a=>s.passwordDialogVisible=a),title:"ä¿®æ”¹å¯†ç ",width:"500px","close-on-click-modal":!1},{footer:u(()=>[t("span",C,[n(w,{onClick:e[8]||(e[8]=a=>s.passwordDialogVisible=!1)},{default:u(()=>[...e[19]||(e[19]=[f("å–æ¶ˆ",-1)])]),_:1}),n(w,{type:"primary",loading:s.passwordLoading,onClick:s.handlePasswordSubmit},{default:u(()=>[...e[20]||(e[20]=[f(" ç¡®å®š ",-1)])]),_:1},8,["loading","onClick"])])]),default:u(()=>[n(H,{ref:"passwordFormRef",model:s.passwordForm,rules:s.passwordRules,"label-width":"100px"},{default:u(()=>[n(q,{label:"æ—§å¯†ç ",prop:"oldPassword"},{default:u(()=>[n(j,{modelValue:s.passwordForm.oldPassword,"onUpdate:modelValue":e[5]||(e[5]=a=>s.passwordForm.oldPassword=a),type:"password",placeholder:"è¯·è¾“å…¥æ—§å¯†ç ","show-password":""},null,8,["modelValue"])]),_:1}),n(q,{label:"æ–°å¯†ç ",prop:"newPassword"},{default:u(()=>[n(j,{modelValue:s.passwordForm.newPassword,"onUpdate:modelValue":e[6]||(e[6]=a=>s.passwordForm.newPassword=a),type:"password",placeholder:"è¯·è¾“å…¥æ–°å¯†ç ï¼ˆ6-20ä¸ªå­—ç¬¦ï¼‰","show-password":""},null,8,["modelValue"])]),_:1}),n(q,{label:"ç¡®è®¤æ–°å¯†ç ",prop:"confirmPassword"},{default:u(()=>[n(j,{modelValue:s.passwordForm.confirmPassword,"onUpdate:modelValue":e[7]||(e[7]=a=>s.passwordForm.confirmPassword=a),type:"password",placeholder:"è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}],["__scopeId","data-v-11f5fc9d"]]);export{L as default};
