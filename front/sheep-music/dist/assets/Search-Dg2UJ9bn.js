import{U as b,_ as we,v as Ce,f as Se,g as n,x as He,i as Te,y as $e,c as r,o as l,a,k as y,d as o,r as H,w as i,j as Ve,F as T,l as M,V as Z,u as ze,Q as g,N as Le,W as Ae,B as G,n as Pe,t as f,X as Me,K as be,e as Fe,Y as xe,s as $,I as Ue,T as Be,H as De,M as Ee,E as d,Z as Ke}from"./index-CU8TO-n3.js";import{g as Ne}from"./artist-DBBivPJo.js";import{t as Re,b as Ie}from"./favorite-Czb6jsZK.js";import{P as je}from"./PlaylistSelector-BHFtEt-3.js";import"./playlist-CGieJ7gF.js";import"./PlaylistCover-h1E9Fxsc.js";const qe=(w=10)=>b({url:"/api/user/search-history/hot",method:"get",params:{limit:w}}),Oe=()=>b({url:"/api/user/search-history",method:"get"}),Qe=w=>b({url:"/api/user/search-history",method:"post",data:{keyword:w}}),We=w=>b({url:`/api/user/search-history/${w}`,method:"delete"}),Xe=()=>b({url:"/api/user/search-history/clear",method:"delete"}),Ye={class:"search-page"},Ze={class:"search-header"},Ge={class:"search-container"},Je={key:0,class:"initial-state"},es={class:"hot-search-section"},ss={class:"section-header"},ts={class:"hot-search-list"},as=["onClick"],os={class:"hot-keyword"},ls={key:0,class:"search-history-section"},rs={class:"section-header"},ns={class:"history-list"},cs=["onClick"],is={class:"history-keyword"},us={key:1,class:"loading-state"},ds={key:0,class:"search-results"},vs={key:0,class:"songs-container"},hs={class:"result-header"},_s={class:"song-list"},ps=["onClick"],ys={class:"song-index"},gs=["src"],ms={class:"song-info"},fs=["innerHTML"],ks={class:"song-artist"},ws=["onClick","innerHTML"],Cs={key:0},Ss={key:0},Hs={class:"song-duration"},Ts={class:"song-actions"},$s={key:1,class:"empty-state"},Vs={key:0,class:"search-results"},zs={key:0,class:"artists-container"},Ls={class:"result-header"},As={class:"artist-grid"},Ps=["onClick"],Ms={class:"artist-avatar-wrapper"},bs=["src"],Fs={class:"artist-overlay"},xs={class:"artist-info"},Us=["innerHTML"],Bs={class:"artist-region"},Ds={key:1,class:"empty-state"},Es="/default-cover.svg",Ks="/default-artist.svg",Ns={__name:"Search",setup(w){const U=ze(),I=Ce(),B=Se(),c=n(""),v=n("songs"),V=n(!1),z=n(!1),C=n(1),F=n(20),J=[{label:"ðŸŽµ å•æ›²",value:"songs"},{label:"ðŸ‘¤ æ­Œæ‰‹",value:"artists"}],m=n([]),L=n(0),A=n([]),D=n(0),j=n([]),E=n([]),k=n([]),x=n({}),K=n(!1),q=n(null);let N=null;const ee=He(()=>v.value==="songs"?"æœç´¢æ­Œæ›²åç§°":"æœç´¢æ­Œæ‰‹åç§°");Te(()=>{se(),O(),le()});const se=async()=>{try{const e=await qe(10);e.code===200&&(E.value=e.data||[])}catch(e){console.error("åŠ è½½çƒ­é—¨æœç´¢å¤±è´¥:",e),E.value=["å‘¨æ°ä¼¦","ä¸ƒé‡Œé¦™","æž—ä¿Šæ°","è–›ä¹‹è°¦","æ¼”å‘˜"]}},O=async()=>{try{const e=await Oe();e.code===200&&(k.value=e.data||[])}catch(e){console.error("åŠ è½½æœç´¢åŽ†å²å¤±è´¥:",e),k.value=[]}},te=async e=>{if(e.trim())try{await Qe(e),await O()}catch(s){console.error("ä¿å­˜æœç´¢åŽ†å²å¤±è´¥:",s)}},ae=async()=>{try{const e=await Xe();e.code===200?(k.value=[],d.success("å·²æ¸…ç©ºæœç´¢åŽ†å²")):d.error(e.message||"æ¸…ç©ºå¤±è´¥")}catch(e){console.error("æ¸…ç©ºæœç´¢åŽ†å²å¤±è´¥:",e),d.error("æ¸…ç©ºå¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}},oe=async e=>{try{const s=await We(e);s.code===200?(k.value=k.value.filter(u=>u.id!==e),d.success("å·²åˆ é™¤")):d.error(s.message||"åˆ é™¤å¤±è´¥")}catch(s){console.error("åˆ é™¤æœç´¢åŽ†å²å¤±è´¥:",s),d.error("åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}},le=async()=>{try{const e=await Ne({page:0,size:100});e.code===200&&(j.value=e.data.content||[])}catch(e){console.error("åŠ è½½æ­Œæ‰‹åˆ—è¡¨å¤±è´¥:",e)}};$e(v,()=>{c.value.trim()&&z.value&&(C.value=1,S())});const S=async()=>{if(!c.value.trim()){m.value=[],A.value=[],z.value=!1;return}V.value=!0,z.value=!0,te(c.value.trim());try{v.value==="songs"?await re():await ie()}catch(e){console.error("æœç´¢å¤±è´¥:",e),d.error("æœç´¢å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}finally{V.value=!1}},re=async()=>{try{const e=await Ke({keyword:c.value.trim(),page:C.value-1,size:F.value});e.code===200&&(m.value=e.data.content||[],L.value=e.data.totalElements||0,await ne())}catch(e){throw console.error("æœç´¢æ­Œæ›²å¤±è´¥:",e),e}},ne=async()=>{if(!(!B.isLogin||m.value.length===0))try{const e=m.value.map(u=>u.id),s=await Ie(e);s.code===200&&(x.value=s.data||{})}catch(e){console.error("åŠ è½½æ”¶è—çŠ¶æ€å¤±è´¥:",e)}},ce=async e=>{if(!B.isLogin){d.warning("è¯·å…ˆç™»å½•"),U.push("/login");return}try{const s=await Re(e);if(s.code===200){const u=s.data.isFavorite;x.value[e]=u,d.success(u?"æ”¶è—æˆåŠŸ":"å–æ¶ˆæ”¶è—æˆåŠŸ")}else d.error(s.message||"æ“ä½œå¤±è´¥")}catch(s){console.error("æ”¶è—æ“ä½œå¤±è´¥:",s),d.error("æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}},ie=async()=>{try{const e=c.value.trim().toLowerCase(),s=j.value.filter(u=>u.name.toLowerCase().includes(e)||u.region&&u.region.toLowerCase().includes(e));A.value=s,D.value=s.length}catch(e){throw console.error("æœç´¢æ­Œæ‰‹å¤±è´¥:",e),e}},ue=()=>{if(!c.value.trim()){m.value=[],A.value=[],z.value=!1,L.value=0,D.value=0;return}N&&clearTimeout(N),N=setTimeout(()=>{C.value=1,S()},500)},de=e=>{c.value=e,v.value="songs",S()},ve=e=>{c.value=e,v.value="songs",S()},Q=e=>{I.play(e,m.value)},he=e=>{I.addToPlaylist(e),d.success(`å·²æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨: ${e.title}`)},_e=e=>{if(!e)return"--:--";const s=Math.floor(e/60),u=e%60;return`${s}:${u.toString().padStart(2,"0")}`},R=e=>{if(!c.value||!e)return e;const s=new RegExp(`(${c.value})`,"gi");return e.replace(s,'<span class="highlight">$1</span>')},pe=()=>{S(),window.scrollTo({top:0,behavior:"smooth"})},W=e=>{e&&U.push(`/artist/${e}`)},ye=e=>{if(!B.isLogin){d.warning("è¯·å…ˆç™»å½•"),U.push("/login");return}q.value=e,K.value=!0},ge=()=>{};return(e,s)=>{const u=H("el-segmented"),h=H("el-icon"),me=H("el-input"),P=H("el-button"),fe=H("el-pagination"),X=H("el-empty");return l(),r("div",Ye,[a("div",Ze,[a("div",Ge,[o(u,{modelValue:v.value,"onUpdate:modelValue":s[0]||(s[0]=t=>v.value=t),options:J,size:"large",class:"search-type-selector"},null,8,["modelValue"]),o(me,{modelValue:c.value,"onUpdate:modelValue":s[1]||(s[1]=t=>c.value=t),placeholder:ee.value,clearable:"",size:"large",class:"search-input",onInput:ue,onKeyup:Ve(S,["enter"])},{prefix:i(()=>[o(h,null,{default:i(()=>[o(g(Le))]),_:1})]),_:1},8,["modelValue","placeholder"])])]),!c.value&&!z.value?(l(),r("div",Je,[a("div",es,[a("div",ss,[o(h,{class:"header-icon"},{default:i(()=>[o(g(Ae))]),_:1}),s[4]||(s[4]=a("h3",null,"çƒ­é—¨æœç´¢",-1))]),a("div",ts,[(l(!0),r(T,null,M(E.value,(t,_)=>(l(),r("div",{key:_,class:"hot-search-item",onClick:p=>de(t)},[a("span",{class:Pe(["hot-rank",{"top-three":_<3}])},f(_+1),3),a("span",os,f(t),1),_<3?(l(),G(h,{key:0,class:"hot-icon"},{default:i(()=>[o(g(Me))]),_:1})):y("",!0)],8,as))),128))])]),k.value.length>0?(l(),r("div",ls,[a("div",rs,[o(h,{class:"header-icon"},{default:i(()=>[o(g(be))]),_:1}),s[6]||(s[6]=a("h3",null,"æœç´¢åŽ†å²",-1)),o(P,{text:"",type:"danger",size:"small",onClick:ae},{default:i(()=>[...s[5]||(s[5]=[Fe(" æ¸…ç©ºåŽ†å² ",-1)])]),_:1})]),a("div",ns,[(l(!0),r(T,null,M(k.value,t=>(l(),r("div",{key:t.id,class:"history-item",onClick:_=>ve(t.keyword)},[a("span",is,f(t.keyword),1),o(h,{class:"delete-icon",onClick:$(_=>oe(t.id),["stop"])},{default:i(()=>[o(g(xe))]),_:1},8,["onClick"])],8,cs))),128))])])):y("",!0)])):y("",!0),V.value?(l(),r("div",us,[o(h,{class:"is-loading"},{default:i(()=>[o(g(Ue))]),_:1}),s[7]||(s[7]=a("p",null,"æœç´¢ä¸­...",-1))])):y("",!0),o(Z,{name:"fade"},{default:i(()=>[!V.value&&c.value&&v.value==="songs"?(l(),r("div",ds,[m.value.length>0?(l(),r("div",vs,[a("div",hs,[a("h3",null,"æ‰¾åˆ° "+f(L.value)+" é¦–æ­Œæ›²",1)]),a("div",_s,[(l(!0),r(T,null,M(m.value,(t,_)=>(l(),r("div",{key:t.id,class:"song-item",onClick:p=>Q(t)},[a("div",ys,f((C.value-1)*F.value+_+1),1),a("img",{src:t.cover||Es,class:"song-cover"},null,8,gs),a("div",ms,[a("div",{class:"song-name",innerHTML:R(t.title)},null,8,fs),a("div",ks,[(l(!0),r(T,null,M(t.artists||[],(p,ke)=>{var Y;return l(),r(T,{key:p.id},[a("span",{class:"clickable",onClick:$(Rs=>W(p.id),["stop"]),innerHTML:R(p.name)},null,8,ws),ke<(((Y=t.artists)==null?void 0:Y.length)||0)-1?(l(),r("span",Cs," / ")):y("",!0)],64)}),128)),!t.artists||t.artists.length===0?(l(),r("span",Ss,"æœªçŸ¥æ­Œæ‰‹")):y("",!0)])]),a("div",Hs,f(_e(t.duration)),1),a("div",Ts,[o(P,{icon:"CaretRight",circle:"",size:"small",onClick:$(p=>Q(t),["stop"]),title:"æ’­æ”¾"},null,8,["onClick"]),o(P,{icon:"Plus",circle:"",size:"small",onClick:$(p=>he(t),["stop"]),title:"æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨"},null,8,["onClick"]),o(P,{icon:"FolderAdd",circle:"",size:"small",onClick:$(p=>ye(t.id),["stop"]),title:"æ·»åŠ åˆ°æ­Œå•"},null,8,["onClick"]),o(P,{icon:x.value[t.id]?"StarFilled":"Star",circle:"",size:"small",type:x.value[t.id]?"danger":"",onClick:$(p=>ce(t.id),["stop"]),title:"æ”¶è—"},null,8,["icon","type","onClick"])])],8,ps))),128))]),L.value>F.value?(l(),G(fe,{key:0,"current-page":C.value,"onUpdate:currentPage":s[2]||(s[2]=t=>C.value=t),"page-size":F.value,total:L.value,layout:"prev, pager, next",class:"pagination",onCurrentChange:pe},null,8,["current-page","page-size","total"])):y("",!0)])):(l(),r("div",$s,[o(X,{description:"æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ­Œæ›²"},{image:i(()=>[o(h,{class:"empty-icon"},{default:i(()=>[o(g(Be))]),_:1})]),_:1})]))])):y("",!0)]),_:1}),o(Z,{name:"fade"},{default:i(()=>[!V.value&&c.value&&v.value==="artists"?(l(),r("div",Vs,[A.value.length>0?(l(),r("div",zs,[a("div",Ls,[a("h3",null,"æ‰¾åˆ° "+f(D.value)+" ä½æ­Œæ‰‹",1)]),a("div",As,[(l(!0),r(T,null,M(A.value,t=>(l(),r("div",{key:t.id,class:"artist-card",onClick:_=>W(t.id)},[a("div",Ms,[a("img",{src:t.avatar||Ks,class:"artist-avatar"},null,8,bs),a("div",Fs,[o(h,{class:"play-icon"},{default:i(()=>[o(g(De))]),_:1})])]),a("div",xs,[a("div",{class:"artist-name",innerHTML:R(t.name)},null,8,Us),a("div",Bs,f(t.region||"æœªçŸ¥åœ°åŒº"),1)])],8,Ps))),128))])])):(l(),r("div",Ds,[o(X,{description:"æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ­Œæ‰‹"},{image:i(()=>[o(h,{class:"empty-icon"},{default:i(()=>[o(g(Ee))]),_:1})]),_:1})]))])):y("",!0)]),_:1}),o(je,{modelValue:K.value,"onUpdate:modelValue":s[3]||(s[3]=t=>K.value=t),"song-id":q.value,onSuccess:ge},null,8,["modelValue","song-id"])])}}},Xs=we(Ns,[["__scopeId","data-v-40fc487e"]]);export{Xs as default};
