import{m as a,q as l,t as e,H as t,B as i,a8 as s,r as o,h as n,d as r,am as c,al as d,D as u,A as p,F as y,G as g,Y as m,L as v}from"./vue-vendor-BzZaYQKc.js";import{u as f,g as h,d as C,c as P,a as k}from"./player-BodKjA0D.js";import{g as b,c as z,r as w}from"./favorite-CBOsHs95.js";import{P as D,s as _,u as S,c as T,b as V,d as F}from"./PlaylistCover-D3NetioR.js";import{ad as x,ae as A,af as U,ag as H,a3 as L,ah as $,a5 as j,ai as M,a4 as B,L as R,$ as N,P as E}from"./element-plus-CCPVPfgN.js";import{P as q}from"./PlaylistSelector-BQ_G-bWe.js";import{_ as I}from"./index-Cb8xoRiw.js";import"./song-C8TMBuSO.js";import"./request-76E38DvM.js";const G={class:"my-music"},Y={class:"tab-content"},J={class:"stats-bar"},K={class:"stats-item"},O={class:"favorites-list"},Q=["onClick"],W=["src"],X={class:"song-info"},Z={class:"song-name"},aa={class:"song-artist"},la=["onClick"],ea={key:0},ta={key:0},ia={class:"song-duration"},sa={class:"favorite-time"},oa={class:"song-actions"},na={key:0,class:"empty-state"},ra={key:1,class:"loading-state"},ca={class:"tab-content"},da={class:"stats-bar"},ua={class:"stats-item"},pa={class:"history-list"},ya=["onClick"],ga=["src"],ma={class:"song-info"},va={class:"song-name"},fa={class:"song-artist"},ha=["onClick"],Ca={key:0},Pa={key:0},ka={class:"play-info"},ba={class:"play-time"},za={key:0,class:"play-count"},wa={class:"song-actions"},Da={key:0,class:"empty-state"},_a={key:1,class:"loading-state"},Sa={class:"tab-content"},Ta={class:"playlist-header"},Va={class:"header-info"},Fa={class:"count-info"},xa={key:0,class:"playlist-grid"},Aa=["onClick"],Ua={class:"playlist-cover-wrapper"},Ha={class:"playlist-overlay"},La={class:"playlist-info"},$a=["title"],ja={class:"playlist-meta"},Ma={key:0,class:"playlist-desc"},Ba={key:1,class:"empty-state"},Ra={class:"dialog-footer"};const Na=I({name:"MyMusic",components:{PlaylistCover:D,PlaylistSelector:q,Loading:B,Star:M,Clock:j,Plus:$,CaretRight:L,MoreFilled:H,Edit:U,View:A,Delete:x},setup(){const a=d(),l=c(),e=f(),t=o("favorites"),i=o([]),s=o([]),u=o(!1),p=o(0),y=o(0),g=n({page:1,size:20,total:0}),m=n({page:1,size:20,total:0}),v=o([]),D=o(1),x=o(12),A=o(0),U=o(!1),H=o("创建歌单"),L=n({id:null,name:"",description:"",cover:"",category:"",isPublic:!1}),$=o(!1),j=o(null),M=async()=>{u.value=!0;try{const a=await b({page:g.page-1,size:g.size});200===a.code&&(i.value=a.data.content||[],g.total=a.data.totalElements||0)}catch(a){console.error("加载收藏失败:",a),R.error("加载收藏失败")}finally{u.value=!1}},B=async()=>{try{const a=await z();200===a.code&&(p.value=a.data.count||0)}catch(a){console.error("加载收藏数量失败:",a)}},E=async()=>{u.value=!0;try{const a=await h({page:m.page-1,size:m.size});200===a.code&&(s.value=a.data.content||[],m.total=a.data.totalElements||0)}catch(a){console.error("加载播放历史失败:",a),R.error("加载播放历史失败")}finally{u.value=!1}},q=async()=>{try{const a=await k();200===a.code&&(y.value=a.data.count||0)}catch(a){console.error("加载播放历史数量失败:",a)}},I=async()=>{u.value=!0;try{const a=await V({page:D.value-1,size:x.value});200===a.code&&(v.value=a.data.content||[],A.value=a.data.totalElements||0)}catch(a){console.error("加载歌单失败:",a),R.error("加载歌单失败")}finally{u.value=!1}},G=async a=>{try{200===(await F(a)).code&&(R.success("删除成功"),I())}catch(l){R.error("删除失败")}};return r(()=>{const a=l.query.tab;a&&["favorites","history","playlists"].includes(a)&&(t.value=a),"favorites"===t.value&&(M(),B())}),{activeTab:t,favorites:i,playHistory:s,loading:u,favoriteCount:p,historyCount:y,favoritePagination:g,historyPagination:m,defaultCover:"https://via.placeholder.com/60?text=Music",handleTabClick:a=>{console.log("切换到:",a.props.name),"favorites"===a.props.name?(M(),B()):"history"===a.props.name?(E(),q()):"playlists"===a.props.name&&I()},handlePlaySong:a=>{if(!a)return;const l=i.value.map(a=>a.song);e.play(a,l)},handleAddToPlaylist:a=>{a&&(e.addToPlaylist(a),R.success("已添加到播放列表"))},handleRemoveFavorite:async a=>{try{await N.confirm("确定要取消收藏这首歌曲吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});200===(await w(a)).code&&(R.success("取消收藏成功"),M(),B())}catch(l){"cancel"!==l&&R.error("取消收藏失败")}},handleClearHistory:async()=>{try{await N.confirm("确定要清空所有播放历史吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});200===(await P()).code&&(R.success("清空成功"),E(),q())}catch(a){"cancel"!==a&&R.error("清空失败")}},handleDeleteHistory:async a=>{try{200===(await C(a)).code&&(R.success("删除成功"),E(),q())}catch(l){R.error("删除失败")}},goToArtist:l=>{l&&a.push(`/artist/${l}`)},formatDuration:a=>{if(!a)return"00:00";return`${Math.floor(a/60)}:${(a%60).toString().padStart(2,"0")}`},formatDate:a=>{if(!a)return"-";const l=new Date(a),e=new Date-l;return e<6e4?"刚刚":e<36e5?`${Math.floor(e/6e4)}分钟前`:e<864e5?`${Math.floor(e/36e5)}小时前`:e<6048e5?`${Math.floor(e/864e5)}天前`:l.toLocaleDateString("zh-CN")},formatDateTime:a=>{if(!a)return"-";const l=new Date(a),e=new Date,t=e-l;if(l.toDateString()===e.toDateString())return"今天 "+l.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});const i=new Date(e);if(i.setDate(i.getDate()-1),l.toDateString()===i.toDateString())return"昨天 "+l.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});if(t<6048e5){return["周日","周一","周二","周三","周四","周五","周六"][l.getDay()]+" "+l.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}return l.toLocaleDateString("zh-CN")+" "+l.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})},loadFavorites:M,loadPlayHistory:E,playlists:v,playlistPage:D,playlistPageSize:x,playlistTotal:A,defaultPlaylistCover:"https://via.placeholder.com/200?text=Playlist",playlistDialogVisible:U,playlistDialogTitle:H,playlistForm:L,playlistCategories:["流行","摇滚","民谣","电子","纯音乐","其他"],loadPlaylists:I,showCreatePlaylistDialog:()=>{H.value="创建歌单",L.id=null,L.name="",L.description="",L.cover="",L.category="",L.isPublic=!1,U.value=!0},editPlaylist:a=>{H.value="编辑歌单",L.id=a.id,L.name=a.name,L.description=a.description||"",L.cover=a.cover||"",L.category=a.category||"",L.isPublic=a.isPublic||!1,U.value=!0},savePlaylist:async()=>{if(L.name.trim())try{const a={name:L.name,description:L.description,cover:L.cover,category:L.category,isPublic:L.isPublic};let l;l=L.id?await S(L.id,a):await T(a),200===l.code&&(R.success(l.message||(L.id?"更新成功":"创建成功")),U.value=!1,I())}catch(a){R.error(L.id?"更新失败":"创建失败")}else R.warning("请输入歌单名称")},confirmDeletePlaylist:async a=>{try{await N.confirm(`确定要删除歌单"${a.name}"吗？删除后将无法恢复！`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),await G(a.id)}catch{}},togglePlaylistVisibility:async a=>{try{const l=await _(a.id,!a.isPublic);200===l.code&&(R.success(l.message||"设置成功"),I())}catch(l){R.error("设置失败")}},goToPlaylistDetail:l=>{a.push(`/playlist/${l}`)},playlistSelectorVisible:$,selectedSongId:j,showAddToPlaylistDialog:a=>{a&&(j.value=a,$.value=!0)},handleAddSuccess:()=>{}}}},[["render",function(o,n,r,c,d,f){const h=s("Star"),C=s("el-icon"),P=s("el-button"),k=s("el-empty"),b=s("Loading"),z=s("el-pagination"),w=s("el-tab-pane"),D=s("Clock"),_=s("Plus"),S=s("PlaylistCover"),T=s("CaretRight"),V=s("el-tag"),F=s("MoreFilled"),x=s("Edit"),A=s("el-dropdown-item"),U=s("View"),H=s("Delete"),L=s("el-dropdown-menu"),$=s("el-dropdown"),j=s("el-tabs"),M=s("el-input"),B=s("el-form-item"),R=s("el-option"),N=s("el-select"),q=s("el-switch"),I=s("el-form"),Na=s("el-dialog"),Ea=s("PlaylistSelector");return l(),a("div",G,[n[32]||(n[32]=e("div",{class:"page-header"},[e("h2",null,"🎵 我的音乐"),e("p",{class:"subtitle"},"我的收藏、播放历史和歌单管理")],-1)),t(j,{modelValue:c.activeTab,"onUpdate:modelValue":n[8]||(n[8]=a=>c.activeTab=a),class:"music-tabs",onTabClick:c.handleTabClick},{default:i(()=>[t(w,{label:"💖 我的收藏",name:"favorites"},{default:i(()=>[e("div",Y,[e("div",J,[e("span",K,[t(C,null,{default:i(()=>[t(h)]),_:1}),y(" 共 "+E(c.favoriteCount)+" 首收藏 ",1)])]),e("div",O,[(l(!0),a(g,null,m(c.favorites,i=>{var s,o,n,r,d;return l(),a("div",{key:i.id,class:"song-item",onClick:a=>c.handlePlaySong(i.song)},[e("img",{src:(null==(s=i.song)?void 0:s.cover)||c.defaultCover,alt:"封面",class:"song-cover"},null,8,W),e("div",X,[e("div",Z,E(null==(o=i.song)?void 0:o.title),1),e("div",aa,[(l(!0),a(g,null,m((null==(n=i.song)?void 0:n.artists)||[],(t,s)=>{var o,n;return l(),a(g,{key:t.id},[e("span",{class:"clickable",onClick:v(a=>c.goToArtist(t.id),["stop"])},E(t.name),9,la),s<((null==(n=null==(o=i.song)?void 0:o.artists)?void 0:n.length)||0)-1?(l(),a("span",ea," / ")):u("",!0)],64)}),128)),(null==(r=i.song)?void 0:r.artists)&&0!==i.song.artists.length?u("",!0):(l(),a("span",ta,"未知歌手"))])]),e("div",ia,E(c.formatDuration(null==(d=i.song)?void 0:d.duration)),1),e("div",sa,E(c.formatDate(i.createTime)),1),e("div",oa,[t(P,{icon:"CaretRight",circle:"",size:"small",onClick:v(a=>c.handlePlaySong(i.song),["stop"]),title:"播放"},null,8,["onClick"]),t(P,{icon:"Plus",circle:"",size:"small",onClick:v(a=>c.handleAddToPlaylist(i.song),["stop"]),title:"添加到播放列表"},null,8,["onClick"]),t(P,{icon:"FolderAdd",circle:"",size:"small",onClick:v(a=>c.showAddToPlaylistDialog(i.song.id),["stop"]),title:"添加到歌单"},null,8,["onClick"]),t(P,{icon:"Delete",circle:"",size:"small",type:"danger",onClick:v(a=>c.handleRemoveFavorite(i.song.id),["stop"]),title:"取消收藏"},null,8,["onClick"])])],8,Q)}),128))]),0!==c.favorites.length||c.loading?u("",!0):(l(),a("div",na,[t(k,{description:"还没有收藏歌曲"},{default:i(()=>[t(P,{type:"primary",onClick:n[0]||(n[0]=a=>o.$router.push("/home"))},{default:i(()=>[...n[18]||(n[18]=[y("去首页逛逛",-1)])]),_:1})]),_:1})])),c.loading?(l(),a("div",ra,[t(C,{class:"is-loading"},{default:i(()=>[t(b)]),_:1}),n[19]||(n[19]=e("p",null,"加载中...",-1))])):u("",!0),c.favoritePagination.total>c.favoritePagination.size?(l(),p(z,{key:2,"current-page":c.favoritePagination.page,"onUpdate:currentPage":n[1]||(n[1]=a=>c.favoritePagination.page=a),"page-size":c.favoritePagination.size,"onUpdate:pageSize":n[2]||(n[2]=a=>c.favoritePagination.size=a),total:c.favoritePagination.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:c.loadFavorites,onCurrentChange:c.loadFavorites,class:"pagination"},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])):u("",!0)])]),_:1}),t(w,{label:"🕒 播放历史",name:"history"},{default:i(()=>[e("div",ca,[e("div",da,[e("span",ua,[t(C,null,{default:i(()=>[t(D)]),_:1}),y(" 共 "+E(c.historyCount)+" 条播放记录 ",1)]),c.playHistory.length>0?(l(),p(P,{key:0,type:"danger",size:"small",onClick:c.handleClearHistory},{default:i(()=>[...n[20]||(n[20]=[y(" 清空历史 ",-1)])]),_:1},8,["onClick"])):u("",!0)]),e("div",pa,[(l(!0),a(g,null,m(c.playHistory,i=>{var s,o,n,r;return l(),a("div",{key:i.id,class:"history-item",onClick:a=>c.handlePlaySong(i.song)},[e("img",{src:(null==(s=i.song)?void 0:s.cover)||c.defaultCover,alt:"封面",class:"song-cover"},null,8,ga),e("div",ma,[e("div",va,E(null==(o=i.song)?void 0:o.title),1),e("div",fa,[(l(!0),a(g,null,m((null==(n=i.song)?void 0:n.artists)||[],(t,s)=>{var o,n;return l(),a(g,{key:t.id},[e("span",{class:"clickable",onClick:v(a=>c.goToArtist(t.id),["stop"])},E(t.name),9,ha),s<((null==(n=null==(o=i.song)?void 0:o.artists)?void 0:n.length)||0)-1?(l(),a("span",Ca," / ")):u("",!0)],64)}),128)),(null==(r=i.song)?void 0:r.artists)&&0!==i.song.artists.length?u("",!0):(l(),a("span",Pa,"未知歌手"))])]),e("div",ka,[e("div",ba,E(c.formatDateTime(i.playTime)),1),i.playCount&&i.playCount>1?(l(),a("div",za," 播放 "+E(i.playCount)+" 次 ",1)):u("",!0)]),e("div",wa,[t(P,{icon:"CaretRight",circle:"",size:"small",onClick:v(a=>c.handlePlaySong(i.song),["stop"]),title:"播放"},null,8,["onClick"]),t(P,{icon:"Plus",circle:"",size:"small",onClick:v(a=>c.handleAddToPlaylist(i.song),["stop"]),title:"添加到播放列表"},null,8,["onClick"]),t(P,{icon:"FolderAdd",circle:"",size:"small",onClick:v(a=>c.showAddToPlaylistDialog(i.song.id),["stop"]),title:"添加到歌单"},null,8,["onClick"]),t(P,{icon:"Delete",circle:"",size:"small",type:"danger",onClick:v(a=>c.handleDeleteHistory(i.id),["stop"]),title:"删除记录"},null,8,["onClick"])])],8,ya)}),128))]),0!==c.playHistory.length||c.loading?u("",!0):(l(),a("div",Da,[t(k,{description:"还没有播放记录"},{default:i(()=>[t(P,{type:"primary",onClick:n[3]||(n[3]=a=>o.$router.push("/home"))},{default:i(()=>[...n[21]||(n[21]=[y("去首页听歌",-1)])]),_:1})]),_:1})])),c.loading?(l(),a("div",_a,[t(C,{class:"is-loading"},{default:i(()=>[t(b)]),_:1}),n[22]||(n[22]=e("p",null,"加载中...",-1))])):u("",!0),c.historyPagination.total>c.historyPagination.size?(l(),p(z,{key:2,"current-page":c.historyPagination.page,"onUpdate:currentPage":n[4]||(n[4]=a=>c.historyPagination.page=a),"page-size":c.historyPagination.size,"onUpdate:pageSize":n[5]||(n[5]=a=>c.historyPagination.size=a),total:c.historyPagination.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:c.loadPlayHistory,onCurrentChange:c.loadPlayHistory,class:"pagination"},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])):u("",!0)])]),_:1}),t(w,{label:"📁 我的歌单",name:"playlists"},{default:i(()=>[e("div",Sa,[e("div",Ta,[e("div",Va,[n[23]||(n[23]=e("h3",null,"我的歌单",-1)),e("p",Fa,"共 "+E(c.playlistTotal)+" 个歌单",1)]),t(P,{type:"primary",onClick:c.showCreatePlaylistDialog},{default:i(()=>[t(C,null,{default:i(()=>[t(_)]),_:1}),n[24]||(n[24]=y(" 创建歌单 ",-1))]),_:1},8,["onClick"])]),c.playlists.length>0?(l(),a("div",xa,[(l(!0),a(g,null,m(c.playlists,s=>(l(),a("div",{key:s.id,class:"playlist-card",onClick:a=>c.goToPlaylistDetail(s.id)},[e("div",Ua,[t(S,{cover:s.cover,size:200,"default-cover":c.defaultPlaylistCover,class:"playlist-cover"},null,8,["cover","default-cover"]),e("div",Ha,[t(C,{class:"play-icon"},{default:i(()=>[t(T)]),_:1})])]),e("div",La,[e("h4",{class:"playlist-name",title:s.name},E(s.name),9,$a),e("p",ja,[e("span",null,E(s.songCount||0)+" 首歌曲",1),s.isPublic?(l(),p(V,{key:0,size:"small",type:"success"},{default:i(()=>[...n[25]||(n[25]=[y("公开",-1)])]),_:1})):(l(),p(V,{key:1,size:"small",type:"info"},{default:i(()=>[...n[26]||(n[26]=[y("私有",-1)])]),_:1}))]),s.description?(l(),a("p",Ma,E(s.description),1)):u("",!0)]),e("div",{class:"playlist-actions",onClick:n[6]||(n[6]=v(()=>{},["stop"]))},[t($,{trigger:"click"},{dropdown:i(()=>[t(L,null,{default:i(()=>[t(A,{onClick:a=>c.editPlaylist(s)},{default:i(()=>[t(C,null,{default:i(()=>[t(x)]),_:1}),n[27]||(n[27]=y(" 编辑 ",-1))]),_:1},8,["onClick"]),t(A,{onClick:a=>c.togglePlaylistVisibility(s)},{default:i(()=>[t(C,null,{default:i(()=>[t(U)]),_:1}),y(" "+E(s.isPublic?"设为私有":"设为公开"),1)]),_:2},1032,["onClick"]),t(A,{onClick:a=>c.confirmDeletePlaylist(s),divided:""},{default:i(()=>[t(C,null,{default:i(()=>[t(H)]),_:1}),n[28]||(n[28]=y(" 删除 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),default:i(()=>[t(P,{circle:"",size:"small"},{default:i(()=>[t(C,null,{default:i(()=>[t(F)]),_:1})]),_:1})]),_:2},1024)])],8,Aa))),128))])):(l(),a("div",Ba,[t(k,{description:"还没有创建歌单"},{default:i(()=>[t(P,{type:"primary",onClick:c.showCreatePlaylistDialog},{default:i(()=>[...n[29]||(n[29]=[y("创建我的第一个歌单",-1)])]),_:1},8,["onClick"])]),_:1})])),c.playlistTotal>c.playlistPageSize?(l(),p(z,{key:2,"current-page":c.playlistPage,"onUpdate:currentPage":n[7]||(n[7]=a=>c.playlistPage=a),"page-size":c.playlistPageSize,total:c.playlistTotal,layout:"prev, pager, next",class:"pagination",onCurrentChange:c.loadPlaylists},null,8,["current-page","page-size","total","onCurrentChange"])):u("",!0)])]),_:1})]),_:1},8,["modelValue","onTabClick"]),t(Na,{modelValue:c.playlistDialogVisible,"onUpdate:modelValue":n[15]||(n[15]=a=>c.playlistDialogVisible=a),title:c.playlistDialogTitle,width:"500px",onClose:n[16]||(n[16]=a=>c.playlistDialogVisible=!1)},{footer:i(()=>[e("span",Ra,[t(P,{onClick:n[14]||(n[14]=a=>c.playlistDialogVisible=!1)},{default:i(()=>[...n[30]||(n[30]=[y("取消",-1)])]),_:1}),t(P,{type:"primary",onClick:c.savePlaylist},{default:i(()=>[...n[31]||(n[31]=[y("保存",-1)])]),_:1},8,["onClick"])])]),default:i(()=>[t(I,{model:c.playlistForm,"label-width":"80px"},{default:i(()=>[t(B,{label:"歌单名称",required:""},{default:i(()=>[t(M,{modelValue:c.playlistForm.name,"onUpdate:modelValue":n[9]||(n[9]=a=>c.playlistForm.name=a),placeholder:"请输入歌单名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(B,{label:"歌单简介"},{default:i(()=>[t(M,{modelValue:c.playlistForm.description,"onUpdate:modelValue":n[10]||(n[10]=a=>c.playlistForm.description=a),type:"textarea",rows:3,placeholder:"介绍一下这个歌单吧~",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(B,{label:"分类"},{default:i(()=>[t(N,{modelValue:c.playlistForm.category,"onUpdate:modelValue":n[11]||(n[11]=a=>c.playlistForm.category=a),placeholder:"选择歌单分类"},{default:i(()=>[(l(!0),a(g,null,m(c.playlistCategories,a=>(l(),p(R,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(B,{label:"封面图片"},{default:i(()=>[t(M,{modelValue:c.playlistForm.cover,"onUpdate:modelValue":n[12]||(n[12]=a=>c.playlistForm.cover=a),placeholder:"请输入封面图片URL（选填）"},null,8,["modelValue"])]),_:1}),t(B,{label:"是否公开"},{default:i(()=>[t(q,{modelValue:c.playlistForm.isPublic,"onUpdate:modelValue":n[13]||(n[13]=a=>c.playlistForm.isPublic=a),"active-text":"公开到歌单广场","inactive-text":"仅自己可见"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(Ea,{modelValue:c.playlistSelectorVisible,"onUpdate:modelValue":n[17]||(n[17]=a=>c.playlistSelectorVisible=a),"song-id":c.selectedSongId,onSuccess:c.handleAddSuccess},null,8,["modelValue","song-id","onSuccess"])])}],["__scopeId","data-v-b832adb5"]]);export{Na as default};
