import{_ as ke,h as r,v as z,j as we,c as o,o as n,a as d,d as t,w as l,e as c,r as i,m as f,au as le,ag as se,ah as Ce,A as ne,a4 as Re,F as A,D as M,z as Fe,k as E,H as he,f as qe,a3 as Ve,E as y,u as be,X as j,t as _,O as xe}from"./index-BnXTIBkP.js";import{u as Te,s as Se,a as $e,d as Be,b as De,r as Ne,c as Ue}from"./social-D7Vrj7ss.js";const ze={class:"friends-page"},Ae={class:"page-header"},Me={class:"header-actions"},Ee={class:"friends-list"},je={key:0,class:"empty-state"},Ke={key:1,class:"friends-grid"},Le={class:"friend-info"},He=["onClick"],Ie={class:"friend-username"},Oe={class:"friend-actions"},Xe={class:"requests-list"},Ge={key:0,class:"empty-state"},Je={key:1,class:"request-items"},Pe={class:"request-info"},Qe={class:"request-name"},We={class:"request-time"},Ye={key:0,class:"request-remark"},Ze={class:"request-actions"},et={key:0,class:"search-results"},tt={class:"result-info"},at={class:"result-name"},lt={class:"result-username"},st={key:1,class:"empty-results"},nt={__name:"Friends",setup(ot){const b=be(),v=Te(),K=r("friends"),R=r(!1),F=r(!1),L=z(()=>v.friends),H=z(()=>v.friendRequests),I=z(()=>v.friendRequestCount),g=r(!1),k=r(""),h=r([]),q=r(!1),x=r(!1),T=r(null),w=r(!1),S=r(null),V=r(""),$=r(!1),p=r(null),oe=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",de=s=>{s==="friends"?O():s==="requests"&&X()},O=async()=>{R.value=!0,await v.loadFriends(),R.value=!1},X=async()=>{F.value=!0,await v.loadFriendRequests(),F.value=!1},B=async()=>{if(!k.value.trim()){y.warning("请输入搜索关键词");return}q.value=!0,x.value=!0;try{const s=await Se(k.value.trim());s.code===200&&(h.value=s.data||[])}catch(s){console.error("搜索用户失败:",s)}finally{q.value=!1}},re=async s=>{T.value=s;try{(await Ue({friendId:s})).code===200&&(y.success("好友请求已发送"),g.value=!1,k.value="",h.value=[],x.value=!1)}catch(e){console.error("发送好友请求失败:",e)}finally{T.value=null}},ie=async s=>{p.value=s;try{(await De(s)).code===200&&(y.success("已接受好友请求"),await v.loadFriendRequests(),await v.loadFriends())}catch(e){console.error("接受好友请求失败:",e)}finally{p.value=null}},ue=async s=>{p.value=s;try{(await Ne(s)).code===200&&(y.success("已拒绝好友请求"),await v.loadFriendRequests())}catch(e){console.error("拒绝好友请求失败:",e)}finally{p.value=null}},ce=async({action:s,friendship:e})=>{if(s==="remark")S.value=e,V.value=e.remark||"",w.value=!0;else if(s==="delete")try{await xe.confirm("确定要删除该好友吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await Be(e.id)).code===200&&(y.success("已删除好友"),await v.loadFriends())}catch(u){u!=="cancel"&&console.error("删除好友失败:",u)}},me=async()=>{if(S.value){$.value=!0;try{(await $e(S.value.id,V.value)).code===200&&(y.success("备注设置成功"),w.value=!1,await v.loadFriends())}catch(s){console.error("设置备注失败:",s)}finally{$.value=!1}}},D=s=>{b.push(`/chat/${s}`)},ve=()=>{b.push("/moments")},fe=()=>{b.push("/share-square")};return we(()=>{O(),X()}),(s,e)=>{const u=i("el-icon"),m=i("el-button"),N=i("el-empty"),U=i("el-avatar"),G=i("el-dropdown-item"),_e=i("el-dropdown-menu"),pe=i("el-dropdown"),J=i("el-tab-pane"),ye=i("el-badge"),ge=i("el-tabs"),P=i("el-input"),Q=i("el-form-item"),W=i("el-form"),Y=i("el-dialog"),Z=Re("loading");return n(),o("div",ze,[d("div",Ae,[e[11]||(e[11]=d("h2",null,"我的好友",-1)),d("div",Me,[t(m,{text:"",onClick:ve},{default:l(()=>[t(u,null,{default:l(()=>[t(f(le))]),_:1}),e[8]||(e[8]=c(" 好友动态 ",-1))]),_:1}),t(m,{text:"",onClick:fe},{default:l(()=>[t(u,null,{default:l(()=>[t(f(se))]),_:1}),e[9]||(e[9]=c(" 分享广场 ",-1))]),_:1}),t(m,{type:"primary",onClick:e[0]||(e[0]=a=>g.value=!0)},{default:l(()=>[t(u,null,{default:l(()=>[t(f(Ce))]),_:1}),e[10]||(e[10]=c(" 添加好友 ",-1))]),_:1})])]),t(ge,{modelValue:K.value,"onUpdate:modelValue":e[1]||(e[1]=a=>K.value=a),onTabChange:de},{default:l(()=>[t(J,{label:"好友列表",name:"friends"},{default:l(()=>[ne((n(),o("div",Ee,[L.value.length===0&&!R.value?(n(),o("div",je,[t(N,{description:"暂无好友，快去添加好友吧~"})])):(n(),o("div",Ke,[(n(!0),o(A,null,M(L.value,a=>{var C,ee,te;return n(),o("div",{key:a.id,class:"friend-card"},[t(U,{src:a.friendAvatar||((C=a.friend)==null?void 0:C.avatar),size:60,onClick:ae=>D(a.friendId)},{default:l(()=>[t(u,null,{default:l(()=>[t(f(j))]),_:1})]),_:1},8,["src","onClick"]),d("div",Le,[d("div",{class:"friend-name",onClick:ae=>D(a.friendId)},_(a.remark||a.friendName||((ee=a.friend)==null?void 0:ee.nickname)),9,He),d("div",Ie," @"+_((te=a.friend)==null?void 0:te.username),1)]),d("div",Oe,[t(m,{text:"",type:"primary",onClick:ae=>D(a.friendId)},{default:l(()=>[t(u,null,{default:l(()=>[t(f(le))]),_:1}),e[12]||(e[12]=c(" 聊天 ",-1))]),_:1},8,["onClick"]),t(pe,{onCommand:ce},{dropdown:l(()=>[t(_e,null,{default:l(()=>[t(G,{command:{action:"remark",friendship:a}},{default:l(()=>[...e[13]||(e[13]=[c(" 设置备注 ",-1)])]),_:1},8,["command"]),t(G,{command:{action:"delete",friendship:a},divided:""},{default:l(()=>[...e[14]||(e[14]=[c(" 删除好友 ",-1)])]),_:1},8,["command"])]),_:2},1024)]),default:l(()=>[t(m,{text:""},{default:l(()=>[t(u,null,{default:l(()=>[t(f(se))]),_:1})]),_:1})]),_:2},1024)])])}),128))]))])),[[Z,R.value]])]),_:1}),t(J,{name:"requests"},{label:l(()=>[d("span",null,[e[15]||(e[15]=c(" 好友请求 ",-1)),I.value>0?(n(),Fe(ye,{key:0,value:I.value,type:"danger",class:"tab-badge"},null,8,["value"])):E("",!0)])]),default:l(()=>[ne((n(),o("div",Xe,[H.value.length===0&&!F.value?(n(),o("div",Ge,[t(N,{description:"暂无好友请求"})])):(n(),o("div",Je,[(n(!0),o(A,null,M(H.value,a=>(n(),o("div",{key:a.id,class:"request-item"},[t(U,{src:a.userAvatar,size:50},{default:l(()=>[t(u,null,{default:l(()=>[t(f(j))]),_:1})]),_:1},8,["src"]),d("div",Pe,[d("div",Qe,_(a.userName),1),d("div",We,_(oe(a.createTime)),1),a.remark?(n(),o("div",Ye," 备注："+_(a.remark),1)):E("",!0)]),d("div",Ze,[t(m,{type:"primary",onClick:C=>ie(a.id),loading:p.value===a.id},{default:l(()=>[...e[16]||(e[16]=[c(" 接受 ",-1)])]),_:1},8,["onClick","loading"]),t(m,{onClick:C=>ue(a.id),loading:p.value===a.id},{default:l(()=>[...e[17]||(e[17]=[c(" 拒绝 ",-1)])]),_:1},8,["onClick","loading"])])]))),128))]))])),[[Z,F.value]])]),_:1})]),_:1},8,["modelValue"]),t(Y,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=a=>g.value=a),title:"添加好友",width:"500px"},{footer:l(()=>[t(m,{onClick:e[3]||(e[3]=a=>g.value=!1)},{default:l(()=>[...e[19]||(e[19]=[c("取消",-1)])]),_:1})]),default:l(()=>[t(W,{onSubmit:he(B,["prevent"])},{default:l(()=>[t(Q,{label:"搜索用户"},{default:l(()=>[t(P,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=a=>k.value=a),placeholder:"输入用户名或昵称",onKeyup:qe(B,["enter"])},{append:l(()=>[t(m,{onClick:B,loading:q.value},{default:l(()=>[t(u,null,{default:l(()=>[t(f(Ve))]),_:1})]),_:1},8,["loading"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),h.value.length>0?(n(),o("div",et,[(n(!0),o(A,null,M(h.value,a=>(n(),o("div",{key:a.id,class:"search-result-item"},[t(U,{src:a.avatar,size:40},{default:l(()=>[t(u,null,{default:l(()=>[t(f(j))]),_:1})]),_:1},8,["src"]),d("div",tt,[d("div",at,_(a.nickname||a.username),1),d("div",lt,"@"+_(a.username),1)]),t(m,{type:"primary",size:"small",onClick:C=>re(a.id),loading:T.value===a.id},{default:l(()=>[...e[18]||(e[18]=[c(" 添加好友 ",-1)])]),_:1},8,["onClick","loading"])]))),128))])):x.value&&!q.value?(n(),o("div",st,[t(N,{description:"未找到相关用户"})])):E("",!0)]),_:1},8,["modelValue"]),t(Y,{modelValue:w.value,"onUpdate:modelValue":e[7]||(e[7]=a=>w.value=a),title:"设置备注",width:"400px"},{footer:l(()=>[t(m,{onClick:e[6]||(e[6]=a=>w.value=!1)},{default:l(()=>[...e[20]||(e[20]=[c("取消",-1)])]),_:1}),t(m,{type:"primary",onClick:me,loading:$.value},{default:l(()=>[...e[21]||(e[21]=[c(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(W,null,{default:l(()=>[t(Q,{label:"备注名"},{default:l(()=>[t(P,{modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=a=>V.value=a),placeholder:"输入备注名",maxlength:"20"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},it=ke(nt,[["__scopeId","data-v-d97fe606"]]);export{it as default};
