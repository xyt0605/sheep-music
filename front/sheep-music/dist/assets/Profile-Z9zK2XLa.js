import{_ as q,c as M,o as R,a as d,d as o,w as s,r as f,f as H,g as _,x as J,h as z,E as c,e as u,t as b,B}from"./index-CxmcMKp9.js";import{u as N,a as O}from"./user-DCYChDsB.js";const T={name:"Profile",setup(){const p=H(),a=_(null),V=_(null),e=_(!1),y=_(!1),h=_(!1),P=_(!1),n=_(!1),U="/api/upload/avatar",k=J(()=>({Authorization:`Bearer ${localStorage.getItem("token")}`})),w=z({nickname:"",email:"",avatar:""}),i=z({oldPassword:"",newPassword:"",confirmPassword:""});return{userStore:p,editFormRef:a,passwordFormRef:V,editDialogVisible:e,passwordDialogVisible:y,editLoading:h,passwordLoading:P,uploadLoading:n,uploadAction:U,uploadHeaders:k,editForm:w,passwordForm:i,editRules:{nickname:[{required:!0,message:"è¯·è¾“å…¥æ˜µç§°",trigger:"blur"},{min:1,max:50,message:"æ˜µç§°é•¿åº¦ä¸º1-50ä¸ªå­—ç¬¦",trigger:"blur"}],email:[{validator:(r,t,m)=>{t&&!/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/.test(t)?m(new Error("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")):m()},trigger:"blur"}]},passwordRules:{oldPassword:[{required:!0,message:"è¯·è¾“å…¥æ—§å¯†ç ",trigger:"blur"}],newPassword:[{required:!0,message:"è¯·è¾“å…¥æ–°å¯†ç ",trigger:"blur"},{min:6,max:20,message:"å¯†ç é•¿åº¦ä¸º6-20ä¸ªå­—ç¬¦",trigger:"blur"}],confirmPassword:[{required:!0,message:"è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ",trigger:"blur"},{validator:(r,t,m)=>{t!==i.newPassword?m(new Error("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´")):m()},trigger:"blur"}]},formatDate:r=>r?new Date(r).toLocaleDateString("zh-CN"):"æœªçŸ¥",showEditDialog:()=>{var r,t,m;w.nickname=((r=p.userInfo)==null?void 0:r.nickname)||"",w.email=((t=p.userInfo)==null?void 0:t.email)||"",w.avatar=((m=p.userInfo)==null?void 0:m.avatar)||"",e.value=!0},showPasswordDialog:()=>{i.oldPassword="",i.newPassword="",i.confirmPassword="",y.value=!0},handleEditSubmit:async()=>{a.value&&await a.value.validate(async r=>{if(r)try{h.value=!0;const t=await N({nickname:w.nickname,email:w.email||null,avatar:w.avatar||null});p.setUserInfo(t.data),c.success("èµ„æ–™æ›´æ–°æˆåŠŸ"),e.value=!1}catch(t){c.error(t.message||"æ›´æ–°å¤±è´¥")}finally{h.value=!1}})},handlePasswordSubmit:async()=>{V.value&&await V.value.validate(async r=>{if(r)try{P.value=!0,await O({oldPassword:i.oldPassword,newPassword:i.newPassword}),c.success("å¯†ç ä¿®æ”¹æˆåŠŸ"),y.value=!1,i.oldPassword="",i.newPassword="",i.confirmPassword=""}catch(t){c.error(t.message||"ä¿®æ”¹å¤±è´¥")}finally{P.value=!1}})},beforeAvatarUpload:r=>{const t=r.type.startsWith("image/"),m=r.size/1024/1024<2;return t?m?!0:(c.error("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 2MB!"),!1):(c.error("åªèƒ½ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶!"),!1)},handleUploadProgress:()=>{n.value=!0},handleAvatarSuccess:r=>{n.value=!1;const t=r&&r.data&&r.data.url||r&&r.url;if(t){const m={...p.userInfo,avatar:t};p.setUserInfo(m),N({avatar:t}).then(()=>{c.success("å¤´åƒæ›´æ–°æˆåŠŸ")}).catch(()=>{c.warning("å¤´åƒæ˜¾ç¤ºæˆåŠŸï¼Œä½†åŒæ­¥å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢")})}else c.error(r&&r.message||"ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•")},handleUploadError:r=>{n.value=!1;try{const t=JSON.parse(r.message);c.error(t.message||"ä¸Šä¼ å¤±è´¥")}catch{c.error("ä¸Šä¼ å¤±è´¥")}}}}},W={class:"profile-page"},j={class:"user-info-card"},G={class:"user-basic-info"},K={class:"avatar-container"},Q={class:"user-details"},X={class:"username"},Y={class:"info-list"},Z={class:"info-item"},$={class:"value"},ee={class:"info-item"},ae={class:"value"},oe={class:"actions"},se={class:"avatar-edit"},le={class:"avatar-actions"},re={class:"dialog-footer"},te={class:"dialog-footer"};function de(p,a,V,e,y,h){const P=f("el-avatar"),n=f("el-button"),U=f("el-upload"),k=f("el-tag"),w=f("el-divider"),i=f("el-card"),g=f("el-input"),v=f("el-form-item"),L=f("el-text"),F=f("el-form"),S=f("el-dialog");return R(),M("div",W,[a[21]||(a[21]=d("div",{class:"page-header"},[d("h2",null,"ğŸ‘¤ ä¸ªäººä¸­å¿ƒ"),d("p",{class:"subtitle"},"ç®¡ç†ä½ çš„ä¸ªäººä¿¡æ¯")],-1)),d("div",j,[o(i,{shadow:"hover"},{default:s(()=>{var l,D,x,E,I;return[d("div",G,[d("div",K,[o(P,{size:100,src:(l=e.userStore.userInfo)==null?void 0:l.avatar},{default:s(()=>{var C,A;return[u(b((A=(C=e.userStore.userInfo)==null?void 0:C.nickname)==null?void 0:A.charAt(0)),1)]}),_:1},8,["src"]),o(U,{class:"avatar-uploader",action:e.uploadAction,headers:e.uploadHeaders,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload,"on-progress":e.handleUploadProgress,"on-error":e.handleUploadError},{default:s(()=>[o(n,{size:"small",type:"primary",loading:e.uploadLoading},{default:s(()=>[u(b(e.uploadLoading?"ä¸Šä¼ ä¸­...":"æ›´æ¢å¤´åƒ"),1)]),_:1},8,["loading"])]),_:1},8,["action","headers","on-success","before-upload","on-progress","on-error"])]),d("div",Q,[d("h3",null,b((D=e.userStore.userInfo)==null?void 0:D.nickname),1),d("p",X,"@"+b((x=e.userStore.userInfo)==null?void 0:x.username),1),e.userStore.isAdmin?(R(),B(k,{key:0,type:"danger",size:"small"},{default:s(()=>[...a[10]||(a[10]=[u("ç®¡ç†å‘˜",-1)])]),_:1})):(R(),B(k,{key:1,type:"success",size:"small"},{default:s(()=>[...a[11]||(a[11]=[u("æ™®é€šç”¨æˆ·",-1)])]),_:1}))])]),o(w),d("div",Y,[d("div",Z,[a[12]||(a[12]=d("span",{class:"label"},"é‚®ç®±ï¼š",-1)),d("span",$,b(((E=e.userStore.userInfo)==null?void 0:E.email)||"æœªè®¾ç½®"),1)]),d("div",ee,[a[13]||(a[13]=d("span",{class:"label"},"æ³¨å†Œæ—¶é—´ï¼š",-1)),d("span",ae,b(e.formatDate((I=e.userStore.userInfo)==null?void 0:I.createdAt)),1)])]),o(w),d("div",oe,[o(n,{type:"primary",onClick:e.showEditDialog},{default:s(()=>[...a[14]||(a[14]=[u("ç¼–è¾‘èµ„æ–™",-1)])]),_:1},8,["onClick"]),o(n,{onClick:e.showPasswordDialog},{default:s(()=>[...a[15]||(a[15]=[u("ä¿®æ”¹å¯†ç ",-1)])]),_:1},8,["onClick"])])]}),_:1})]),o(S,{modelValue:e.editDialogVisible,"onUpdate:modelValue":a[4]||(a[4]=l=>e.editDialogVisible=l),title:"ç¼–è¾‘èµ„æ–™",width:"500px","close-on-click-modal":!1},{footer:s(()=>[d("span",re,[o(n,{onClick:a[3]||(a[3]=l=>e.editDialogVisible=!1)},{default:s(()=>[...a[17]||(a[17]=[u("å–æ¶ˆ",-1)])]),_:1}),o(n,{type:"primary",loading:e.editLoading,onClick:e.handleEditSubmit},{default:s(()=>[...a[18]||(a[18]=[u(" ç¡®å®š ",-1)])]),_:1},8,["loading","onClick"])])]),default:s(()=>[o(F,{ref:"editFormRef",model:e.editForm,rules:e.editRules,"label-width":"80px"},{default:s(()=>[o(v,{label:"æ˜µç§°",prop:"nickname"},{default:s(()=>[o(g,{modelValue:e.editForm.nickname,"onUpdate:modelValue":a[0]||(a[0]=l=>e.editForm.nickname=l),placeholder:"è¯·è¾“å…¥æ˜µç§°",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(v,{label:"é‚®ç®±",prop:"email"},{default:s(()=>[o(g,{modelValue:e.editForm.email,"onUpdate:modelValue":a[1]||(a[1]=l=>e.editForm.email=l),placeholder:"è¯·è¾“å…¥é‚®ç®±",type:"email"},null,8,["modelValue"])]),_:1}),o(v,{label:"å¤´åƒ",prop:"avatar"},{default:s(()=>[d("div",se,[o(P,{size:80,src:e.editForm.avatar},{default:s(()=>{var l;return[u(b((l=e.editForm.nickname)==null?void 0:l.charAt(0)),1)]}),_:1},8,["src"]),d("div",le,[o(g,{modelValue:e.editForm.avatar,"onUpdate:modelValue":a[2]||(a[2]=l=>e.editForm.avatar=l),placeholder:"å¤´åƒURLï¼ˆå¯é€‰ï¼Œå»ºè®®ä½¿ç”¨ä¸Šä¼ åŠŸèƒ½ï¼‰",type:"url",style:{"margin-bottom":"10px"}},null,8,["modelValue"]),o(L,{type:"info",size:"small"},{default:s(()=>[...a[16]||(a[16]=[u('æç¤ºï¼šå…³é—­å¯¹è¯æ¡†åï¼Œå¯ç‚¹å‡»ä¸ªäººä¸­å¿ƒçš„"æ›´æ¢å¤´åƒ"æŒ‰é’®ä¸Šä¼ å›¾ç‰‡',-1)])]),_:1})])])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),o(S,{modelValue:e.passwordDialogVisible,"onUpdate:modelValue":a[9]||(a[9]=l=>e.passwordDialogVisible=l),title:"ä¿®æ”¹å¯†ç ",width:"500px","close-on-click-modal":!1},{footer:s(()=>[d("span",te,[o(n,{onClick:a[8]||(a[8]=l=>e.passwordDialogVisible=!1)},{default:s(()=>[...a[19]||(a[19]=[u("å–æ¶ˆ",-1)])]),_:1}),o(n,{type:"primary",loading:e.passwordLoading,onClick:e.handlePasswordSubmit},{default:s(()=>[...a[20]||(a[20]=[u(" ç¡®å®š ",-1)])]),_:1},8,["loading","onClick"])])]),default:s(()=>[o(F,{ref:"passwordFormRef",model:e.passwordForm,rules:e.passwordRules,"label-width":"100px"},{default:s(()=>[o(v,{label:"æ—§å¯†ç ",prop:"oldPassword"},{default:s(()=>[o(g,{modelValue:e.passwordForm.oldPassword,"onUpdate:modelValue":a[5]||(a[5]=l=>e.passwordForm.oldPassword=l),type:"password",placeholder:"è¯·è¾“å…¥æ—§å¯†ç ","show-password":""},null,8,["modelValue"])]),_:1}),o(v,{label:"æ–°å¯†ç ",prop:"newPassword"},{default:s(()=>[o(g,{modelValue:e.passwordForm.newPassword,"onUpdate:modelValue":a[6]||(a[6]=l=>e.passwordForm.newPassword=l),type:"password",placeholder:"è¯·è¾“å…¥æ–°å¯†ç ï¼ˆ6-20ä¸ªå­—ç¬¦ï¼‰","show-password":""},null,8,["modelValue"])]),_:1}),o(v,{label:"ç¡®è®¤æ–°å¯†ç ",prop:"confirmPassword"},{default:s(()=>[o(g,{modelValue:e.passwordForm.confirmPassword,"onUpdate:modelValue":a[7]||(a[7]=l=>e.passwordForm.confirmPassword=l),type:"password",placeholder:"è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}const ue=q(T,[["render",de],["__scopeId","data-v-3bbb5aad"]]);export{ue as default};
