const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B7kMBwBV.js","assets/index-CfilBRBR.css"])))=>i.map(i=>d[i]);
import{_ as pe,q as Ae,v as X,h as I,x as me,r as C,a4 as ye,z as W,o as d,w as i,a as o,d as s,c as v,m as k,av as fe,t as D,e as O,A as te,k as L,F as ae,D as se,ac as je,E as V,W as de,g as Be,j as Fe,a1 as Ee,aw as Z,N as Je,ar as Ke,X as ie,f as He,H as We,ax as _e,u as qe,n as he,ay as Xe,O as Ge}from"./index-B7kMBwBV.js";import{u as Qe,g as ce,m as Me,e as Ye,f as Ze,h as et}from"./social-Df0Fl3Br.js";import{j as tt}from"./playlist-DhfKk8_j.js";import{w as ee}from"./client-uHrOqE3w.js";const at={class:"song-selector"},st={class:"search-box"},rt={key:0,class:"current-song"},nt={class:"image-error"},ot={class:"song-info"},lt={class:"song-name"},it={class:"song-artist"},ct={key:1,class:"empty-state"},dt={class:"song-list"},ut={key:0,class:"empty-state"},vt=["onClick"],ft={class:"image-error"},_t={class:"song-info"},ht={class:"song-name"},pt={class:"song-artist"},mt={class:"song-list"},yt={key:0,class:"empty-state"},wt=["onClick"],Ct={class:"image-error"},kt={class:"song-info"},It={class:"song-name"},St={class:"song-artist"},gt={__name:"SongSelector",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","select"],setup(re,{emit:F}){const q=re,x=F,R=Ae(),z=X({get:()=>q.modelValue,set:u=>x("update:modelValue",u)}),T=I("current"),g=I(""),N=I(!1),M=I([]);let A=null;const f=X(()=>{const u=R.currentSong;if(!u)return null;let l="未知歌手";return u.artist?l=Array.isArray(u.artist)?u.artist.join(", "):u.artist:u.artists?l=Array.isArray(u.artists)?u.artists.join(", "):u.artists:u.artistName&&(l=u.artistName),{...u,cover:u.cover||u.avatar||u.picUrl||"",artist:l}}),m=X(()=>(R.playlist||[]).map(l=>{let P="未知歌手";return l.artist?P=Array.isArray(l.artist)?l.artist.join(", "):l.artist:l.artists?P=Array.isArray(l.artists)?l.artists.join(", "):l.artists:l.artistName&&(P=l.artistName),{...l,cover:l.cover||l.avatar||l.picUrl||"",artist:P}})),$=u=>{u==="search"&&g.value&&b()},_=()=>{if(T.value!=="search"&&(T.value="search"),A&&clearTimeout(A),!g.value.trim()){M.value=[];return}A=setTimeout(()=>{b()},500)},b=async()=>{var u;if(!g.value.trim()){M.value=[];return}N.value=!0;try{const l=await je({keyword:g.value,page:0,size:20});if(l.code===200){const j=(((u=l.data)==null?void 0:u.content)||[]).map(p=>{let y="未知歌手";p.artist?Array.isArray(p.artist)?y=p.artist.map(h=>typeof h=="object"&&h!==null&&(h.name||h.artistName)||String(h)).join(", "):y=p.artist:p.artists?Array.isArray(p.artists)?y=p.artists.map(h=>typeof h=="object"&&h!==null&&(h.name||h.artistName)||String(h)).join(", "):y=p.artists:p.artistName&&(y=p.artistName);const K=p.name||p.songName||p.title||"未知歌曲";return{id:p.id,name:K,cover:p.cover||p.avatar||p.picUrl||"",artist:y}});M.value=j}}catch(l){console.error("搜索歌曲失败:",l),V.error("搜索失败")}finally{N.value=!1}},E=u=>{u&&(x("select",u),z.value=!1)},J=()=>{g.value="",M.value=[],T.value="current"};return me(z,u=>{u||J()}),(u,l)=>{const P=C("el-input"),j=C("el-icon"),p=C("el-image"),y=C("el-button"),K=C("el-empty"),h=C("el-tab-pane"),ue=C("el-tabs"),ve=C("el-dialog"),ne=ye("loading");return d(),W(ve,{modelValue:z.value,"onUpdate:modelValue":l[3]||(l[3]=S=>z.value=S),title:"选择歌曲",width:"600px",onClose:J},{default:i(()=>[o("div",at,[o("div",st,[s(P,{modelValue:g.value,"onUpdate:modelValue":l[0]||(l[0]=S=>g.value=S),placeholder:"搜索歌曲名称或歌手","prefix-icon":"Search",clearable:"",onInput:_},null,8,["modelValue"])]),s(ue,{modelValue:T.value,"onUpdate:modelValue":l[2]||(l[2]=S=>T.value=S),onTabChange:$},{default:i(()=>[s(h,{label:"当前播放",name:"current"},{default:i(()=>[f.value?(d(),v("div",rt,[o("div",{class:"song-item",onClick:l[1]||(l[1]=S=>E(f.value))},[s(p,{src:f.value.cover,fit:"cover",class:"song-cover"},{error:i(()=>[o("div",nt,[s(j,null,{default:i(()=>[s(k(fe))]),_:1})])]),_:1},8,["src"]),o("div",ot,[o("div",lt,D(f.value.name),1),o("div",it,D(f.value.artist),1)]),s(y,{type:"primary",size:"small"},{default:i(()=>[...l[4]||(l[4]=[O("选择",-1)])]),_:1})])])):(d(),v("div",ct,[s(K,{description:"当前没有播放歌曲"})]))]),_:1}),s(h,{label:"播放列表",name:"playlist"},{default:i(()=>[te((d(),v("div",dt,[m.value.length===0&&!N.value?(d(),v("div",ut,[s(K,{description:"播放列表为空"})])):L("",!0),(d(!0),v(ae,null,se(m.value,S=>(d(),v("div",{key:S.id,class:"song-item",onClick:oe=>E(S)},[s(p,{src:S.cover,fit:"cover",class:"song-cover"},{error:i(()=>[o("div",ft,[s(j,null,{default:i(()=>[s(k(fe))]),_:1})])]),_:1},8,["src"]),o("div",_t,[o("div",ht,D(S.name),1),o("div",pt,D(S.artist),1)]),s(y,{type:"primary",size:"small"},{default:i(()=>[...l[5]||(l[5]=[O("选择",-1)])]),_:1})],8,vt))),128))])),[[ne,N.value]])]),_:1}),s(h,{label:"搜索",name:"search"},{default:i(()=>[te((d(),v("div",mt,[M.value.length===0&&!N.value?(d(),v("div",yt,[s(K,{description:g.value?"没有找到相关歌曲":"请输入关键词搜索"},null,8,["description"])])):L("",!0),(d(!0),v(ae,null,se(M.value,S=>(d(),v("div",{key:S.id,class:"song-item",onClick:oe=>E(S)},[s(p,{src:S.cover,fit:"cover",class:"song-cover"},{error:i(()=>[o("div",Ct,[s(j,null,{default:i(()=>[s(k(fe))]),_:1})])]),_:1},8,["src"]),o("div",kt,[o("div",It,D(S.name),1),o("div",St,D(S.artist),1)]),s(y,{type:"primary",size:"small"},{default:i(()=>[...l[6]||(l[6]=[O("选择",-1)])]),_:1})],8,wt))),128))])),[[ne,N.value]])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])}}},$t=pe(gt,[["__scopeId","data-v-9d690710"]]),Dt={class:"playlist-selector"},bt={class:"search-box"},Vt={class:"playlist-list"},Nt={key:0,class:"empty-state"},xt=["onClick"],Tt={class:"image-error"},Mt={class:"playlist-info"},At={class:"playlist-name"},Rt={class:"playlist-desc"},zt={key:0},Pt={__name:"PlaylistShareSelector",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","select"],setup(re,{emit:F}){const q=re,x=F,R=X({get:()=>q.modelValue,set:_=>x("update:modelValue",_)}),z=I(!1),T=I([]),g=I(""),N=X(()=>{if(!g.value)return T.value;const _=g.value.toLowerCase();return T.value.filter(b=>b.name.toLowerCase().includes(_))}),M=_=>_>=1e4?(_/1e4).toFixed(1)+"万":_,A=async()=>{z.value=!0;try{const _=await tt();_.code===200&&(T.value=_.data||[])}catch(_){console.error("加载歌单失败:",_),V.error("加载歌单失败")}finally{z.value=!1}},f=_=>{_&&(x("select",_),R.value=!1)},m=()=>{V.info('请先在"我的歌单"页面创建歌单'),R.value=!1},$=()=>{g.value=""};return me(R,_=>{_?A():$()}),(_,b)=>{const E=C("el-input"),J=C("el-button"),u=C("el-empty"),l=C("el-icon"),P=C("el-image"),j=C("el-dialog"),p=ye("loading");return d(),W(j,{modelValue:R.value,"onUpdate:modelValue":b[1]||(b[1]=y=>R.value=y),title:"选择歌单",width:"600px",onClose:$},{default:i(()=>[o("div",Dt,[o("div",bt,[s(E,{modelValue:g.value,"onUpdate:modelValue":b[0]||(b[0]=y=>g.value=y),placeholder:"搜索歌单名称","prefix-icon":"Search",clearable:""},null,8,["modelValue"])]),te((d(),v("div",Vt,[N.value.length===0&&!z.value?(d(),v("div",Nt,[s(u,{description:"还没有歌单"},{default:i(()=>[s(J,{type:"primary",onClick:m},{default:i(()=>[...b[2]||(b[2]=[O("创建第一个歌单",-1)])]),_:1})]),_:1})])):L("",!0),(d(!0),v(ae,null,se(N.value,y=>(d(),v("div",{key:y.id,class:"playlist-item",onClick:K=>f(y)},[s(P,{src:y.cover,fit:"cover",class:"playlist-cover"},{error:i(()=>[o("div",Tt,[s(l,null,{default:i(()=>[s(k(de))]),_:1})])]),_:1},8,["src"]),o("div",Mt,[o("div",At,D(y.name),1),o("div",Rt,[o("span",null,D(y.songCount||0)+" 首歌曲",1),y.playCount?(d(),v("span",zt," · "+D(M(y.playCount))+" 次播放",1)):L("",!0)])]),s(J,{type:"primary",size:"small"},{default:i(()=>[...b[3]||(b[3]=[O("选择",-1)])]),_:1})],8,xt))),128))])),[[p,z.value]])])]),_:1},8,["modelValue"])}}},Ut=pe(Pt,[["__scopeId","data-v-9c08eef6"]]),Lt={class:"chat-page"},Ot={class:"conversation-list"},jt={class:"list-header"},Bt={class:"search-box"},Ft={class:"conversations"},Et={key:0,class:"empty-state"},Jt=["onClick"],Kt={class:"conv-info"},Ht={class:"conv-name"},Wt={class:"conv-message"},qt={class:"conv-time"},Xt={class:"chat-window"},Gt={key:0,class:"chat-container"},Qt={class:"chat-header"},Yt={class:"header-info"},Zt={class:"friend-name"},ea={key:0,class:"empty-messages"},ta={class:"message-content"},aa={key:0,class:"message-text"},sa=["onClick"],ra={class:"share-cover-error"},na={key:1,class:"share-cover-error"},oa={class:"share-content"},la={class:"share-title"},ia={class:"share-subtitle"},ca=["onClick"],da={class:"share-cover-error"},ua={key:1,class:"share-cover-error"},va={class:"share-content"},fa={class:"share-title"},_a={class:"share-subtitle"},ha={key:3,class:"message-recalled"},pa={class:"message-time"},ma={class:"chat-input"},ya={class:"input-actions"},wa={key:1,class:"empty-chat"},Ca={__name:"Chat",setup(re){const F=Ee(),q=qe(),x=Be(),R=Qe(),z=Ae(),T=I(!1),g=I(!1),N=I(!1),M=I(""),A=I([]),f=I(null),m=I(null),$=I([]),_=I(""),b=I(null),E=I(0),J=I(!0),u=I(!1),l=I(!1),P=X(()=>{if(!M.value)return A.value;const t=M.value.toLowerCase();return A.value.filter(a=>a.friendName.toLowerCase().includes(t))}),j=t=>{if(!t.lastMessage)return"暂无消息";let a=t.lastMessage;if(a==="[分享了歌曲]"||a==="[分享了歌单]")return a;if(a.startsWith("{")||a.startsWith("["))try{const e=JSON.parse(a);if(e.id&&e.title)return"[分享了歌曲]";if(e.id&&e.name)return"[分享了歌单]"}catch{}return a.length>30?a.substring(0,30)+"...":a},p=t=>{if(!t)return"";const a=new Date(t),r=new Date-a,c=Math.floor(r/(1e3*60*60*24));return c===0?a.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):c===1?"昨天":c<7?`${c}天前`:a.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})},y=t=>t?new Date(t).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):"",K=async()=>{try{const t=await ce();if(t.code===200&&t.data){const a=new Map;if(t.data.forEach(e=>{e.friend&&a.set(e.friendId,{avatar:e.friend.avatar,nickname:e.friend.nickname||e.friend.username})}),A.value=A.value.map(e=>{const r=a.get(e.friendId);return r?{...e,friendAvatar:r.avatar,friendName:r.nickname}:e}),f.value){const e=a.get(f.value);e&&m.value&&(m.value={...m.value,avatar:e.avatar,nickname:e.nickname})}}}catch(t){console.error("更新好友信息失败:",t)}},h=async()=>{T.value=!0;try{const t=await Ye();t.code===200&&(A.value=t.data||[],await K())}catch(t){console.error("加载会话列表失败:",t)}finally{T.value=!1}},ue=()=>{h(),R.loadConversations()},ve=t=>{Number(F.params.id)!==t.friendId&&q.push(`/chat/${t.friendId}`)},ne=async(t,a=!0)=>{a&&(E.value=0,$.value=[],J.value=!0),g.value=!0;try{const e=await Ze(t,{page:E.value,size:50});if(e.code===200){const r=e.data,c=(r.content||[]).map(w=>{if((w.type==="song"||w.type==="playlist")&&w.content&&!w.shareData)try{w.shareData=JSON.parse(w.content)}catch(B){console.error("解析分享数据失败:",B)}return w});a?$.value=c.reverse():$.value=[...c.reverse(),...$.value],J.value=!r.first,await Z(),G()}}catch(e){console.error("加载聊天记录失败:",e)}finally{g.value=!1}},S=async t=>{if(!(!t||!t.id)){try{await Ge.confirm("确定撤回这条消息吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}catch{return}try{(await et(t.id)).code===200&&(t.isRecalled=!0,t.type==="text"&&(t.content=""),V.success("已撤回"))}catch(a){console.error("撤回消息失败:",a),V.error("撤回失败")}}},oe=async()=>{var t;if(!(!_.value.trim()||!f.value)){N.value=!0;try{const a={receiverId:f.value,type:"text",content:_.value.trim()};ee.sendChatMessage(a);const e=`tmp-${Date.now()}`;$.value.push({clientId:e,local:!0,senderId:(t=x.userInfo)==null?void 0:t.id,receiverId:f.value,type:"text",content:a.content,createTime:new Date().toISOString(),isRecalled:!1}),_.value="",await Z(),G(),await h()}catch(a){console.error("发送消息失败:",a)}finally{N.value=!1}}},Re=()=>{if(!f.value){V.warning("请先选择聊天对象");return}u.value=!0},ze=()=>{if(!f.value){V.warning("请先选择聊天对象");return}l.value=!0},Pe=async t=>{var a;if(!(!t||!f.value)){N.value=!0;try{const e={receiverId:f.value,type:"song",content:JSON.stringify({id:t.id,name:t.name,artist:t.artist,cover:t.cover})};ee.sendChatMessage(e);const r=`tmp-${Date.now()}`;$.value.push({clientId:r,local:!0,senderId:(a=x.userInfo)==null?void 0:a.id,receiverId:f.value,type:"song",content:e.content,shareData:{id:t.id,name:t.name,artist:t.artist,cover:t.cover},createTime:new Date().toISOString(),isRecalled:!1}),await Z(),G(),await h(),V.success("分享成功")}catch(e){console.error("分享歌曲失败:",e),V.error("分享失败")}finally{N.value=!1}}},Ue=async t=>{var a;if(!(!t||!f.value)){N.value=!0;try{const e={receiverId:f.value,type:"playlist",content:JSON.stringify({id:t.id,name:t.name,cover:t.cover,songCount:t.songCount})};ee.sendChatMessage(e);const r=`tmp-${Date.now()}`;$.value.push({clientId:r,local:!0,senderId:(a=x.userInfo)==null?void 0:a.id,receiverId:f.value,type:"playlist",content:e.content,shareData:{id:t.id,name:t.name,cover:t.cover,songCount:t.songCount},createTime:new Date().toISOString(),isRecalled:!1}),await Z(),G(),await h(),V.success("分享成功")}catch(e){console.error("分享歌单失败:",e),V.error("分享失败")}finally{N.value=!1}}},Le=async t=>{var a;if(!t.shareData&&t.content)try{t.shareData=JSON.parse(t.content)}catch(e){console.error("解析歌曲数据失败:",e),V.error("歌曲数据解析失败");return}if(console.log("点击分享的歌曲:",t.shareData),!((a=t.shareData)!=null&&a.id)){V.warning("歌曲信息不完整");return}try{if(t.shareData.url)z.play(t.shareData),V.success("开始播放");else{V.info("正在加载歌曲...");const{getMusicDetail:e}=await Xe(async()=>{const{getMusicDetail:c}=await import("./index-B7kMBwBV.js").then(w=>w.ie);return{getMusicDetail:c}},__vite__mapDeps([0,1])),r=await e(t.shareData.id);if(r.code===200&&r.data){const c={...t.shareData,...r.data};z.play(c),V.success("开始播放")}else V.error("获取歌曲信息失败")}}catch(e){console.error("播放歌曲失败:",e),V.error("播放失败")}},Oe=t=>{var a;if(!t.shareData&&t.content)try{t.shareData=JSON.parse(t.content)}catch(e){console.error("解析歌单数据失败:",e)}(a=t.shareData)!=null&&a.id&&q.push(`/playlist/${t.shareData.id}`)},G=()=>{b.value&&(b.value.scrollTop=b.value.scrollHeight)};return me(()=>F.params.id,async t=>{if(t){const a=Number(t);f.value=a;const e=A.value.find(r=>r.friendId===a);e&&(m.value={id:a,nickname:e.friendName,avatar:e.friendAvatar});try{const r=await ce();if(r.code===200){const c=r.data.find(w=>w.friendId===a);c&&c.friend&&(m.value={id:a,nickname:c.friend.nickname||c.friend.username,avatar:c.friend.avatar,username:c.friend.username})}}catch(r){console.error("获取最新好友信息失败:",r)}await ne(a,!0);try{await Me(a),await R.updateUnreadMessageCount(),(!e||e.unreadCount>0)&&await h()}catch{}if(!m.value||m.value.id!==a)try{const r=await ce();if(r.code===200){const c=r.data.find(w=>w.friendId===a);c&&(m.value=c.friend||{id:a,nickname:c.friendName,avatar:c.friendAvatar})}}catch{}}else f.value=null,m.value=null,$.value=[]},{immediate:!0}),Fe(async()=>{if(await h(),F.params.id&&!m.value){const e=Number(F.params.id),r=A.value.find(c=>c.friendId===e);r&&(m.value={id:e,nickname:r.friendName,avatar:r.friendAvatar})}const t=ee.onChatMessage(async e=>{try{if(!e)return;if(await new Promise(r=>setTimeout(r,500)),await h(),f.value){const r=f.value;if(e.senderId===r||e.receiverId===r)try{const c=await ce();if(c.code===200){const w=c.data.find(B=>B.friendId===r);w&&w.friend&&m.value&&(m.value={...m.value,nickname:w.friend.nickname||w.friend.username,avatar:w.friend.avatar})}}catch(c){console.error("更新当前好友信息失败:",c)}}}catch(r){console.error("更新会话列表失败:",r)}}),a=ee.onChatMessage(async e=>{var r;try{if(!e||!f.value)return;const c=f.value;if(e.senderId===c||e.receiverId===c){if((e.type==="song"||e.type==="playlist")&&e.content&&!e.shareData)try{e.shareData=JSON.parse(e.content)}catch(H){console.error("解析分享数据失败:",H)}if(e.senderId===((r=x.userInfo)==null?void 0:r.id)){const H=(U,le)=>{const n=new Date(U).getTime(),Y=new Date(le).getTime();return Math.abs(n-Y)<1e4},Q=$.value.findIndex(U=>U.local===!0&&U.senderId===e.senderId&&U.receiverId===e.receiverId&&U.type===e.type&&U.content===e.content&&U.createTime&&e.createTime&&H(U.createTime,e.createTime));Q!==-1?$.value[Q]={...e}:$.value.push(e)}else if($.value.push(e),e.id&&e.senderId===c)try{await Me(c),await R.updateUnreadMessageCount(),await h()}catch(H){console.error("标记已读失败:",H)}await Z(),G()}}catch{}});Je(()=>{typeof a=="function"&&a(),typeof t=="function"&&t()})}),(t,a)=>{const e=C("el-icon"),r=C("el-button"),c=C("el-input"),w=C("el-empty"),B=C("el-avatar"),H=C("el-badge"),Q=C("el-image"),U=C("el-button-group"),le=ye("loading");return d(),v("div",Lt,[o("div",Ot,[o("div",jt,[a[4]||(a[4]=o("h3",null,"聊天",-1)),s(r,{text:"",onClick:ue},{default:i(()=>[s(e,null,{default:i(()=>[s(k(Ke))]),_:1})]),_:1})]),o("div",Bt,[s(c,{modelValue:M.value,"onUpdate:modelValue":a[0]||(a[0]=n=>M.value=n),placeholder:"搜索好友","prefix-icon":"Search",clearable:""},null,8,["modelValue"])]),te((d(),v("div",Ft,[P.value.length===0&&!T.value?(d(),v("div",Et,[s(w,{description:"暂无会话"})])):L("",!0),(d(!0),v(ae,null,se(P.value,n=>(d(),v("div",{key:n.id,class:he(["conversation-item",{active:f.value===n.friendId}]),onClick:Y=>ve(n)},[s(H,{value:n.unreadCount,hidden:!n.unreadCount,max:99,class:"conversation-badge"},{default:i(()=>[s(B,{src:n.friendAvatar,size:45},{default:i(()=>[s(e,null,{default:i(()=>[s(k(ie))]),_:1})]),_:1},8,["src"])]),_:2},1032,["value","hidden"]),o("div",Kt,[o("div",Ht,D(n.friendName),1),o("div",Wt,D(j(n)),1)]),o("div",qt,D(p(n.lastMessageTime)),1)],10,Jt))),128))])),[[le,T.value]])]),o("div",Xt,[m.value?(d(),v("div",Gt,[o("div",Qt,[s(B,{src:m.value.avatar,size:40},{default:i(()=>[s(e,null,{default:i(()=>[s(k(ie))]),_:1})]),_:1},8,["src"]),o("div",Yt,[o("div",Zt,D(m.value.nickname||m.value.username),1),a[5]||(a[5]=o("div",{class:"friend-status"},"在线",-1))])]),te((d(),v("div",{ref_key:"messageListRef",ref:b,class:"message-list"},[$.value.length===0&&!g.value?(d(),v("div",ea,[s(w,{description:"开始聊天吧~"})])):L("",!0),(d(!0),v(ae,null,se($.value,n=>{var Y,we,Ce,ke,Ie,Se,ge,$e,De,be,Ve,Ne,xe;return d(),v("div",{key:n.id||n.clientId,class:he(["message-item",{"is-self":n.senderId===((Y=k(x).userInfo)==null?void 0:Y.id)}])},[n.senderId!==((we=k(x).userInfo)==null?void 0:we.id)?(d(),W(B,{key:0,src:(Ce=m.value)==null?void 0:Ce.avatar,size:35},{default:i(()=>[s(e,null,{default:i(()=>[s(k(ie))]),_:1})]),_:1},8,["src"])):L("",!0),o("div",ta,[o("div",{class:he(["message-bubble",{"is-self":n.senderId===((ke=k(x).userInfo)==null?void 0:ke.id)}])},[n.type==="text"&&!n.isRecalled?(d(),v("div",aa,D(n.content),1)):n.type==="song"&&!n.isRecalled?(d(),v("div",{key:1,class:"message-share",onClick:Te=>Le(n)},[(Ie=n.shareData)!=null&&Ie.cover?(d(),W(Q,{key:0,src:n.shareData.cover,fit:"cover",class:"share-cover"},{error:i(()=>[o("div",ra,[s(e,null,{default:i(()=>[s(k(_e))]),_:1})])]),_:1},8,["src"])):(d(),v("div",na,[s(e,null,{default:i(()=>[s(k(_e))]),_:1})])),o("div",oa,[o("div",la,D(((Se=n.shareData)==null?void 0:Se.name)||"歌曲"),1),o("div",ia,D(((ge=n.shareData)==null?void 0:ge.artist)||""),1)])],8,sa)):n.type==="playlist"&&!n.isRecalled?(d(),v("div",{key:2,class:"message-share",onClick:Te=>Oe(n)},[($e=n.shareData)!=null&&$e.cover?(d(),W(Q,{key:0,src:n.shareData.cover,fit:"cover",class:"share-cover"},{error:i(()=>[o("div",da,[s(e,null,{default:i(()=>[s(k(de))]),_:1})])]),_:1},8,["src"])):(d(),v("div",ua,[s(e,null,{default:i(()=>[s(k(de))]),_:1})])),o("div",va,[o("div",fa,D(((De=n.shareData)==null?void 0:De.name)||"歌单"),1),o("div",_a,D(((be=n.shareData)==null?void 0:be.songCount)||0)+" 首歌曲",1)])],8,ca)):L("",!0),n.isRecalled?(d(),v("div",ha," [消息已撤回] ")):L("",!0)],2),o("div",pa,[O(D(y(n.createTime))+" ",1),n.senderId===((Ve=k(x).userInfo)==null?void 0:Ve.id)&&!n.isRecalled&&n.id?(d(),W(r,{key:0,text:"",size:"small",class:"recall-btn",onClick:Te=>S(n)},{default:i(()=>[...a[6]||(a[6]=[O("撤回",-1)])]),_:1},8,["onClick"])):L("",!0)])]),n.senderId===((Ne=k(x).userInfo)==null?void 0:Ne.id)?(d(),W(B,{key:1,src:(xe=k(x).userInfo)==null?void 0:xe.avatar,size:35},{default:i(()=>[s(e,null,{default:i(()=>[s(k(ie))]),_:1})]),_:1},8,["src"])):L("",!0)],2)}),128))])),[[le,g.value]]),o("div",ma,[s(c,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=n=>_.value=n),type:"textarea",rows:3,placeholder:"输入消息...",maxlength:"2000","show-word-limit":"",resize:"none",onKeyup:He(We(oe,["ctrl"]),["enter"])},null,8,["modelValue","onKeyup"]),o("div",ya,[s(U,null,{default:i(()=>[s(r,{text:"",onClick:Re},{default:i(()=>[s(e,null,{default:i(()=>[s(k(_e))]),_:1}),a[7]||(a[7]=O(" 分享歌曲 ",-1))]),_:1}),s(r,{text:"",onClick:ze},{default:i(()=>[s(e,null,{default:i(()=>[s(k(de))]),_:1}),a[8]||(a[8]=O(" 分享歌单 ",-1))]),_:1})]),_:1}),s(r,{type:"primary",onClick:oe,loading:N.value,disabled:!_.value.trim()},{default:i(()=>[...a[9]||(a[9]=[O(" 发送 ",-1)])]),_:1},8,["loading","disabled"])])])])):(d(),v("div",wa,[s(w,{description:"选择一个好友开始聊天"})]))]),s($t,{modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=n=>u.value=n),onSelect:Pe},null,8,["modelValue"]),s(Ut,{modelValue:l.value,"onUpdate:modelValue":a[3]||(a[3]=n=>l.value=n),onSelect:Ue},null,8,["modelValue"])])}}},$a=pe(Ca,[["__scopeId","data-v-4c9c6325"]]);export{$a as default};
