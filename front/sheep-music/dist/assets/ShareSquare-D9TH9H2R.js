import{_ as W,v as X,g as m,x as Y,i as Z,c as n,o as r,a as o,O as ee,k as P,d as s,w as l,r as p,P as te,F as ae,l as se,aH as le,aI as oe,aJ as ne,aK as re,E as h,u as ie,e as i,Q as k,aw as ue,t as c,G as ce,a0 as de,a4 as B,s as ve,aL as _e,aM as pe,aN as fe,aO as ge,aP as ye}from"./index-CxmcMKp9.js";const me={class:"share-square-page"},he={class:"page-header"},Se={class:"header-controls"},Ce={class:"shares-list"},Te={key:0,class:"empty-state"},ke={key:1,class:"shares-grid"},we=["onClick"],Ve={class:"share-cover"},ze={class:"image-error"},xe={key:0,class:"share-type-badge"},De={class:"share-content"},Ne={class:"share-title"},Me={key:0,class:"share-description"},Ie={class:"share-meta"},be={class:"share-user"},qe={class:"share-stats"},Le={key:0},Pe={key:1},Be={class:"share-time"},$e={class:"share-actions"},Ae={key:0,class:"load-more"},Ee={__name:"ShareSquare",setup(Fe){const $=ie(),A=X(),S=m(!1),w=m("latest"),z=m("all"),C=m([]),T=m(0),x=m(20),q=m(!0),E=Y(()=>z.value==="all"?C.value:C.value.filter(e=>e.shareType===z.value)),F=e=>{if(!e)return"";const t=new Date(e),f=new Date-t,v=Math.floor(f/(1e3*60*60*24));return v===0?"今天":v===1?"昨天":v<7?`${v}天前`:t.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})},L=async(e=!1)=>{var t,d,f,v,_,D,N,M;if(!S.value){e&&(T.value=0,C.value=[],q.value=!0),S.value=!0;try{const[u,g]=await Promise.allSettled([w.value==="hot"?le({page:T.value,size:x.value}):oe({page:T.value,size:x.value}),w.value==="hot"?ne({page:T.value,size:x.value}):re({page:T.value,size:x.value})]);let a=[];if(u.status==="fulfilled"&&((t=u.value)==null?void 0:t.code)===200){const y=(((d=u.value.data)==null?void 0:d.content)||[]).map(V=>({...V,shareType:"playlist"}));a.push(...y)}if(g.status==="fulfilled"&&((f=g.value)==null?void 0:f.code)===200){const y=(((v=g.value.data)==null?void 0:v.content)||[]).map(V=>({...V,shareType:"song"}));a.push(...y)}a.sort((y,V)=>{const Q=new Date(y.createTime).getTime(),j=new Date(V.createTime).getTime();return w.value==="hot"?0:j-Q}),e?C.value=a:C.value.push(...a);const I=u.status==="fulfilled"?(D=(_=u.value)==null?void 0:_.data)==null?void 0:D.last:!0,b=g.status==="fulfilled"?(M=(N=g.value)==null?void 0:N.data)==null?void 0:M.last:!0;q.value=!(I&&b)}catch(u){console.error("加载分享失败:",u),h.error("加载分享失败")}finally{S.value=!1}}},H=()=>{T.value++,L()},R=()=>{L(!0)},O=()=>{},U=e=>{var t;return e?e.shareType==="song"?e.songCover||"/default-cover.svg":e.playlistCover||((t=e.playlist)==null?void 0:t.cover)||"/default-cover.svg":"/default-cover.svg"},G=e=>{var t;return e?e.shareType==="song"?e.songName||"未知歌曲":e.playlistName||((t=e.playlist)==null?void 0:t.name)||"未知歌单":"未知"},J=async e=>{if(!(!e||!e.id)){try{e.shareType==="song"?await _e(e.id):await pe(e.id)}catch(t){console.error("增加浏览次数失败:",t)}if(e.shareType==="song"){if(e.songId)try{const t=await fe(e.songId);t.code===200&&t.data?(await A.play(t.data),h.success("开始播放")):h.error("获取歌曲信息失败")}catch(t){console.error("播放歌曲失败:",t),h.error("播放歌曲失败")}}else e.playlistId&&$.push(`/playlist/${e.playlistId}`)}},K=async e=>{if(!(!e||!e.id))try{e.shareType==="song"?(await ge(e.id),e.likeCount=(e.likeCount||0)+1,h.success("点赞成功")):(await ye(e.id),e.collectCount=(e.collectCount||0)+1,h.success("收藏成功"))}catch(t){console.error("操作失败:",t),h.error("操作失败")}};return Z(()=>{L(!0)}),(e,t)=>{const d=p("el-radio-button"),f=p("el-radio-group"),v=p("el-empty"),_=p("el-icon"),D=p("el-image"),N=p("el-tag"),M=p("el-avatar"),u=p("el-button"),g=te("loading");return r(),n("div",me,[o("div",he,[t[7]||(t[7]=o("h2",null,"分享广场",-1)),o("div",Se,[s(f,{modelValue:z.value,"onUpdate:modelValue":t[0]||(t[0]=a=>z.value=a),size:"small",onChange:O},{default:l(()=>[s(d,{value:"all"},{default:l(()=>[...t[2]||(t[2]=[i("全部",-1)])]),_:1}),s(d,{value:"playlist"},{default:l(()=>[...t[3]||(t[3]=[i("歌单",-1)])]),_:1}),s(d,{value:"song"},{default:l(()=>[...t[4]||(t[4]=[i("歌曲",-1)])]),_:1})]),_:1},8,["modelValue"]),s(f,{modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=a=>w.value=a),size:"small",onChange:R,style:{"margin-left":"12px"}},{default:l(()=>[s(d,{value:"latest"},{default:l(()=>[...t[5]||(t[5]=[i("最新",-1)])]),_:1}),s(d,{value:"hot"},{default:l(()=>[...t[6]||(t[6]=[i("热门",-1)])]),_:1})]),_:1},8,["modelValue"])])]),ee((r(),n("div",Ce,[C.value.length===0&&!S.value?(r(),n("div",Te,[s(v,{description:"暂无分享"})])):(r(),n("div",ke,[(r(!0),n(ae,null,se(E.value,a=>{var I,b;return r(),n("div",{key:a.id,class:"share-card",onClick:y=>J(a)},[o("div",Ve,[s(D,{src:U(a),fit:"cover",lazy:!0},{error:l(()=>[o("div",ze,[s(_,null,{default:l(()=>[s(k(ue))]),_:1})])]),_:1},8,["src"]),a.shareType?(r(),n("div",xe,[s(N,{type:a.shareType==="song"?"success":"primary",size:"small"},{default:l(()=>[i(c(a.shareType==="song"?"歌曲":"歌单"),1)]),_:2},1032,["type"])])):P("",!0)]),o("div",De,[o("div",Ne,c(G(a)),1),a.description?(r(),n("div",Me,c(a.description),1)):P("",!0),o("div",Ie,[o("div",be,[s(M,{src:a.userAvatar||((I=a.user)==null?void 0:I.avatar),size:24},{default:l(()=>[s(_,null,{default:l(()=>[s(k(ce))]),_:1})]),_:1},8,["src"]),o("span",null,c(a.userName||((b=a.user)==null?void 0:b.nickname)),1)]),o("div",qe,[o("span",null,[s(_,null,{default:l(()=>[s(k(de))]),_:1}),i(" "+c(a.viewCount||0),1)]),a.shareType==="song"?(r(),n("span",Le,[s(_,null,{default:l(()=>[s(k(B))]),_:1}),i(" "+c(a.likeCount||0),1)])):(r(),n("span",Pe,[s(_,null,{default:l(()=>[s(k(B))]),_:1}),i(" "+c(a.collectCount||0),1)]))])]),o("div",Be,c(F(a.createTime)),1),o("div",$e,[s(u,{text:"",onClick:ve(y=>K(a),["stop"])},{default:l(()=>[s(_,null,{default:l(()=>[s(k(B))]),_:1}),i(" "+c(a.shareType==="song"?"点赞":"收藏")+" "+c(a.shareType==="song"?a.likeCount||0:a.collectCount||0),1)]),_:2},1032,["onClick"])])])],8,we)}),128))]))])),[[g,S.value]]),q.value?(r(),n("div",Ae,[s(u,{text:"",loading:S.value,onClick:H},{default:l(()=>[...t[8]||(t[8]=[i(" 加载更多 ",-1)])]),_:1},8,["loading"])])):P("",!0)])}}},Re=W(Ee,[["__scopeId","data-v-3928324a"]]);export{Re as default};
