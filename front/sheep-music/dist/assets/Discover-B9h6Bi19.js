import{r as s,d as l,m as a,q as e,t as i,H as o,C as t,D as n,B as c,a8 as r,ac as d,G as u,Y as v,al as p,u as g,F as m,L as y}from"./vue-vendor-BzZaYQKc.js";import{u as f}from"./player-BodKjA0D.js";import{_ as h,u as k}from"./index-Cb8xoRiw.js";import{a as C,b as _,g as x}from"./recommendation-CPTTUSqv.js";import{b as j,t as w}from"./favorite-CBOsHs95.js";import{L as z,a1 as S,a3 as F,Y as P,P as L,a6 as b,a7 as R,a8 as $,a9 as V}from"./element-plus-CCPVPfgN.js";import{P as q}from"./PlaylistSelector-BQ_G-bWe.js";import"./song-C8TMBuSO.js";import"./request-76E38DvM.js";import"./PlaylistCover-D3NetioR.js";const A={class:"discover-page"},D={class:"recommendation-section"},M={class:"section-header"},Y={class:"title-group"},B={class:"song-grid"},G=["onClick"],H={class:"song-cover-wrapper"},I=["src"],N={class:"cover-overlay"},T={class:"song-play-count"},U={class:"song-info"},E={class:"song-title"},J={class:"song-artist"},K={class:"song-actions-hover"},O={key:0,class:"empty-hint"},Q={class:"recommendation-section"},W={class:"section-header"},X={class:"title-group"},Z={class:"song-list"},ss=["onClick"],ls={class:"song-index"},as=["src"],es={class:"song-info-inline"},is={class:"song-name"},os={class:"song-artist-name"},ts={class:"song-stats"},ns={class:"song-duration"},cs={class:"song-actions"},rs={key:0,class:"empty-hint"},ds={class:"recommendation-section"},us={class:"section-header"},vs={class:"title-group"},ps={class:"playlist-grid"},gs=["onClick"],ms={class:"playlist-cover-wrapper"},ys=["src"],fs={class:"cover-overlay"},hs={class:"playlist-song-count"},ks={class:"playlist-info"},Cs={class:"playlist-name"},_s={class:"playlist-creator"},xs={key:0,class:"empty-hint"},js="https://via.placeholder.com/200?text=Music",ws=h({__name:"Discover",setup(h){const ws=p(),zs=f(),Ss=k(),Fs=s([]),Ps=s(!1),Ls=s([]),bs=s(!1),Rs=s([]),$s=s(!1),Vs=s({}),qs=s(!1),As=s(null);l(()=>{Ds(),Ms(),Ys()});const Ds=async()=>{if(Ss.isLogin){Ps.value=!0;try{const s=await C({limit:12});200===s.code?(Fs.value=s.data||[],await Bs()):z.error(s.message||"加载失败")}catch(s){console.error("加载猜你喜欢失败:",s),z.error("加载失败，请稍后重试")}finally{Ps.value=!1}}else z.warning("请先登录查看推荐")},Ms=async()=>{if(Ss.isLogin){bs.value=!0;try{const s=await _({limit:20});200===s.code?(Ls.value=s.data||[],await Bs()):z.error(s.message||"加载失败")}catch(s){console.error("加载个性化推荐失败:",s)}finally{bs.value=!1}}},Ys=async()=>{if(Ss.isLogin){$s.value=!0;try{const s=await x({limit:12});200===s.code?Rs.value=s.data||[]:z.error(s.message||"加载失败")}catch(s){console.error("加载推荐歌单失败:",s)}finally{$s.value=!1}}},Bs=async()=>{const s=[...Fs.value,...Ls.value];if(0!==s.length)try{const l=s.map(s=>s.id),a=await j(l);200===a.code&&(Vs.value=a.data||{})}catch(l){console.error("加载收藏状态失败:",l)}},Gs=()=>{Ds()},Hs=()=>{Ms()},Is=()=>{Ys()},Ns=s=>{const l=[...Fs.value,...Ls.value];zs.play(s,l)},Ts=s=>{zs.addToPlaylist(s),z.success(`已添加: ${s.title}`)},Us=async s=>{if(!Ss.isLogin)return z.warning("请先登录"),void ws.push("/login");try{const l=await w(s);if(200===l.code){const a=l.data.isFavorite;Vs.value[s]=a,z.success(a?"收藏成功":"取消收藏成功")}else z.error(l.message||"操作失败")}catch(l){console.error("收藏操作失败:",l),z.error("操作失败，请稍后重试")}},Es=s=>{if(!Ss.isLogin)return z.warning("请先登录"),void ws.push("/login");As.value=s,qs.value=!0},Js=()=>{},Ks=s=>{var l;return(null==(l=s.artists)?void 0:l.map(s=>s.name).join(" / "))||"未知歌手"},Os=s=>s?s>=1e8?(s/1e8).toFixed(1)+"亿":s>=1e4?(s/1e4).toFixed(1)+"万":s.toString():"0",Qs=s=>{if(!s)return"--:--";return`${Math.floor(s/60)}:${(s%60).toString().padStart(2,"0")}`};return(s,l)=>{const p=r("el-icon"),f=r("el-button"),h=r("el-empty"),k=d("loading");return e(),a("div",A,[l[10]||(l[10]=i("div",{class:"page-header"},[i("h2",null,"🎵 发现音乐"),i("p",{class:"subtitle"},"基于你的喜好，为你推荐精选内容")],-1)),i("div",D,[i("div",M,[i("div",Y,[o(p,{class:"section-icon"},{default:c(()=>[o(g(S))]),_:1}),l[1]||(l[1]=i("h3",null,"猜你喜欢",-1)),l[2]||(l[2]=i("span",{class:"section-desc"},"每天为你更新",-1))]),o(f,{text:"",icon:"Refresh",onClick:Gs,loading:Ps.value},{default:c(()=>[...l[3]||(l[3]=[m(" 换一批 ",-1)])]),_:1},8,["loading"])]),t((e(),a("div",B,[(e(!0),a(u,null,v(Fs.value,s=>(e(),a("div",{key:s.id,class:"song-card",onClick:l=>Ns(s)},[i("div",H,[i("img",{src:s.cover||js,class:"song-cover",alt:"封面"},null,8,I),i("div",N,[o(p,{class:"play-icon"},{default:c(()=>[o(g(F))]),_:1})]),i("div",T,[o(p,null,{default:c(()=>[o(g(P))]),_:1}),m(" "+L(Os(s.playCount)),1)])]),i("div",U,[i("div",E,L(s.title),1),i("div",J,L(Ks(s)),1)]),i("div",K,[o(f,{icon:"Plus",circle:"",size:"small",onClick:y(l=>Ts(s),["stop"]),title:"添加到播放列表"},null,8,["onClick"]),o(f,{icon:"FolderAdd",circle:"",size:"small",onClick:y(l=>Es(s.id),["stop"]),title:"添加到歌单"},null,8,["onClick"]),o(f,{icon:Vs.value[s.id]?"StarFilled":"Star",circle:"",size:"small",type:Vs.value[s.id]?"danger":"",onClick:y(l=>Us(s.id),["stop"]),title:"收藏"},null,8,["icon","type","onClick"])])],8,G))),128))])),[[k,Ps.value]]),Ps.value||0!==Fs.value.length?n("",!0):(e(),a("div",O,[o(h,{description:"暂无推荐，试试多听听歌曲吧~"},{image:c(()=>[o(p,{style:{"font-size":"80px",color:"#ddd"}},{default:c(()=>[o(g(P))]),_:1})]),_:1})]))]),i("div",Q,[i("div",W,[i("div",X,[o(p,{class:"section-icon"},{default:c(()=>[o(g(b))]),_:1}),l[4]||(l[4]=i("h3",null,"为你推荐",-1)),l[5]||(l[5]=i("span",{class:"section-desc"},"根据你的收藏和播放习惯",-1))]),o(f,{text:"",icon:"Refresh",onClick:Hs,loading:bs.value},{default:c(()=>[...l[6]||(l[6]=[m(" 换一批 ",-1)])]),_:1},8,["loading"])]),t((e(),a("div",Z,[(e(!0),a(u,null,v(Ls.value,(s,l)=>(e(),a("div",{key:s.id,class:"song-item",onClick:l=>Ns(s)},[i("div",ls,L(l+1),1),i("img",{src:s.cover||js,class:"song-cover-small",alt:"封面"},null,8,as),i("div",es,[i("div",is,L(s.title),1),i("div",os,L(Ks(s)),1)]),i("div",ts,[o(p,null,{default:c(()=>[o(g(P))]),_:1}),m(" "+L(Os(s.playCount)),1)]),i("div",ns,L(Qs(s.duration)),1),i("div",cs,[o(f,{icon:"CaretRight",circle:"",size:"small",onClick:y(l=>Ns(s),["stop"])},null,8,["onClick"]),o(f,{icon:"Plus",circle:"",size:"small",onClick:y(l=>Ts(s),["stop"])},null,8,["onClick"]),o(f,{icon:"FolderAdd",circle:"",size:"small",onClick:y(l=>Es(s.id),["stop"])},null,8,["onClick"]),o(f,{icon:Vs.value[s.id]?"StarFilled":"Star",circle:"",size:"small",type:Vs.value[s.id]?"danger":"",onClick:y(l=>Us(s.id),["stop"])},null,8,["icon","type","onClick"])])],8,ss))),128))])),[[k,bs.value]]),bs.value||0!==Ls.value.length?n("",!0):(e(),a("div",rs,[o(h,{description:"暂无推荐"},{image:c(()=>[o(p,{style:{"font-size":"80px",color:"#ddd"}},{default:c(()=>[o(g(R))]),_:1})]),_:1})]))]),i("div",ds,[i("div",us,[i("div",vs,[o(p,{class:"section-icon"},{default:c(()=>[o(g($))]),_:1}),l[7]||(l[7]=i("h3",null,"精选歌单",-1)),l[8]||(l[8]=i("span",{class:"section-desc"},"发现更多好歌",-1))]),o(f,{text:"",icon:"Refresh",onClick:Is,loading:$s.value},{default:c(()=>[...l[9]||(l[9]=[m(" 换一批 ",-1)])]),_:1},8,["loading"])]),t((e(),a("div",ps,[(e(!0),a(u,null,v(Rs.value,s=>(e(),a("div",{key:s.id,class:"playlist-card",onClick:l=>{return a=s.id,void ws.push(`/playlist/${a}`);var a}},[i("div",ms,[i("img",{src:s.cover||"https://via.placeholder.com/200?text=Playlist",class:"playlist-cover",alt:"封面"},null,8,ys),i("div",fs,[o(p,{class:"play-icon"},{default:c(()=>[o(g(F))]),_:1})]),i("div",hs,[o(p,null,{default:c(()=>[o(g(P))]),_:1}),m(" "+L(s.songCount)+" 首 ",1)])]),i("div",ks,[i("div",Cs,L(s.name),1),i("div",_s," by "+L(s.userName||"未知"),1)])],8,gs))),128))])),[[k,$s.value]]),$s.value||0!==Rs.value.length?n("",!0):(e(),a("div",xs,[o(h,{description:"暂无推荐歌单"},{image:c(()=>[o(p,{style:{"font-size":"80px",color:"#ddd"}},{default:c(()=>[o(g(V))]),_:1})]),_:1})]))]),o(q,{modelValue:qs.value,"onUpdate:modelValue":l[0]||(l[0]=s=>qs.value=s),"song-id":As.value,onSuccess:Js},null,8,["modelValue","song-id"])])}}},[["__scopeId","data-v-11a0ef1d"]]);export{ws as default};
