import{P as e,c as l,h as a,j as s}from"./PlaylistCover-D3NetioR.js";import{al as o,a4 as t,ah as i,L as d,o as c,P as r}from"./element-plus-CCPVPfgN.js";import{_ as n}from"./index-Cb8xoRiw.js";import{r as u,e as m,A as p,q as v,B as y,a8 as f,t as g,H as C,m as b,F as h,G as V,Y as k,D as _}from"./vue-vendor-BzZaYQKc.js";const P={name:"PlaylistSelector",components:{PlaylistCover:e,Plus:i,Loading:t,Check:o},props:{modelValue:Boolean,songId:{type:Number,default:null}},emits:["update:modelValue","success"],setup(e,{emit:o}){const t=u(!1),i=u(!1),c=u([]),r=u(!1),n=u({name:"",category:""});m(()=>e.modelValue,e=>{t.value=e,e&&p()}),m(t,e=>{o("update:modelValue",e)});const p=async()=>{i.value=!0;try{const e=await s();200===e.code&&(c.value=e.data||[])}catch(e){console.error("加载歌单失败:",e)}finally{i.value=!1}},v=async l=>{var s,i;if(!l.disabled&&e.songId)try{200===(await a(l.id,e.songId)).code&&(d.success("已添加到歌单"),o("success"),t.value=!1)}catch(c){const e=(null==(i=null==(s=c.response)?void 0:s.data)?void 0:i.message)||"添加失败";e.includes("已在歌单中")?(l.disabled=!0,d.info("该歌曲已在此歌单中")):d.error(e)}};return{visible:t,loading:i,playlists:c,defaultCover:"https://via.placeholder.com/60?text=Playlist",createDialogVisible:r,createForm:n,loadPlaylists:p,selectPlaylist:v,showCreateDialog:()=>{n.value={name:"",category:""},r.value=!0},handleCreate:async()=>{if(n.value.name.trim())try{const a=await l({name:n.value.name,category:n.value.category,isPublic:!1});200===a.code&&(d.success("创建成功"),r.value=!1,await p(),e.songId&&a.data&&v(a.data))}catch(a){d.error("创建失败")}else d.warning("请输入歌单名称")},handleClose:()=>{t.value=!1}}}},w={class:"playlist-selector"},D={class:"create-new"},x={key:0,class:"loading"},F={key:1,class:"playlist-list"},j=["onClick"],I={class:"playlist-info"},U={class:"playlist-name"},L={class:"playlist-count"},q={key:2,class:"empty-state"};const z=n(P,[["render",function(e,l,a,s,o,t){const i=f("Plus"),d=f("el-icon"),n=f("el-button"),u=f("Loading"),m=f("PlaylistCover"),P=f("Check"),z=f("el-empty"),A=f("el-input"),B=f("el-form-item"),G=f("el-option"),H=f("el-select"),N=f("el-form"),S=f("el-dialog");return v(),p(S,{modelValue:s.visible,"onUpdate:modelValue":l[4]||(l[4]=e=>s.visible=e),title:"添加到歌单",width:"500px",onClose:s.handleClose},{default:y(()=>[g("div",w,[g("div",D,[C(n,{type:"primary",size:"small",onClick:s.showCreateDialog},{default:y(()=>[C(d,null,{default:y(()=>[C(i)]),_:1}),l[5]||(l[5]=h(" 创建新歌单 ",-1))]),_:1},8,["onClick"])]),s.loading?(v(),b("div",x,[C(d,{class:"is-loading"},{default:y(()=>[C(u)]),_:1}),l[6]||(l[6]=g("span",null,"加载中...",-1))])):s.playlists.length>0?(v(),b("div",F,[(v(!0),b(V,null,k(s.playlists,e=>(v(),b("div",{key:e.id,class:c(["playlist-item",{disabled:e.disabled}]),onClick:l=>s.selectPlaylist(e)},[C(m,{cover:e.cover,size:50,"default-cover":s.defaultCover,class:"playlist-cover"},null,8,["cover","default-cover"]),g("div",I,[g("div",U,r(e.name),1),g("div",L,r(e.songCount||0)+" 首歌曲",1)]),e.disabled?(v(),p(d,{key:0,class:"check-icon",color:"#67C23A"},{default:y(()=>[C(P)]),_:1})):_("",!0)],10,j))),128))])):(v(),b("div",q,[C(z,{description:"还没有歌单"},{default:y(()=>[C(n,{type:"primary",onClick:s.showCreateDialog},{default:y(()=>[...l[7]||(l[7]=[h("创建第一个歌单",-1)])]),_:1},8,["onClick"])]),_:1})]))]),C(S,{modelValue:s.createDialogVisible,"onUpdate:modelValue":l[3]||(l[3]=e=>s.createDialogVisible=e),title:"创建歌单",width:"400px","append-to-body":""},{footer:y(()=>[C(n,{onClick:l[2]||(l[2]=e=>s.createDialogVisible=!1)},{default:y(()=>[...l[8]||(l[8]=[h("取消",-1)])]),_:1}),C(n,{type:"primary",onClick:s.handleCreate},{default:y(()=>[...l[9]||(l[9]=[h("创建",-1)])]),_:1},8,["onClick"])]),default:y(()=>[C(N,{model:s.createForm,"label-width":"80px"},{default:y(()=>[C(B,{label:"歌单名称",required:""},{default:y(()=>[C(A,{modelValue:s.createForm.name,"onUpdate:modelValue":l[0]||(l[0]=e=>s.createForm.name=e),placeholder:"请输入歌单名称",maxlength:"50"},null,8,["modelValue"])]),_:1}),C(B,{label:"分类"},{default:y(()=>[C(H,{modelValue:s.createForm.category,"onUpdate:modelValue":l[1]||(l[1]=e=>s.createForm.category=e),placeholder:"选择分类"},{default:y(()=>[C(G,{label:"流行",value:"流行"}),C(G,{label:"摇滚",value:"摇滚"}),C(G,{label:"民谣",value:"民谣"}),C(G,{label:"电子",value:"电子"}),C(G,{label:"纯音乐",value:"纯音乐"}),C(G,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","onClose"])}],["__scopeId","data-v-67efc172"]]);export{z as P};
