import{_ as te,f as oe,g as _,i as le,E as d,c as n,o as c,a as s,d as o,m as V,z as D,w as a,r as A,X as ie,I as N,J as T,u as ae,n as u,P as ne,e as g,R as q,F as x,t as v,L as m,Y as ce,Z as re,$ as de,a0 as ue}from"./index-DUIxZ2bH.js";import{u as ve}from"./player-B-aA8y8K.js";import{a as _e,b as me,g as pe}from"./recommendation-BYnPSRTG.js";import{b as fe,t as ge}from"./favorite-COXOqUYB.js";import{P as he}from"./PlaylistSelector-DYhbXgWt.js";import"./song-DY3Abzll.js";import"./request-C9aqfYyr.js";import"./PlaylistCover-8S-uaouD.js";const ye={class:"discover-page"},ke={class:"recommendation-section"},Ce={class:"section-header"},Se={class:"title-group"},Pe={class:"song-grid"},we=["onClick"],xe={class:"song-cover-wrapper"},ze=["src"],Le={class:"cover-overlay"},$e={class:"song-play-count"},Fe={class:"song-info"},be={class:"song-title"},Re={class:"song-artist"},Ve={class:"song-actions-hover"},De={key:0,class:"empty-hint"},Ae={class:"recommendation-section"},Ne={class:"section-header"},Te={class:"title-group"},Ye={class:"song-list"},Me=["onClick"],Be={class:"song-index"},Ee=["src"],Ge={class:"song-info-inline"},Ie={class:"song-name"},Ue={class:"song-artist-name"},je={class:"song-stats"},Je={class:"song-duration"},Xe={class:"song-actions"},Ze={key:0,class:"empty-hint"},qe={class:"recommendation-section"},He={class:"section-header"},Ke={class:"title-group"},Oe={class:"playlist-grid"},Qe=["onClick"],We={class:"playlist-cover-wrapper"},es=["src"],ss={class:"cover-overlay"},ts={class:"playlist-song-count"},os={class:"playlist-info"},ls={class:"playlist-name"},is={class:"playlist-creator"},as={key:0,class:"empty-hint"},H="https://via.placeholder.com/200?text=Music",ns="https://via.placeholder.com/200?text=Playlist",cs={__name:"Discover",setup(rs){const z=ae(),Y=ve(),h=oe(),y=_([]),k=_(!1),C=_([]),S=_(!1),L=_([]),P=_(!1),p=_({}),$=_(!1),M=_(null);le(()=>{B(),E(),G()});const B=async()=>{if(!h.isLogin){d.warning("请先登录查看推荐");return}k.value=!0;try{const e=await _e({limit:12});e.code===200?(y.value=e.data||[],await I()):d.error(e.message||"加载失败")}catch(e){console.error("加载猜你喜欢失败:",e),d.error("加载失败，请稍后重试")}finally{k.value=!1}},E=async()=>{if(h.isLogin){S.value=!0;try{const e=await me({limit:20});e.code===200?(C.value=e.data||[],await I()):d.error(e.message||"加载失败")}catch(e){console.error("加载个性化推荐失败:",e)}finally{S.value=!1}}},G=async()=>{if(h.isLogin){P.value=!0;try{const e=await pe({limit:12});e.code===200?L.value=e.data||[]:d.error(e.message||"加载失败")}catch(e){console.error("加载推荐歌单失败:",e)}finally{P.value=!1}}},I=async()=>{const e=[...y.value,...C.value];if(e.length!==0)try{const t=e.map(r=>r.id),i=await fe(t);i.code===200&&(p.value=i.data||{})}catch(t){console.error("加载收藏状态失败:",t)}},K=()=>{B()},O=()=>{E()},Q=()=>{G()},F=e=>{const t=[...y.value,...C.value];Y.play(e,t)},U=e=>{Y.addToPlaylist(e),d.success(`已添加: ${e.title}`)},j=async e=>{if(!h.isLogin){d.warning("请先登录"),z.push("/login");return}try{const t=await ge(e);if(t.code===200){const i=t.data.isFavorite;p.value[e]=i,d.success(i?"收藏成功":"取消收藏成功")}else d.error(t.message||"操作失败")}catch(t){console.error("收藏操作失败:",t),d.error("操作失败，请稍后重试")}},J=e=>{if(!h.isLogin){d.warning("请先登录"),z.push("/login");return}M.value=e,$.value=!0},W=()=>{},ee=e=>{z.push(`/playlist/${e}`)},X=e=>{var t;return((t=e.artists)==null?void 0:t.map(i=>i.name).join(" / "))||"未知歌手"},Z=e=>e?e>=1e8?(e/1e8).toFixed(1)+"亿":e>=1e4?(e/1e4).toFixed(1)+"万":e.toString():"0",se=e=>{if(!e)return"--:--";const t=Math.floor(e/60),i=e%60;return`${t}:${i.toString().padStart(2,"0")}`};return(e,t)=>{const i=A("el-icon"),r=A("el-button"),b=A("el-empty"),R=ie("loading");return c(),n("div",ye,[t[10]||(t[10]=s("div",{class:"page-header"},[s("h2",null,"🎵 发现音乐"),s("p",{class:"subtitle"},"基于你的喜好，为你推荐精选内容")],-1)),s("div",ke,[s("div",Ce,[s("div",Se,[o(i,{class:"section-icon"},{default:a(()=>[o(u(ne))]),_:1}),t[1]||(t[1]=s("h3",null,"猜你喜欢",-1)),t[2]||(t[2]=s("span",{class:"section-desc"},"每天为你更新",-1))]),o(r,{text:"",icon:"Refresh",onClick:K,loading:k.value},{default:a(()=>[...t[3]||(t[3]=[g(" 换一批 ",-1)])]),_:1},8,["loading"])]),V((c(),n("div",Pe,[(c(!0),n(N,null,T(y.value,l=>(c(),n("div",{key:l.id,class:"song-card",onClick:f=>F(l)},[s("div",xe,[s("img",{src:l.cover||H,class:"song-cover",alt:"封面"},null,8,ze),s("div",Le,[o(i,{class:"play-icon"},{default:a(()=>[o(u(q))]),_:1})]),s("div",$e,[o(i,null,{default:a(()=>[o(u(x))]),_:1}),g(" "+v(Z(l.playCount)),1)])]),s("div",Fe,[s("div",be,v(l.title),1),s("div",Re,v(X(l)),1)]),s("div",Ve,[o(r,{icon:"Plus",circle:"",size:"small",onClick:m(f=>U(l),["stop"]),title:"添加到播放列表"},null,8,["onClick"]),o(r,{icon:"FolderAdd",circle:"",size:"small",onClick:m(f=>J(l.id),["stop"]),title:"添加到歌单"},null,8,["onClick"]),o(r,{icon:p.value[l.id]?"StarFilled":"Star",circle:"",size:"small",type:p.value[l.id]?"danger":"",onClick:m(f=>j(l.id),["stop"]),title:"收藏"},null,8,["icon","type","onClick"])])],8,we))),128))])),[[R,k.value]]),!k.value&&y.value.length===0?(c(),n("div",De,[o(b,{description:"暂无推荐，试试多听听歌曲吧~"},{image:a(()=>[o(i,{style:{"font-size":"80px",color:"#ddd"}},{default:a(()=>[o(u(x))]),_:1})]),_:1})])):D("",!0)]),s("div",Ae,[s("div",Ne,[s("div",Te,[o(i,{class:"section-icon"},{default:a(()=>[o(u(ce))]),_:1}),t[4]||(t[4]=s("h3",null,"为你推荐",-1)),t[5]||(t[5]=s("span",{class:"section-desc"},"根据你的收藏和播放习惯",-1))]),o(r,{text:"",icon:"Refresh",onClick:O,loading:S.value},{default:a(()=>[...t[6]||(t[6]=[g(" 换一批 ",-1)])]),_:1},8,["loading"])]),V((c(),n("div",Ye,[(c(!0),n(N,null,T(C.value,(l,f)=>(c(),n("div",{key:l.id,class:"song-item",onClick:w=>F(l)},[s("div",Be,v(f+1),1),s("img",{src:l.cover||H,class:"song-cover-small",alt:"封面"},null,8,Ee),s("div",Ge,[s("div",Ie,v(l.title),1),s("div",Ue,v(X(l)),1)]),s("div",je,[o(i,null,{default:a(()=>[o(u(x))]),_:1}),g(" "+v(Z(l.playCount)),1)]),s("div",Je,v(se(l.duration)),1),s("div",Xe,[o(r,{icon:"CaretRight",circle:"",size:"small",onClick:m(w=>F(l),["stop"])},null,8,["onClick"]),o(r,{icon:"Plus",circle:"",size:"small",onClick:m(w=>U(l),["stop"])},null,8,["onClick"]),o(r,{icon:"FolderAdd",circle:"",size:"small",onClick:m(w=>J(l.id),["stop"])},null,8,["onClick"]),o(r,{icon:p.value[l.id]?"StarFilled":"Star",circle:"",size:"small",type:p.value[l.id]?"danger":"",onClick:m(w=>j(l.id),["stop"])},null,8,["icon","type","onClick"])])],8,Me))),128))])),[[R,S.value]]),!S.value&&C.value.length===0?(c(),n("div",Ze,[o(b,{description:"暂无推荐"},{image:a(()=>[o(i,{style:{"font-size":"80px",color:"#ddd"}},{default:a(()=>[o(u(re))]),_:1})]),_:1})])):D("",!0)]),s("div",qe,[s("div",He,[s("div",Ke,[o(i,{class:"section-icon"},{default:a(()=>[o(u(de))]),_:1}),t[7]||(t[7]=s("h3",null,"精选歌单",-1)),t[8]||(t[8]=s("span",{class:"section-desc"},"发现更多好歌",-1))]),o(r,{text:"",icon:"Refresh",onClick:Q,loading:P.value},{default:a(()=>[...t[9]||(t[9]=[g(" 换一批 ",-1)])]),_:1},8,["loading"])]),V((c(),n("div",Oe,[(c(!0),n(N,null,T(L.value,l=>(c(),n("div",{key:l.id,class:"playlist-card",onClick:f=>ee(l.id)},[s("div",We,[s("img",{src:l.cover||ns,class:"playlist-cover",alt:"封面"},null,8,es),s("div",ss,[o(i,{class:"play-icon"},{default:a(()=>[o(u(q))]),_:1})]),s("div",ts,[o(i,null,{default:a(()=>[o(u(x))]),_:1}),g(" "+v(l.songCount)+" 首 ",1)])]),s("div",os,[s("div",ls,v(l.name),1),s("div",is," by "+v(l.userName||"未知"),1)])],8,Qe))),128))])),[[R,P.value]]),!P.value&&L.value.length===0?(c(),n("div",as,[o(b,{description:"暂无推荐歌单"},{image:a(()=>[o(i,{style:{"font-size":"80px",color:"#ddd"}},{default:a(()=>[o(u(ue))]),_:1})]),_:1})])):D("",!0)]),o(he,{modelValue:$.value,"onUpdate:modelValue":t[0]||(t[0]=l=>$.value=l),"song-id":M.value,onSuccess:W},null,8,["modelValue","song-id"])])}}},hs=te(cs,[["__scopeId","data-v-11a0ef1d"]]);export{hs as default};
