import{r as a,c as e,d as s,e as l,m as t,q as r,t as i,D as o,H as n,a8 as c,B as u,W as d,G as v,Y as p,T as h,al as m,u as g,A as y,F as k,L as f}from"./vue-vendor-BzZaYQKc.js";import{u as w}from"./player-BodKjA0D.js";import{_ as C,u as _}from"./index-Cb8xoRiw.js";import{s as L}from"./song-C8TMBuSO.js";import{g as j}from"./artist-B-rHTsNg.js";import{r as z}from"./request-76E38DvM.js";import{t as T,b as x}from"./favorite-CBOsHs95.js";import{aa as V,ab as b,o as M,P as H,ac as P,a5 as S,_ as $,a4 as F,a9 as U,a3 as q,a6 as A,L as E}from"./element-plus-CCPVPfgN.js";import{P as I}from"./PlaylistSelector-BQ_G-bWe.js";import"./PlaylistCover-D3NetioR.js";const R={class:"search-page"},B={class:"search-header"},D={class:"search-container"},G={key:0,class:"initial-state"},K={class:"hot-search-section"},W={class:"section-header"},Y={class:"hot-search-list"},J=["onClick"],N={class:"hot-keyword"},O={key:0,class:"search-history-section"},Q={class:"section-header"},X={class:"history-list"},Z=["onClick"],aa={class:"history-keyword"},ea={key:1,class:"loading-state"},sa={key:0,class:"search-results"},la={key:0,class:"songs-container"},ta={class:"result-header"},ra={class:"song-list"},ia=["onClick"],oa={class:"song-index"},na=["src"],ca={class:"song-info"},ua=["innerHTML"],da={class:"song-artist"},va=["onClick","innerHTML"],pa={key:0},ha={key:0},ma={class:"song-duration"},ga={class:"song-actions"},ya={key:1,class:"empty-state"},ka={key:0,class:"search-results"},fa={key:0,class:"artists-container"},wa={class:"result-header"},Ca={class:"artist-grid"},_a=["onClick"],La={class:"artist-avatar-wrapper"},ja=["src"],za={class:"artist-overlay"},Ta={class:"artist-info"},xa=["innerHTML"],Va={class:"artist-region"},ba={key:1,class:"empty-state"},Ma=C({__name:"Search",setup(C){const Ma=m(),Ha=w(),Pa=_(),Sa=a(""),$a=a("songs"),Fa=a(!1),Ua=a(!1),qa=a(1),Aa=a(20),Ea=[{label:"🎵 单曲",value:"songs"},{label:"👤 歌手",value:"artists"}],Ia=a([]),Ra=a(0),Ba=a([]),Da=a(0),Ga=a([]),Ka=a([]),Wa=a([]),Ya=a({}),Ja=a(!1),Na=a(null);let Oa=null;const Qa=e(()=>"songs"===$a.value?"搜索歌曲名称":"搜索歌手名称");s(()=>{Xa(),Za(),le()});const Xa=async()=>{try{const a=await((a=10)=>z({url:"/api/user/search-history/hot",method:"get",params:{limit:a}}))(10);200===a.code&&(Ka.value=a.data||[])}catch(a){console.error("加载热门搜索失败:",a),Ka.value=["周杰伦","七里香","林俊杰","薛之谦","演员"]}},Za=async()=>{try{const a=await z({url:"/api/user/search-history",method:"get"});200===a.code&&(Wa.value=a.data||[])}catch(a){console.error("加载搜索历史失败:",a),Wa.value=[]}},ae=async a=>{if(a.trim())try{await(a=>z({url:"/api/user/search-history",method:"post",data:{keyword:a}}))(a),await Za()}catch(e){console.error("保存搜索历史失败:",e)}},ee=async()=>{try{const a=await z({url:"/api/user/search-history/clear",method:"delete"});200===a.code?(Wa.value=[],E.success("已清空搜索历史")):E.error(a.message||"清空失败")}catch(a){console.error("清空搜索历史失败:",a),E.error("清空失败，请稍后重试")}},se=async a=>{try{const s=await(e=a,z({url:`/api/user/search-history/${e}`,method:"delete"}));200===s.code?(Wa.value=Wa.value.filter(e=>e.id!==a),E.success("已删除")):E.error(s.message||"删除失败")}catch(s){console.error("删除搜索历史失败:",s),E.error("删除失败，请稍后重试")}var e},le=async()=>{try{const a=await j({page:0,size:100});200===a.code&&(Ga.value=a.data.content||[])}catch(a){console.error("加载歌手列表失败:",a)}};l($a,()=>{Sa.value.trim()&&Ua.value&&(qa.value=1,te())});const te=async()=>{if(!Sa.value.trim())return Ia.value=[],Ba.value=[],void(Ua.value=!1);Fa.value=!0,Ua.value=!0,ae(Sa.value.trim());try{"songs"===$a.value?await re():await oe()}catch(a){console.error("搜索失败:",a),E.error("搜索失败，请稍后重试")}finally{Fa.value=!1}},re=async()=>{try{const a=await L({keyword:Sa.value.trim(),page:qa.value-1,size:Aa.value});200===a.code&&(Ia.value=a.data.content||[],Ra.value=a.data.totalElements||0,await ie())}catch(a){throw console.error("搜索歌曲失败:",a),a}},ie=async()=>{if(Pa.isLogin&&0!==Ia.value.length)try{const a=Ia.value.map(a=>a.id),e=await x(a);200===e.code&&(Ya.value=e.data||{})}catch(a){console.error("加载收藏状态失败:",a)}},oe=async()=>{try{const a=Sa.value.trim().toLowerCase(),e=Ga.value.filter(e=>e.name.toLowerCase().includes(a)||e.region&&e.region.toLowerCase().includes(a));Ba.value=e,Da.value=e.length}catch(a){throw console.error("搜索歌手失败:",a),a}},ne=()=>{if(!Sa.value.trim())return Ia.value=[],Ba.value=[],Ua.value=!1,Ra.value=0,void(Da.value=0);Oa&&clearTimeout(Oa),Oa=setTimeout(()=>{qa.value=1,te()},500)},ce=a=>{Ha.play(a,Ia.value)},ue=a=>{if(!a)return"--:--";return`${Math.floor(a/60)}:${(a%60).toString().padStart(2,"0")}`},de=a=>{if(!Sa.value||!a)return a;const e=new RegExp(`(${Sa.value})`,"gi");return a.replace(e,'<span class="highlight">$1</span>')},ve=()=>{te(),window.scrollTo({top:0,behavior:"smooth"})},pe=a=>{a&&Ma.push(`/artist/${a}`)},he=()=>{};return(a,e)=>{const s=c("el-segmented"),l=c("el-icon"),m=c("el-input"),w=c("el-button"),C=c("el-pagination"),_=c("el-empty");return r(),t("div",R,[i("div",B,[i("div",D,[n(s,{modelValue:$a.value,"onUpdate:modelValue":e[0]||(e[0]=a=>$a.value=a),options:Ea,size:"large",class:"search-type-selector"},null,8,["modelValue"]),n(m,{modelValue:Sa.value,"onUpdate:modelValue":e[1]||(e[1]=a=>Sa.value=a),placeholder:Qa.value,clearable:"",size:"large",class:"search-input",onInput:ne,onKeyup:d(te,["enter"])},{prefix:u(()=>[n(l,null,{default:u(()=>[n(g(V))]),_:1})]),_:1},8,["modelValue","placeholder"])])]),Sa.value||Ua.value?o("",!0):(r(),t("div",G,[i("div",K,[i("div",W,[n(l,{class:"header-icon"},{default:u(()=>[n(g(b))]),_:1}),e[4]||(e[4]=i("h3",null,"热门搜索",-1))]),i("div",Y,[(r(!0),t(v,null,p(Ka.value,(a,e)=>(r(),t("div",{key:e,class:"hot-search-item",onClick:e=>{return s=a,Sa.value=s,$a.value="songs",void te();var s}},[i("span",{class:M(["hot-rank",{"top-three":e<3}])},H(e+1),3),i("span",N,H(a),1),e<3?(r(),y(l,{key:0,class:"hot-icon"},{default:u(()=>[n(g(P))]),_:1})):o("",!0)],8,J))),128))])]),Wa.value.length>0?(r(),t("div",O,[i("div",Q,[n(l,{class:"header-icon"},{default:u(()=>[n(g(S))]),_:1}),e[6]||(e[6]=i("h3",null,"搜索历史",-1)),n(w,{text:"",type:"danger",size:"small",onClick:ee},{default:u(()=>[...e[5]||(e[5]=[k(" 清空历史 ",-1)])]),_:1})]),i("div",X,[(r(!0),t(v,null,p(Wa.value,a=>(r(),t("div",{key:a.id,class:"history-item",onClick:e=>{return s=a.keyword,Sa.value=s,$a.value="songs",void te();var s}},[i("span",aa,H(a.keyword),1),n(l,{class:"delete-icon",onClick:f(e=>se(a.id),["stop"])},{default:u(()=>[n(g($))]),_:1},8,["onClick"])],8,Z))),128))])])):o("",!0)])),Fa.value?(r(),t("div",ea,[n(l,{class:"is-loading"},{default:u(()=>[n(g(F))]),_:1}),e[7]||(e[7]=i("p",null,"搜索中...",-1))])):o("",!0),n(h,{name:"fade"},{default:u(()=>[!Fa.value&&Sa.value&&"songs"===$a.value?(r(),t("div",sa,[Ia.value.length>0?(r(),t("div",la,[i("div",ta,[i("h3",null,"找到 "+H(Ra.value)+" 首歌曲",1)]),i("div",ra,[(r(!0),t(v,null,p(Ia.value,(a,e)=>(r(),t("div",{key:a.id,class:"song-item",onClick:e=>ce(a)},[i("div",oa,H((qa.value-1)*Aa.value+e+1),1),i("img",{src:a.cover||"https://via.placeholder.com/60?text=Music",class:"song-cover"},null,8,na),i("div",ca,[i("div",{class:"song-name",innerHTML:de(a.title)},null,8,ua),i("div",da,[(r(!0),t(v,null,p(a.artists||[],(e,s)=>{var l;return r(),t(v,{key:e.id},[i("span",{class:"clickable",onClick:f(a=>pe(e.id),["stop"]),innerHTML:de(e.name)},null,8,va),s<((null==(l=a.artists)?void 0:l.length)||0)-1?(r(),t("span",pa," / ")):o("",!0)],64)}),128)),a.artists&&0!==a.artists.length?o("",!0):(r(),t("span",ha,"未知歌手"))])]),i("div",ma,H(ue(a.duration)),1),i("div",ga,[n(w,{icon:"CaretRight",circle:"",size:"small",onClick:f(e=>ce(a),["stop"]),title:"播放"},null,8,["onClick"]),n(w,{icon:"Plus",circle:"",size:"small",onClick:f(e=>(a=>{Ha.addToPlaylist(a),E.success(`已添加到播放列表: ${a.title}`)})(a),["stop"]),title:"添加到播放列表"},null,8,["onClick"]),n(w,{icon:"FolderAdd",circle:"",size:"small",onClick:f(e=>(a=>{if(!Pa.isLogin)return E.warning("请先登录"),void Ma.push("/login");Na.value=a,Ja.value=!0})(a.id),["stop"]),title:"添加到歌单"},null,8,["onClick"]),n(w,{icon:Ya.value[a.id]?"StarFilled":"Star",circle:"",size:"small",type:Ya.value[a.id]?"danger":"",onClick:f(e=>(async a=>{if(!Pa.isLogin)return E.warning("请先登录"),void Ma.push("/login");try{const e=await T(a);if(200===e.code){const s=e.data.isFavorite;Ya.value[a]=s,E.success(s?"收藏成功":"取消收藏成功")}else E.error(e.message||"操作失败")}catch(e){console.error("收藏操作失败:",e),E.error("操作失败，请稍后重试")}})(a.id),["stop"]),title:"收藏"},null,8,["icon","type","onClick"])])],8,ia))),128))]),Ra.value>Aa.value?(r(),y(C,{key:0,"current-page":qa.value,"onUpdate:currentPage":e[2]||(e[2]=a=>qa.value=a),"page-size":Aa.value,total:Ra.value,layout:"prev, pager, next",class:"pagination",onCurrentChange:ve},null,8,["current-page","page-size","total"])):o("",!0)])):(r(),t("div",ya,[n(_,{description:"没有找到相关歌曲"},{image:u(()=>[n(l,{class:"empty-icon"},{default:u(()=>[n(g(U))]),_:1})]),_:1})]))])):o("",!0)]),_:1}),n(h,{name:"fade"},{default:u(()=>[!Fa.value&&Sa.value&&"artists"===$a.value?(r(),t("div",ka,[Ba.value.length>0?(r(),t("div",fa,[i("div",wa,[i("h3",null,"找到 "+H(Da.value)+" 位歌手",1)]),i("div",Ca,[(r(!0),t(v,null,p(Ba.value,a=>(r(),t("div",{key:a.id,class:"artist-card",onClick:e=>pe(a.id)},[i("div",La,[i("img",{src:a.avatar||"https://via.placeholder.com/200?text=Artist",class:"artist-avatar"},null,8,ja),i("div",za,[n(l,{class:"play-icon"},{default:u(()=>[n(g(q))]),_:1})])]),i("div",Ta,[i("div",{class:"artist-name",innerHTML:de(a.name)},null,8,xa),i("div",Va,H(a.region||"未知地区"),1)])],8,_a))),128))])])):(r(),t("div",ba,[n(_,{description:"没有找到相关歌手"},{image:u(()=>[n(l,{class:"empty-icon"},{default:u(()=>[n(g(A))]),_:1})]),_:1})]))])):o("",!0)]),_:1}),n(I,{modelValue:Ja.value,"onUpdate:modelValue":e[3]||(e[3]=a=>Ja.value=a),"song-id":Na.value,onSuccess:he},null,8,["modelValue","song-id"])])}}},[["__scopeId","data-v-a4af77d0"]]);export{Ma as default};
