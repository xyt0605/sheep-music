import{_ as we,f as Ce,g as n,k as Se,i as He,l as Te,c as r,o as l,a,z as y,d as o,r as H,w as i,j as $e,I as T,J as M,T as W,u as Ve,n as g,a1 as ze,a2 as Le,q as X,K as Ae,t as f,a3 as Pe,V as Me,e as be,H as Fe,L as $,S as xe,a0 as Re,R as De,Y as Ee,E as d}from"./index-C5bpx5EP.js";import{u as Ke}from"./player-BQpaZ7da.js";import{s as Ue}from"./song-BK1efH3L.js";import{g as Be}from"./artist-Ch0pzSJw.js";import{r as b}from"./request-WXopXHOE.js";import{t as Ne,b as qe}from"./favorite-Dc9dt7b4.js";import{P as Ie}from"./PlaylistSelector-J5lt_TYX.js";import"./PlaylistCover-Db5TaDqG.js";const je=(w=10)=>b({url:"/api/user/search-history/hot",method:"get",params:{limit:w}}),Je=()=>b({url:"/api/user/search-history",method:"get"}),Oe=w=>b({url:"/api/user/search-history",method:"post",data:{keyword:w}}),Ye=w=>b({url:`/api/user/search-history/${w}`,method:"delete"}),Ge=()=>b({url:"/api/user/search-history/clear",method:"delete"}),Qe={class:"search-page"},We={class:"search-header"},Xe={class:"search-container"},Ze={key:0,class:"initial-state"},es={class:"hot-search-section"},ss={class:"section-header"},ts={class:"hot-search-list"},as=["onClick"],os={class:"hot-keyword"},ls={key:0,class:"search-history-section"},rs={class:"section-header"},ns={class:"history-list"},cs=["onClick"],is={class:"history-keyword"},us={key:1,class:"loading-state"},ds={key:0,class:"search-results"},hs={key:0,class:"songs-container"},vs={class:"result-header"},_s={class:"song-list"},ps=["onClick"],ys={class:"song-index"},gs=["src"],ms={class:"song-info"},fs=["innerHTML"],ks={class:"song-artist"},ws=["onClick","innerHTML"],Cs={key:0},Ss={key:0},Hs={class:"song-duration"},Ts={class:"song-actions"},$s={key:1,class:"empty-state"},Vs={key:0,class:"search-results"},zs={key:0,class:"artists-container"},Ls={class:"result-header"},As={class:"artist-grid"},Ps=["onClick"],Ms={class:"artist-avatar-wrapper"},bs=["src"],Fs={class:"artist-overlay"},xs={class:"artist-info"},Rs=["innerHTML"],Ds={class:"artist-region"},Es={key:1,class:"empty-state"},Ks="https://via.placeholder.com/60?text=Music",Us="https://via.placeholder.com/200?text=Artist",Bs={__name:"Search",setup(w){const R=Ve(),q=Ke(),D=Ce(),c=n(""),h=n("songs"),V=n(!1),z=n(!1),C=n(1),F=n(20),Z=[{label:"🎵 单曲",value:"songs"},{label:"👤 歌手",value:"artists"}],m=n([]),L=n(0),A=n([]),E=n(0),I=n([]),K=n([]),k=n([]),x=n({}),U=n(!1),j=n(null);let B=null;const ee=Se(()=>h.value==="songs"?"搜索歌曲名称":"搜索歌手名称");He(()=>{se(),J(),le()});const se=async()=>{try{const e=await je(10);e.code===200&&(K.value=e.data||[])}catch(e){console.error("加载热门搜索失败:",e),K.value=["周杰伦","七里香","林俊杰","薛之谦","演员"]}},J=async()=>{try{const e=await Je();e.code===200&&(k.value=e.data||[])}catch(e){console.error("加载搜索历史失败:",e),k.value=[]}},te=async e=>{if(e.trim())try{await Oe(e),await J()}catch(s){console.error("保存搜索历史失败:",s)}},ae=async()=>{try{const e=await Ge();e.code===200?(k.value=[],d.success("已清空搜索历史")):d.error(e.message||"清空失败")}catch(e){console.error("清空搜索历史失败:",e),d.error("清空失败，请稍后重试")}},oe=async e=>{try{const s=await Ye(e);s.code===200?(k.value=k.value.filter(u=>u.id!==e),d.success("已删除")):d.error(s.message||"删除失败")}catch(s){console.error("删除搜索历史失败:",s),d.error("删除失败，请稍后重试")}},le=async()=>{try{const e=await Be({page:0,size:100});e.code===200&&(I.value=e.data.content||[])}catch(e){console.error("加载歌手列表失败:",e)}};Te(h,()=>{c.value.trim()&&z.value&&(C.value=1,S())});const S=async()=>{if(!c.value.trim()){m.value=[],A.value=[],z.value=!1;return}V.value=!0,z.value=!0,te(c.value.trim());try{h.value==="songs"?await re():await ie()}catch(e){console.error("搜索失败:",e),d.error("搜索失败，请稍后重试")}finally{V.value=!1}},re=async()=>{try{const e=await Ue({keyword:c.value.trim(),page:C.value-1,size:F.value});e.code===200&&(m.value=e.data.content||[],L.value=e.data.totalElements||0,await ne())}catch(e){throw console.error("搜索歌曲失败:",e),e}},ne=async()=>{if(!(!D.isLogin||m.value.length===0))try{const e=m.value.map(u=>u.id),s=await qe(e);s.code===200&&(x.value=s.data||{})}catch(e){console.error("加载收藏状态失败:",e)}},ce=async e=>{if(!D.isLogin){d.warning("请先登录"),R.push("/login");return}try{const s=await Ne(e);if(s.code===200){const u=s.data.isFavorite;x.value[e]=u,d.success(u?"收藏成功":"取消收藏成功")}else d.error(s.message||"操作失败")}catch(s){console.error("收藏操作失败:",s),d.error("操作失败，请稍后重试")}},ie=async()=>{try{const e=c.value.trim().toLowerCase(),s=I.value.filter(u=>u.name.toLowerCase().includes(e)||u.region&&u.region.toLowerCase().includes(e));A.value=s,E.value=s.length}catch(e){throw console.error("搜索歌手失败:",e),e}},ue=()=>{if(!c.value.trim()){m.value=[],A.value=[],z.value=!1,L.value=0,E.value=0;return}B&&clearTimeout(B),B=setTimeout(()=>{C.value=1,S()},500)},de=e=>{c.value=e,h.value="songs",S()},he=e=>{c.value=e,h.value="songs",S()},O=e=>{q.play(e,m.value)},ve=e=>{q.addToPlaylist(e),d.success(`已添加到播放列表: ${e.title}`)},_e=e=>{if(!e)return"--:--";const s=Math.floor(e/60),u=e%60;return`${s}:${u.toString().padStart(2,"0")}`},N=e=>{if(!c.value||!e)return e;const s=new RegExp(`(${c.value})`,"gi");return e.replace(s,'<span class="highlight">$1</span>')},pe=()=>{S(),window.scrollTo({top:0,behavior:"smooth"})},Y=e=>{e&&R.push(`/artist/${e}`)},ye=e=>{if(!D.isLogin){d.warning("请先登录"),R.push("/login");return}j.value=e,U.value=!0},ge=()=>{};return(e,s)=>{const u=H("el-segmented"),v=H("el-icon"),me=H("el-input"),P=H("el-button"),fe=H("el-pagination"),G=H("el-empty");return l(),r("div",Qe,[a("div",We,[a("div",Xe,[o(u,{modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=t=>h.value=t),options:Z,size:"large",class:"search-type-selector"},null,8,["modelValue"]),o(me,{modelValue:c.value,"onUpdate:modelValue":s[1]||(s[1]=t=>c.value=t),placeholder:ee.value,clearable:"",size:"large",class:"search-input",onInput:ue,onKeyup:$e(S,["enter"])},{prefix:i(()=>[o(v,null,{default:i(()=>[o(g(ze))]),_:1})]),_:1},8,["modelValue","placeholder"])])]),!c.value&&!z.value?(l(),r("div",Ze,[a("div",es,[a("div",ss,[o(v,{class:"header-icon"},{default:i(()=>[o(g(Le))]),_:1}),s[4]||(s[4]=a("h3",null,"热门搜索",-1))]),a("div",ts,[(l(!0),r(T,null,M(K.value,(t,_)=>(l(),r("div",{key:_,class:"hot-search-item",onClick:p=>de(t)},[a("span",{class:Ae(["hot-rank",{"top-three":_<3}])},f(_+1),3),a("span",os,f(t),1),_<3?(l(),X(v,{key:0,class:"hot-icon"},{default:i(()=>[o(g(Pe))]),_:1})):y("",!0)],8,as))),128))])]),k.value.length>0?(l(),r("div",ls,[a("div",rs,[o(v,{class:"header-icon"},{default:i(()=>[o(g(Me))]),_:1}),s[6]||(s[6]=a("h3",null,"搜索历史",-1)),o(P,{text:"",type:"danger",size:"small",onClick:ae},{default:i(()=>[...s[5]||(s[5]=[be(" 清空历史 ",-1)])]),_:1})]),a("div",ns,[(l(!0),r(T,null,M(k.value,t=>(l(),r("div",{key:t.id,class:"history-item",onClick:_=>he(t.keyword)},[a("span",is,f(t.keyword),1),o(v,{class:"delete-icon",onClick:$(_=>oe(t.id),["stop"])},{default:i(()=>[o(g(Fe))]),_:1},8,["onClick"])],8,cs))),128))])])):y("",!0)])):y("",!0),V.value?(l(),r("div",us,[o(v,{class:"is-loading"},{default:i(()=>[o(g(xe))]),_:1}),s[7]||(s[7]=a("p",null,"搜索中...",-1))])):y("",!0),o(W,{name:"fade"},{default:i(()=>[!V.value&&c.value&&h.value==="songs"?(l(),r("div",ds,[m.value.length>0?(l(),r("div",hs,[a("div",vs,[a("h3",null,"找到 "+f(L.value)+" 首歌曲",1)]),a("div",_s,[(l(!0),r(T,null,M(m.value,(t,_)=>(l(),r("div",{key:t.id,class:"song-item",onClick:p=>O(t)},[a("div",ys,f((C.value-1)*F.value+_+1),1),a("img",{src:t.cover||Ks,class:"song-cover"},null,8,gs),a("div",ms,[a("div",{class:"song-name",innerHTML:N(t.title)},null,8,fs),a("div",ks,[(l(!0),r(T,null,M(t.artists||[],(p,ke)=>{var Q;return l(),r(T,{key:p.id},[a("span",{class:"clickable",onClick:$(Ns=>Y(p.id),["stop"]),innerHTML:N(p.name)},null,8,ws),ke<(((Q=t.artists)==null?void 0:Q.length)||0)-1?(l(),r("span",Cs," / ")):y("",!0)],64)}),128)),!t.artists||t.artists.length===0?(l(),r("span",Ss,"未知歌手")):y("",!0)])]),a("div",Hs,f(_e(t.duration)),1),a("div",Ts,[o(P,{icon:"CaretRight",circle:"",size:"small",onClick:$(p=>O(t),["stop"]),title:"播放"},null,8,["onClick"]),o(P,{icon:"Plus",circle:"",size:"small",onClick:$(p=>ve(t),["stop"]),title:"添加到播放列表"},null,8,["onClick"]),o(P,{icon:"FolderAdd",circle:"",size:"small",onClick:$(p=>ye(t.id),["stop"]),title:"添加到歌单"},null,8,["onClick"]),o(P,{icon:x.value[t.id]?"StarFilled":"Star",circle:"",size:"small",type:x.value[t.id]?"danger":"",onClick:$(p=>ce(t.id),["stop"]),title:"收藏"},null,8,["icon","type","onClick"])])],8,ps))),128))]),L.value>F.value?(l(),X(fe,{key:0,"current-page":C.value,"onUpdate:currentPage":s[2]||(s[2]=t=>C.value=t),"page-size":F.value,total:L.value,layout:"prev, pager, next",class:"pagination",onCurrentChange:pe},null,8,["current-page","page-size","total"])):y("",!0)])):(l(),r("div",$s,[o(G,{description:"没有找到相关歌曲"},{image:i(()=>[o(v,{class:"empty-icon"},{default:i(()=>[o(g(Re))]),_:1})]),_:1})]))])):y("",!0)]),_:1}),o(W,{name:"fade"},{default:i(()=>[!V.value&&c.value&&h.value==="artists"?(l(),r("div",Vs,[A.value.length>0?(l(),r("div",zs,[a("div",Ls,[a("h3",null,"找到 "+f(E.value)+" 位歌手",1)]),a("div",As,[(l(!0),r(T,null,M(A.value,t=>(l(),r("div",{key:t.id,class:"artist-card",onClick:_=>Y(t.id)},[a("div",Ms,[a("img",{src:t.avatar||Us,class:"artist-avatar"},null,8,bs),a("div",Fs,[o(v,{class:"play-icon"},{default:i(()=>[o(g(De))]),_:1})])]),a("div",xs,[a("div",{class:"artist-name",innerHTML:N(t.name)},null,8,Rs),a("div",Ds,f(t.region||"未知地区"),1)])],8,Ps))),128))])])):(l(),r("div",Es,[o(G,{description:"没有找到相关歌手"},{image:i(()=>[o(v,{class:"empty-icon"},{default:i(()=>[o(g(Ee))]),_:1})]),_:1})]))])):y("",!0)]),_:1}),o(Ie,{modelValue:U.value,"onUpdate:modelValue":s[3]||(s[3]=t=>U.value=t),"song-id":j.value,onSuccess:ge},null,8,["modelValue","song-id"])])}}},Ws=we(Bs,[["__scopeId","data-v-a4af77d0"]]);export{Ws as default};
