import{m as s,q as l,H as a,t as e,B as t,a8 as i,D as o,A as n,F as r,G as c,Y as d,r as u,c as p,d as y,al as g,am as v,L as m}from"./vue-vendor-BzZaYQKc.js";import{u as f}from"./player-BodKjA0D.js";import{_ as k,u as C}from"./index-Cb8xoRiw.js";import{P as h,e as S,i as _,r as P,f as w}from"./PlaylistCover-D3NetioR.js";import{ad as z,ah as b,af as D,U as T,a3 as A,Y as j,Z as L,a2 as x,a4 as I,P as V,L as $,$ as R}from"./element-plus-CCPVPfgN.js";import{P as E}from"./PlaylistSelector-BQ_G-bWe.js";import"./song-C8TMBuSO.js";import"./request-76E38DvM.js";const O={class:"playlist-detail"},U={key:0,class:"loading-container"},B={key:1,class:"detail-container"},F={class:"playlist-header"},H={class:"cover-section"},M={class:"info-section"},q={class:"playlist-tag"},Y={class:"playlist-name"},G={class:"creator-info"},N={key:0,class:"playlist-description"},Z={class:"playlist-stats"},J={class:"stat-item"},K={class:"stat-item"},Q={class:"action-buttons"},W={class:"songs-section"},X={class:"section-header"},ss={class:"song-count"},ls={key:0,class:"song-list"},as=["onClick"],es={class:"song-index"},ts=["src"],is={class:"song-info"},os={class:"song-name"},ns={class:"song-artist"},rs=["onClick"],cs={key:0},ds={key:1},us={class:"song-duration"},ps={key:1,class:"empty-state"},ys={key:2,class:"error-state"};const gs=k({name:"PlaylistDetail",components:{PlaylistCover:h,PlaylistSelector:E,Loading:I,User:x,List:L,Headset:j,CaretRight:A,Refresh:T,Edit:D,Plus:b,Delete:z},setup(){const s=g(),l=v(),a=f(),e=C(),t=u(!1),i=u(null),o=u([]),n=u(!1),r=u(null),c=p(()=>i.value&&e.userInfo&&i.value.userId===e.userInfo.id),d=async()=>{t.value=!0;try{const s=l.params.id,a=await S(s);200===a.code&&(i.value=a.data,await m(s),_(s).catch(()=>{}))}catch(s){console.error("加载歌单失败:",s),$.error("加载歌单失败")}finally{t.value=!1}},m=async s=>{try{const l=await w(s,{page:0,size:500});200===l.code&&(o.value=l.data.content||[])}catch(l){console.error("加载歌曲列表失败:",l)}};return y(()=>{d()}),{loading:t,playlist:i,songs:o,defaultCover:"https://via.placeholder.com/200?text=Music",isOwner:c,playAll:(s=!1)=>{if(0===o.value.length)return void $.warning("歌单没有歌曲");const l=o.value.map(s=>s.song).filter(s=>s);if(s){const s=[...l].sort(()=>Math.random()-.5);a.play(s[0],s)}else a.play(l[0],l);$.success(s?"开始随机播放":"开始播放全部")},playSong:(s,l)=>{if(!s)return;const e=o.value.map(s=>s.song).filter(s=>s);a.play(s,e)},addToPlaylist:s=>{s&&(a.addToPlaylist(s),$.success(`已添加到播放列表: ${s.title}`))},removeSong:async s=>{try{await R.confirm("确定要从歌单中移除这首歌吗？","确认移除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});200===(await P(i.value.id,s)).code&&($.success("移除成功"),await d())}catch(l){"cancel"!==l&&$.error("移除失败")}},goToEdit:()=>{s.push("/my-music?tab=playlists")},goToArtist:l=>{l&&s.push(`/artist/${l}`)},formatDuration:s=>{if(!s)return"--:--";return`${Math.floor(s/60)}:${(s%60).toString().padStart(2,"0")}`},formatDate:s=>{if(!s)return"";return new Date(s).toLocaleDateString("zh-CN")},formatCount:s=>s?s>=1e4?(s/1e4).toFixed(1)+"万":s:0,router:s,playlistSelectorVisible:n,selectedSongId:r,showAddToPlaylistDialog:l=>{if(l){if(!e.isLogin)return $.warning("请先登录"),void s.push("/login");r.value=l,n.value=!0}},handleAddSuccess:()=>{}}}},[["render",function(u,p,y,g,v,f){var k;const C=i("Loading"),h=i("el-icon"),S=i("PlaylistCover"),_=i("el-tag"),P=i("User"),w=i("List"),z=i("Headset"),b=i("CaretRight"),D=i("el-button"),T=i("Refresh"),A=i("Edit"),j=i("el-empty"),L=i("PlaylistSelector");return l(),s("div",O,[g.loading?(l(),s("div",U,[a(h,{class:"is-loading"},{default:t(()=>[a(C)]),_:1}),p[5]||(p[5]=e("p",null,"加载中...",-1))])):g.playlist?(l(),s("div",B,[e("div",F,[e("div",H,[a(S,{cover:g.playlist.cover,size:250,"default-cover":g.defaultCover,class:"playlist-cover"},null,8,["cover","default-cover"])]),e("div",M,[e("div",q,[g.playlist.category?(l(),n(_,{key:0,type:"primary",size:"small"},{default:t(()=>[r(V(g.playlist.category),1)]),_:1})):o("",!0),g.playlist.isPublic?(l(),n(_,{key:1,type:"success",size:"small"},{default:t(()=>[...p[6]||(p[6]=[r("公开",-1)])]),_:1})):(l(),n(_,{key:2,type:"info",size:"small"},{default:t(()=>[...p[7]||(p[7]=[r("私有",-1)])]),_:1}))]),e("h1",Y,V(g.playlist.name),1),e("div",G,[a(h,null,{default:t(()=>[a(P)]),_:1}),e("span",null,"创建者："+V((null==(k=g.playlist.creator)?void 0:k.nickname)||"未知"),1),p[8]||(p[8]=e("span",{class:"separator"},"|",-1)),e("span",null,V(g.formatDate(g.playlist.createTime)),1)]),g.playlist.description?(l(),s("p",N,V(g.playlist.description),1)):o("",!0),e("div",Z,[e("span",J,[a(h,null,{default:t(()=>[a(w)]),_:1}),r(" "+V(g.playlist.songCount||0)+" 首歌曲 ",1)]),e("span",K,[a(h,null,{default:t(()=>[a(z)]),_:1}),r(" 播放 "+V(g.formatCount(g.playlist.playCount))+" 次 ",1)])]),e("div",Q,[a(D,{type:"primary",size:"large",onClick:g.playAll},{default:t(()=>[a(h,null,{default:t(()=>[a(b)]),_:1}),p[9]||(p[9]=r(" 播放全部 ",-1))]),_:1},8,["onClick"]),a(D,{size:"large",onClick:p[0]||(p[0]=s=>g.playAll(!0))},{default:t(()=>[a(h,null,{default:t(()=>[a(T)]),_:1}),p[10]||(p[10]=r(" 随机播放 ",-1))]),_:1}),g.isOwner?(l(),n(D,{key:0,size:"large",onClick:g.goToEdit},{default:t(()=>[a(h,null,{default:t(()=>[a(A)]),_:1}),p[11]||(p[11]=r(" 编辑 ",-1))]),_:1},8,["onClick"])):o("",!0)])])]),e("div",W,[e("div",X,[p[12]||(p[12]=e("h3",null,"歌曲列表",-1)),e("span",ss,"共 "+V(g.songs.length)+" 首",1)]),g.songs.length>0?(l(),s("div",ls,[(l(!0),s(c,null,d(g.songs,(t,i)=>{var r,u,y,v;return l(),s("div",{key:t.id,class:"song-item",onClick:s=>g.playSong(t.song,i)},[e("div",es,V(i+1),1),e("img",{src:(null==(r=t.song)?void 0:r.cover)||g.defaultCover,class:"song-cover"},null,8,ts),e("div",is,[e("div",os,V((null==(u=t.song)?void 0:u.title)||"未知歌曲"),1),e("div",ns,[(null==(y=t.song)?void 0:y.artists)&&t.song.artists.length>0?(l(!0),s(c,{key:0},d(t.song.artists,(a,i)=>(l(),s("span",{key:a.id},[e("span",{class:"clickable",onClick:m(s=>g.goToArtist(a.id),["stop"])},V(a.name),9,rs),i<t.song.artists.length-1?(l(),s("span",cs," / ")):o("",!0)]))),128)):(l(),s("span",ds,"未知歌手"))])]),e("div",us,V(g.formatDuration(null==(v=t.song)?void 0:v.duration)),1),e("div",{class:"song-actions",onClick:p[1]||(p[1]=m(()=>{},["stop"]))},[a(D,{icon:"CaretRight",circle:"",size:"small",onClick:s=>g.playSong(t.song,i),title:"播放"},null,8,["onClick"]),a(D,{icon:"Plus",circle:"",size:"small",onClick:s=>g.addToPlaylist(t.song),title:"添加到播放列表"},null,8,["onClick"]),a(D,{icon:"FolderAdd",circle:"",size:"small",onClick:s=>{var l;return g.showAddToPlaylistDialog(null==(l=t.song)?void 0:l.id)},title:"添加到其他歌单"},null,8,["onClick"]),g.isOwner?(l(),n(D,{key:0,icon:"Delete",circle:"",size:"small",onClick:s=>g.removeSong(t.songId),title:"从歌单移除"},null,8,["onClick"])):o("",!0)])],8,as)}),128))])):(l(),s("div",ps,[a(j,{description:"歌单还没有歌曲"},{default:t(()=>[g.isOwner?(l(),n(D,{key:0,type:"primary",onClick:p[2]||(p[2]=s=>g.router.push("/"))},{default:t(()=>[...p[13]||(p[13]=[r("去首页添加歌曲",-1)])]),_:1})):o("",!0)]),_:1})]))])])):(l(),s("div",ys,[a(j,{description:"歌单不存在或已被删除"},{default:t(()=>[a(D,{type:"primary",onClick:p[3]||(p[3]=s=>u.$router.back())},{default:t(()=>[...p[14]||(p[14]=[r("返回",-1)])]),_:1})]),_:1})])),a(L,{modelValue:g.playlistSelectorVisible,"onUpdate:modelValue":p[4]||(p[4]=s=>g.playlistSelectorVisible=s),"song-id":g.selectedSongId,onSuccess:g.handleAddSuccess},null,8,["modelValue","song-id","onSuccess"])])}],["__scopeId","data-v-bb9b777c"]]);export{gs as default};
