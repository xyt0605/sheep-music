import{_ as U,O as q,P as J,F as K,c as a,o as c,a as s,d as i,t as u,w as p,r as v,z as S,I as f,J as D,f as O,g as A,i as j,E as C,u as G,e as M,K as Q,L as _}from"./index-C5bpx5EP.js";import{u as W}from"./player-BQpaZ7da.js";import{g as X,a as Y}from"./song-BK1efH3L.js";import{b as Z,t as $}from"./favorite-Dc9dt7b4.js";import{P as tt}from"./PlaylistSelector-J5lt_TYX.js";import"./request-WXopXHOE.js";import"./PlaylistCover-Db5TaDqG.js";const ot={name:"Home",components:{Headset:K,MagicStick:J,ArrowRight:q,PlaylistSelector:tt},setup(){const h=G(),n=O(),R=W(),o=A([]),w=A([]),I="https://via.placeholder.com/60?text=Music",P=A({}),y=A(!1),b=A(null),r=async()=>{try{const e=await X({page:0,size:10});e.code===200&&(o.value=e.data.content||[])}catch(e){console.error("加载热门歌曲失败:",e)}},F=async()=>{try{const e=await Y({page:0,size:10});e.code===200&&(w.value=e.data.content||[])}catch(e){console.error("加载最新歌曲失败:",e)}},H=e=>{R.play(e,o.value.concat(w.value))},z=e=>{R.addToPlaylist(e),C.success(`已添加到播放列表: ${e.title}`)},N=e=>e>=1e4?(e/1e4).toFixed(1)+"万":e||0,x=e=>{if(!e)return"--:--";const d=Math.floor(e/60),g=e%60;return`${d}:${g.toString().padStart(2,"0")}`},t=e=>{e&&h.push(`/artist/${e}`)},k=e=>{h.push({path:"/rank",query:{type:e}})},l=()=>{h.push("/discover")},T=async()=>{var e,d;if(n.isLogin)try{const g=[...o.value,...w.value],B=[...new Set(g.map(V=>V.id))];if(B.length>0){const V=await Z(B);V.code===200&&(P.value=V.data||{})}}catch(g){console.error("加载收藏状态失败:",g),C.error("查询失败: "+(((d=(e=g.response)==null?void 0:e.data)==null?void 0:d.message)||g.message))}},m=async e=>{if(!n.isLogin){C.warning("请先登录"),h.push("/login");return}try{const d=await $(e);d.code===200&&(P.value[e]=d.data.isFavorite,C.success(d.message||(d.data.isFavorite?"收藏成功":"取消收藏成功")))}catch{C.error("操作失败")}},L=e=>{if(!n.isLogin){C.warning("请先登录"),h.push("/login");return}b.value=e,y.value=!0},E=()=>{};return j(async()=>{await r(),await F(),await T()}),{userStore:n,hotSongs:o,newSongs:w,defaultCover:I,favoriteSongs:P,handlePlaySong:H,handleAddToPlaylist:z,handleToggleFavorite:m,showAddToPlaylistDialog:L,handleAddSuccess:E,playlistSelectorVisible:y,selectedSongId:b,formatPlayCount:N,formatDuration:x,goToArtist:t,goToRank:k,goToDiscover:l}}},et={class:"home"},st={class:"welcome-section"},nt={class:"banner-content"},it={class:"banner-icon"},lt={class:"banner-action"},at={class:"content-section"},ct={class:"section-header"},rt={class:"song-list"},dt=["onClick"],_t=["src"],ut={class:"song-info"},vt={class:"song-name"},mt={class:"song-artist"},gt=["onClick"],ht={key:0},yt={key:0},kt={class:"song-play-count"},pt={class:"song-actions"},St={key:0,class:"empty-state"},ft={class:"content-section"},Ct={class:"section-header"},wt={class:"song-list"},Pt=["onClick"],Tt={class:"song-index"},At=["src"],bt={class:"song-info"},Ft={class:"song-name"},zt={class:"song-artist"},xt=["onClick"],Vt={key:0},Dt={key:0},Mt={class:"song-time"},Rt={class:"song-actions"},Ht={key:0,class:"empty-state"};function Nt(h,n,R,o,w,I){var x;const P=v("MagicStick"),y=v("el-icon"),b=v("ArrowRight"),r=v("el-button"),F=v("el-link"),H=v("Headset"),z=v("el-empty"),N=v("PlaylistSelector");return c(),a("div",et,[s("div",st,[s("h2",null,"你好，"+u(((x=o.userStore.userInfo)==null?void 0:x.nickname)||"音乐爱好者"),1),n[4]||(n[4]=s("p",{class:"welcome-text"}," 欢迎来到 Sheep Music，开始你的音乐之旅 ",-1))]),s("div",{class:"recommend-banner",onClick:n[0]||(n[0]=(...t)=>o.goToDiscover&&o.goToDiscover(...t))},[s("div",nt,[s("div",it,[i(y,null,{default:p(()=>[i(P)]),_:1})]),n[6]||(n[6]=s("div",{class:"banner-text"},[s("h3",null,"✨ 发现你的专属音乐"),s("p",null,"基于你的喜好，为你推荐精选歌曲和歌单")],-1)),s("div",lt,[i(r,{type:"primary",round:""},{default:p(()=>[n[5]||(n[5]=M(" 立即发现 ",-1)),i(y,{class:"ml-5"},{default:p(()=>[i(b)]),_:1})]),_:1})])])]),s("section",at,[s("div",ct,[n[8]||(n[8]=s("h3",null,"🔥 热门歌曲",-1)),i(F,{type:"primary",onClick:n[1]||(n[1]=t=>o.goToRank("hot"))},{default:p(()=>[...n[7]||(n[7]=[M("查看更多 ›",-1)])]),_:1})]),s("div",rt,[(c(!0),a(f,null,D(o.hotSongs,(t,k)=>(c(),a("div",{key:t.id,class:"song-item",onClick:l=>o.handlePlaySong(t)},[s("div",{class:Q(["song-index",{"top-three":k<3}])},u(k+1),3),s("img",{src:t.cover||o.defaultCover,class:"song-cover"},null,8,_t),s("div",ut,[s("div",vt,u(t.title),1),s("div",mt,[(c(!0),a(f,null,D(t.artists||[],(l,T)=>{var m;return c(),a(f,{key:l.id},[s("span",{class:"clickable",onClick:_(L=>o.goToArtist(l.id),["stop"])},u(l.name),9,gt),T<(((m=t.artists)==null?void 0:m.length)||0)-1?(c(),a("span",ht," / ")):S("",!0)],64)}),128)),!t.artists||t.artists.length===0?(c(),a("span",yt,"未知歌手")):S("",!0)])]),s("div",kt,[i(y,null,{default:p(()=>[i(H)]),_:1}),M(" "+u(o.formatPlayCount(t.playCount)),1)]),s("div",pt,[i(r,{icon:"CaretRight",circle:"",size:"small",onClick:_(l=>o.handlePlaySong(t),["stop"]),title:"播放"},null,8,["onClick"]),i(r,{icon:"Plus",circle:"",size:"small",onClick:_(l=>o.handleAddToPlaylist(t),["stop"]),title:"添加到播放列表"},null,8,["onClick"]),i(r,{icon:"FolderAdd",circle:"",size:"small",onClick:_(l=>o.showAddToPlaylistDialog(t.id),["stop"]),title:"添加到歌单"},null,8,["onClick"]),i(r,{icon:o.favoriteSongs[t.id]?"StarFilled":"Star",circle:"",size:"small",type:o.favoriteSongs[t.id]?"danger":"",onClick:_(l=>o.handleToggleFavorite(t.id),["stop"]),title:"收藏"},null,8,["icon","type","onClick"])])],8,dt))),128))]),o.hotSongs.length===0?(c(),a("div",St,[i(z,{description:"暂无热门歌曲"})])):S("",!0)]),s("section",ft,[s("div",Ct,[n[10]||(n[10]=s("h3",null,"🎵 新歌速递",-1)),i(F,{type:"primary",onClick:n[2]||(n[2]=t=>o.goToRank("new"))},{default:p(()=>[...n[9]||(n[9]=[M("查看更多 ›",-1)])]),_:1})]),s("div",wt,[(c(!0),a(f,null,D(o.newSongs,(t,k)=>(c(),a("div",{key:t.id,class:"song-item",onClick:l=>o.handlePlaySong(t)},[s("div",Tt,u(k+1),1),s("img",{src:t.cover||o.defaultCover,class:"song-cover"},null,8,At),s("div",bt,[s("div",Ft,u(t.title),1),s("div",zt,[(c(!0),a(f,null,D(t.artists||[],(l,T)=>{var m;return c(),a(f,{key:l.id},[s("span",{class:"clickable",onClick:_(L=>o.goToArtist(l.id),["stop"])},u(l.name),9,xt),T<(((m=t.artists)==null?void 0:m.length)||0)-1?(c(),a("span",Vt," / ")):S("",!0)],64)}),128)),!t.artists||t.artists.length===0?(c(),a("span",Dt,"未知歌手")):S("",!0)])]),s("div",Mt,u(o.formatDuration(t.duration)),1),s("div",Rt,[i(r,{icon:"CaretRight",circle:"",size:"small",onClick:_(l=>o.handlePlaySong(t),["stop"]),title:"播放"},null,8,["onClick"]),i(r,{icon:"Plus",circle:"",size:"small",onClick:_(l=>o.handleAddToPlaylist(t),["stop"]),title:"添加到播放列表"},null,8,["onClick"]),i(r,{icon:"FolderAdd",circle:"",size:"small",onClick:_(l=>o.showAddToPlaylistDialog(t.id),["stop"]),title:"添加到歌单"},null,8,["onClick"]),i(r,{icon:o.favoriteSongs[t.id]?"StarFilled":"Star",circle:"",size:"small",type:o.favoriteSongs[t.id]?"danger":"",onClick:_(l=>o.handleToggleFavorite(t.id),["stop"]),title:"收藏"},null,8,["icon","type","onClick"])])],8,Pt))),128))]),o.newSongs.length===0?(c(),a("div",Ht,[i(z,{description:"暂无最新歌曲"})])):S("",!0)]),i(N,{modelValue:o.playlistSelectorVisible,"onUpdate:modelValue":n[3]||(n[3]=t=>o.playlistSelectorVisible=t),"song-id":o.selectedSongId,onSuccess:o.handleAddSuccess},null,8,["modelValue","song-id","onSuccess"])])}const Kt=U(ot,[["render",Nt],["__scopeId","data-v-3cbd026e"]]);export{Kt as default};
