import{_ as K,V as W,F as j,S as G,c as r,o as i,a as o,d as n,q as O,z as P,t as _,w as z,r as g,I as B,J as H,f as Q,g as v,h as X,k as N,l as Y,i as Z,W as $,E as f,u as tt,K as U,L as C}from"./index-LKNASSCX.js";import{u as et}from"./player-Bmv1q0yE.js";import{g as at,a as ot}from"./song-FYgzkVSR.js";import{t as nt,b as st}from"./favorite-BwbsQg-E.js";import{P as lt}from"./PlaylistSelector-DeJAY7A3.js";import"./request-BJQTzVY9.js";import"./PlaylistCover-BqxCqI1K.js";const it={name:"Rank",components:{Loading:G,Headset:j,Clock:W,PlaylistSelector:lt},setup(){const V=$(),l=tt(),F=et(),e=Q(),m=v("hot"),S=v(!1),u=v([]),A="https://via.placeholder.com/60?text=Music",y=v({}),c=X({page:1,size:50,total:0}),b=v(!1),T=v(null),p=N(()=>m.value==="hot"?"🔥 热门歌曲排行榜":"🎵 新歌速递排行榜"),L=N(()=>m.value==="hot"?"最受欢迎的热门歌曲":"最新发布的音乐作品"),h=async()=>{S.value=!0;try{const t={page:c.page-1,size:c.size},s=m.value==="hot"?await at(t):await ot(t);s.code===200&&(u.value=s.data.content||[],c.total=s.data.totalElements||0,await R())}catch(t){console.error("加载排行榜失败:",t),f.error("加载排行榜失败")}finally{S.value=!1}},R=async()=>{if(!(!e.isLogin||u.value.length===0))try{const t=u.value.map(M=>M.id),s=await st(t);s.code===200&&(y.value=s.data||{})}catch(t){console.error("加载收藏状态失败:",t)}},a=async t=>{if(!e.isLogin){f.warning("请先登录"),l.push("/login");return}try{const s=await nt(t);s.code===200&&(y.value[t]=s.data.isFavorite,f.success(s.data.isFavorite?"收藏成功":"取消收藏成功"))}catch{f.error("操作失败")}},k=()=>{c.page=1,h()},d=t=>{F.play(t,u.value)},D=t=>{F.addToPlaylist(t),f.success(`已添加到播放列表: ${t.title}`)},w=t=>{t&&l.push(`/artist/${t}`)},E=t=>{if(!e.isLogin){f.warning("请先登录"),l.push("/login");return}T.value=t,b.value=!0},q=()=>{},x=t=>t===0?"rank-first":t===1?"rank-second":t===2?"rank-third":"",I=t=>t?t>=1e4?(t/1e4).toFixed(1)+"万":t:0,J=t=>{if(!t)return"--:--";const s=Math.floor(t/60),M=t%60;return`${s}:${M.toString().padStart(2,"0")}`};return Y(()=>V.query.type,t=>{(t==="hot"||t==="new")&&(m.value=t,c.page=1,h())},{immediate:!0}),Z(()=>{V.query.type||h()}),{activeTab:m,loading:S,songs:u,defaultCover:A,favoriteSongs:y,pagination:c,pageTitle:p,pageSubtitle:L,playlistSelectorVisible:b,selectedSongId:T,handleTabChange:k,handlePlaySong:d,handleAddToPlaylist:D,handleToggleFavorite:a,goToArtist:w,showAddToPlaylistDialog:E,handleAddSuccess:q,getRankClass:x,formatCount:I,formatDuration:J,loadSongs:h}}},rt={class:"rank-page"},ct={class:"page-header"},dt={class:"subtitle"},gt={key:0,class:"loading-state"},ut={key:1,class:"song-list"},_t=["onClick"],mt=["src"],pt={class:"song-info"},ht={class:"song-name"},vt={class:"song-artist"},ft=["onClick"],yt={key:0},kt={key:0},Ct={class:"song-stats"},St={key:0,class:"stat-item"},bt={class:"stat-item"},Tt={class:"song-actions"},wt={key:2,class:"empty-state"};function Pt(V,l,F,e,m,S){const u=g("el-tab-pane"),A=g("el-tabs"),y=g("Loading"),c=g("el-icon"),b=g("Headset"),T=g("Clock"),p=g("el-button"),L=g("el-empty"),h=g("el-pagination"),R=g("PlaylistSelector");return i(),r("div",rt,[o("div",ct,[o("h2",null,"📊 "+_(e.pageTitle),1),o("p",dt,_(e.pageSubtitle),1)]),n(A,{modelValue:e.activeTab,"onUpdate:modelValue":l[0]||(l[0]=a=>e.activeTab=a),class:"rank-tabs",onTabChange:e.handleTabChange},{default:z(()=>[n(u,{label:"🔥 热门歌曲",name:"hot"}),n(u,{label:"🎵 新歌速递",name:"new"})]),_:1},8,["modelValue","onTabChange"]),e.loading?(i(),r("div",gt,[n(c,{class:"is-loading"},{default:z(()=>[n(y)]),_:1}),l[3]||(l[3]=o("p",null,"加载中...",-1))])):e.songs.length>0?(i(),r("div",ut,[(i(!0),r(B,null,H(e.songs,(a,k)=>(i(),r("div",{key:a.id,class:U(["song-item",{"top-item":k<3}]),onClick:d=>e.handlePlaySong(a)},[o("div",{class:U(["song-rank",e.getRankClass(k)])},_(k+1),3),o("img",{src:a.cover||e.defaultCover,class:"song-cover"},null,8,mt),o("div",pt,[o("div",ht,_(a.title),1),o("div",vt,[(i(!0),r(B,null,H(a.artists||[],(d,D)=>{var w;return i(),r(B,{key:d.id},[o("span",{class:"clickable",onClick:C(E=>e.goToArtist(d.id),["stop"])},_(d.name),9,ft),D<(((w=a.artists)==null?void 0:w.length)||0)-1?(i(),r("span",yt," / ")):P("",!0)],64)}),128)),!a.artists||a.artists.length===0?(i(),r("span",kt,"未知歌手")):P("",!0)])]),o("div",Ct,[e.activeTab==="hot"?(i(),r("div",St,[n(c,null,{default:z(()=>[n(b)]),_:1}),o("span",null,_(e.formatCount(a.playCount)),1)])):P("",!0),o("div",bt,[n(c,null,{default:z(()=>[n(T)]),_:1}),o("span",null,_(e.formatDuration(a.duration)),1)])]),o("div",Tt,[n(p,{icon:"CaretRight",circle:"",size:"small",onClick:C(d=>e.handlePlaySong(a),["stop"]),title:"播放"},null,8,["onClick"]),n(p,{icon:"Plus",circle:"",size:"small",onClick:C(d=>e.handleAddToPlaylist(a),["stop"]),title:"添加到播放列表"},null,8,["onClick"]),n(p,{icon:"FolderAdd",circle:"",size:"small",onClick:C(d=>e.showAddToPlaylistDialog(a.id),["stop"]),title:"添加到歌单"},null,8,["onClick"]),n(p,{icon:e.favoriteSongs[a.id]?"StarFilled":"Star",circle:"",size:"small",type:e.favoriteSongs[a.id]?"danger":"",onClick:C(d=>e.handleToggleFavorite(a.id),["stop"]),title:"收藏"},null,8,["icon","type","onClick"])])],10,_t))),128))])):(i(),r("div",wt,[n(L,{description:`暂无${e.activeTab==="hot"?"热门":"最新"}歌曲`},null,8,["description"])])),e.pagination.total>e.pagination.size?(i(),O(h,{key:3,"current-page":e.pagination.page,"onUpdate:currentPage":l[1]||(l[1]=a=>e.pagination.page=a),"page-size":e.pagination.size,total:e.pagination.total,layout:"prev, pager, next, total",class:"pagination",onCurrentChange:e.loadSongs},null,8,["current-page","page-size","total","onCurrentChange"])):P("",!0),n(R,{modelValue:e.playlistSelectorVisible,"onUpdate:modelValue":l[2]||(l[2]=a=>e.playlistSelectorVisible=a),"song-id":e.selectedSongId,onSuccess:e.handleAddSuccess},null,8,["modelValue","song-id","onSuccess"])])}const Mt=K(it,[["render",Pt],["__scopeId","data-v-a80b3b04"]]);export{Mt as default};
