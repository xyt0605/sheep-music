import{_ as ke,ao as we,g as r,x as z,i as Ce,c as o,o as n,a as d,d as t,w as l,r as i,u as Re,P as Fe,e as c,Q as _,ap as le,a2 as se,a3 as qe,O as ne,F as A,l as M,G as E,t as f,k as j,B as Ve,s as he,j as be,N as xe,a5 as Te,aq as Se,E as y,ar as $e,as as Be,at as Ne,au as Ue,av as De}from"./index-CU8TO-n3.js";const ze={class:"friends-page"},Ae={class:"page-header"},Me={class:"header-actions"},Ee={class:"friends-list"},je={key:0,class:"empty-state"},Ke={key:1,class:"friends-grid"},Le={class:"friend-info"},Ge=["onClick"],Ie={class:"friend-username"},Oe={class:"friend-actions"},Pe={class:"requests-list"},Qe={key:0,class:"empty-state"},He={key:1,class:"request-items"},Je={class:"request-info"},We={class:"request-name"},Xe={class:"request-time"},Ye={key:0,class:"request-remark"},Ze={class:"request-actions"},et={key:0,class:"search-results"},tt={class:"result-info"},at={class:"result-name"},lt={class:"result-username"},st={key:1,class:"empty-results"},nt={__name:"Friends",setup(ot){const b=Re(),v=we(),K=r("friends"),R=r(!1),F=r(!1),L=z(()=>v.friends),G=z(()=>v.friendRequests),I=z(()=>v.friendRequestCount),g=r(!1),k=r(""),q=r([]),V=r(!1),x=r(!1),T=r(null),w=r(!1),S=r(null),h=r(""),$=r(!1),p=r(null),oe=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",de=s=>{s==="friends"?O():s==="requests"&&P()},O=async()=>{R.value=!0,await v.loadFriends(),R.value=!1},P=async()=>{F.value=!0,await v.loadFriendRequests(),F.value=!1},B=async()=>{if(!k.value.trim()){y.warning("请输入搜索关键词");return}V.value=!0,x.value=!0;try{const s=await Ne(k.value.trim());s.code===200&&(q.value=s.data||[])}catch(s){console.error("搜索用户失败:",s)}finally{V.value=!1}},re=async s=>{T.value=s;try{(await Ue({friendId:s})).code===200&&(y.success("好友请求已发送"),g.value=!1,k.value="",q.value=[],x.value=!1)}catch(e){console.error("发送好友请求失败:",e)}finally{T.value=null}},ie=async s=>{p.value=s;try{(await $e(s)).code===200&&(y.success("已接受好友请求"),await v.loadFriendRequests(),await v.loadFriends())}catch(e){console.error("接受好友请求失败:",e)}finally{p.value=null}},ue=async s=>{p.value=s;try{(await Be(s)).code===200&&(y.success("已拒绝好友请求"),await v.loadFriendRequests())}catch(e){console.error("拒绝好友请求失败:",e)}finally{p.value=null}},ce=async({action:s,friendship:e})=>{if(s==="remark")S.value=e,h.value=e.remark||"",w.value=!0;else if(s==="delete")try{await Te.confirm("确定要删除该好友吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await Se(e.id)).code===200&&(y.success("已删除好友"),await v.loadFriends())}catch(u){u!=="cancel"&&console.error("删除好友失败:",u)}},me=async()=>{if(S.value){$.value=!0;try{(await De(S.value.id,h.value)).code===200&&(y.success("备注设置成功"),w.value=!1,await v.loadFriends())}catch(s){console.error("设置备注失败:",s)}finally{$.value=!1}}},N=s=>{b.push(`/chat/${s}`)},ve=()=>{b.push("/moments")},_e=()=>{b.push("/share-square")};return Ce(()=>{O(),P()}),(s,e)=>{const u=i("el-icon"),m=i("el-button"),U=i("el-empty"),D=i("el-avatar"),Q=i("el-dropdown-item"),fe=i("el-dropdown-menu"),pe=i("el-dropdown"),H=i("el-tab-pane"),ye=i("el-badge"),ge=i("el-tabs"),J=i("el-input"),W=i("el-form-item"),X=i("el-form"),Y=i("el-dialog"),Z=Fe("loading");return n(),o("div",ze,[d("div",Ae,[e[11]||(e[11]=d("h2",null,"我的好友",-1)),d("div",Me,[t(m,{text:"",onClick:ve},{default:l(()=>[t(u,null,{default:l(()=>[t(_(le))]),_:1}),e[8]||(e[8]=c(" 好友动态 ",-1))]),_:1}),t(m,{text:"",onClick:_e},{default:l(()=>[t(u,null,{default:l(()=>[t(_(se))]),_:1}),e[9]||(e[9]=c(" 分享广场 ",-1))]),_:1}),t(m,{type:"primary",onClick:e[0]||(e[0]=a=>g.value=!0)},{default:l(()=>[t(u,null,{default:l(()=>[t(_(qe))]),_:1}),e[10]||(e[10]=c(" 添加好友 ",-1))]),_:1})])]),t(ge,{modelValue:K.value,"onUpdate:modelValue":e[1]||(e[1]=a=>K.value=a),onTabChange:de},{default:l(()=>[t(H,{label:"好友列表",name:"friends"},{default:l(()=>[ne((n(),o("div",Ee,[L.value.length===0&&!R.value?(n(),o("div",je,[t(U,{description:"暂无好友，快去添加好友吧~"})])):(n(),o("div",Ke,[(n(!0),o(A,null,M(L.value,a=>{var C,ee,te;return n(),o("div",{key:a.id,class:"friend-card"},[t(D,{src:a.friendAvatar||((C=a.friend)==null?void 0:C.avatar),size:60,onClick:ae=>N(a.friendId)},{default:l(()=>[t(u,null,{default:l(()=>[t(_(E))]),_:1})]),_:1},8,["src","onClick"]),d("div",Le,[d("div",{class:"friend-name",onClick:ae=>N(a.friendId)},f(a.remark||a.friendName||((ee=a.friend)==null?void 0:ee.nickname)),9,Ge),d("div",Ie," @"+f((te=a.friend)==null?void 0:te.username),1)]),d("div",Oe,[t(m,{text:"",type:"primary",onClick:ae=>N(a.friendId)},{default:l(()=>[t(u,null,{default:l(()=>[t(_(le))]),_:1}),e[12]||(e[12]=c(" 聊天 ",-1))]),_:1},8,["onClick"]),t(pe,{onCommand:ce},{dropdown:l(()=>[t(fe,null,{default:l(()=>[t(Q,{command:{action:"remark",friendship:a}},{default:l(()=>[...e[13]||(e[13]=[c(" 设置备注 ",-1)])]),_:1},8,["command"]),t(Q,{command:{action:"delete",friendship:a},divided:""},{default:l(()=>[...e[14]||(e[14]=[c(" 删除好友 ",-1)])]),_:1},8,["command"])]),_:2},1024)]),default:l(()=>[t(m,{text:""},{default:l(()=>[t(u,null,{default:l(()=>[t(_(se))]),_:1})]),_:1})]),_:2},1024)])])}),128))]))])),[[Z,R.value]])]),_:1}),t(H,{name:"requests"},{label:l(()=>[d("span",null,[e[15]||(e[15]=c(" 好友请求 ",-1)),I.value>0?(n(),Ve(ye,{key:0,value:I.value,type:"danger",class:"tab-badge"},null,8,["value"])):j("",!0)])]),default:l(()=>[ne((n(),o("div",Pe,[G.value.length===0&&!F.value?(n(),o("div",Qe,[t(U,{description:"暂无好友请求"})])):(n(),o("div",He,[(n(!0),o(A,null,M(G.value,a=>(n(),o("div",{key:a.id,class:"request-item"},[t(D,{src:a.userAvatar,size:50},{default:l(()=>[t(u,null,{default:l(()=>[t(_(E))]),_:1})]),_:1},8,["src"]),d("div",Je,[d("div",We,f(a.userName),1),d("div",Xe,f(oe(a.createTime)),1),a.remark?(n(),o("div",Ye," 备注："+f(a.remark),1)):j("",!0)]),d("div",Ze,[t(m,{type:"primary",onClick:C=>ie(a.id),loading:p.value===a.id},{default:l(()=>[...e[16]||(e[16]=[c(" 接受 ",-1)])]),_:1},8,["onClick","loading"]),t(m,{onClick:C=>ue(a.id),loading:p.value===a.id},{default:l(()=>[...e[17]||(e[17]=[c(" 拒绝 ",-1)])]),_:1},8,["onClick","loading"])])]))),128))]))])),[[Z,F.value]])]),_:1})]),_:1},8,["modelValue"]),t(Y,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=a=>g.value=a),title:"添加好友",width:"500px"},{footer:l(()=>[t(m,{onClick:e[3]||(e[3]=a=>g.value=!1)},{default:l(()=>[...e[19]||(e[19]=[c("取消",-1)])]),_:1})]),default:l(()=>[t(X,{onSubmit:he(B,["prevent"])},{default:l(()=>[t(W,{label:"搜索用户"},{default:l(()=>[t(J,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=a=>k.value=a),placeholder:"输入用户名或昵称",onKeyup:be(B,["enter"])},{append:l(()=>[t(m,{onClick:B,loading:V.value},{default:l(()=>[t(u,null,{default:l(()=>[t(_(xe))]),_:1})]),_:1},8,["loading"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),q.value.length>0?(n(),o("div",et,[(n(!0),o(A,null,M(q.value,a=>(n(),o("div",{key:a.id,class:"search-result-item"},[t(D,{src:a.avatar,size:40},{default:l(()=>[t(u,null,{default:l(()=>[t(_(E))]),_:1})]),_:1},8,["src"]),d("div",tt,[d("div",at,f(a.nickname||a.username),1),d("div",lt,"@"+f(a.username),1)]),t(m,{type:"primary",size:"small",onClick:C=>re(a.id),loading:T.value===a.id},{default:l(()=>[...e[18]||(e[18]=[c(" 添加好友 ",-1)])]),_:1},8,["onClick","loading"])]))),128))])):x.value&&!V.value?(n(),o("div",st,[t(U,{description:"未找到相关用户"})])):j("",!0)]),_:1},8,["modelValue"]),t(Y,{modelValue:w.value,"onUpdate:modelValue":e[7]||(e[7]=a=>w.value=a),title:"设置备注",width:"400px"},{footer:l(()=>[t(m,{onClick:e[6]||(e[6]=a=>w.value=!1)},{default:l(()=>[...e[20]||(e[20]=[c("取消",-1)])]),_:1}),t(m,{type:"primary",onClick:me,loading:$.value},{default:l(()=>[...e[21]||(e[21]=[c(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(X,null,{default:l(()=>[t(W,{label:"备注名"},{default:l(()=>[t(J,{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=a=>h.value=a),placeholder:"输入备注名",maxlength:"20"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},rt=ke(nt,[["__scopeId","data-v-c864ea4c"]]);export{rt as default};
