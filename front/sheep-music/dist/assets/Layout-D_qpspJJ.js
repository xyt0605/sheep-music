import{_ as j,g as P,k as T,l as K,i as W,m as Q,v as X,n as t,o as c,c as m,a as s,d as o,t as _,w as l,r as p,T as G,p as Y,q as b,s as Z,x as ee,y as te,z as v,A as oe,B as se,C as ne,D as le,F as ae,G as ie,H as re,I as H,J as R,K as q,L as J,e as C,M as ce,f as de,N as ue,E as O,u as me}from"./index-CW4zacqa.js";import{u as _e}from"./player-Wf9-YgSo.js";import"./song-BNVGoA-Q.js";import"./request-CreD-zv2.js";const pe={class:"music-player"},fe={class:"player-main"},ye={class:"player-left"},ve=["src"],ge={class:"song-info"},he={class:"song-name"},ke={class:"song-artist"},Me={class:"player-center"},Ce={class:"player-controls"},be={class:"player-progress"},we={class:"time-text"},Se={class:"time-text"},xe={class:"player-right"},Ve={class:"volume-control"},Ie={key:0,class:"lyric-panel"},Le={class:"lyric-header"},Pe={key:0,class:"no-lyric"},Te={class:"playlist-content"},ze=["onClick"],Ne={class:"playlist-item-info"},Be={class:"playlist-item-name"},Ae={class:"playlist-item-artist"},Ee={key:0,class:"empty-playlist"},He="https://via.placeholder.com/60?text=Music",Re={__name:"MusicPlayer",setup(S){const e=_e(),h=P(null),r=P(null),x=P(!1),z=T({get:()=>e.duration>0?e.currentTime/e.duration*100:0,set:a=>{const n=a/100*e.duration;e.seek(n)}}),w=P(e.volume*100),k=a=>{const n=a/100*e.duration;e.seek(n)},V=a=>{e.setVolume(a/100)},N=a=>{if(!a||isNaN(a))return"00:00";const n=Math.floor(a/60),u=Math.floor(a%60);return`${n.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`},B=a=>a?a.artists&&a.artists.length>0?a.artists.map(n=>n.name).join(" / "):a.artistName?a.artistName:"未知歌手":"未知歌手",$=T(()=>({list:"列表循环",random:"随机播放",single:"单曲循环"})[e.playMode]||"列表循环"),I=T(()=>{var f;const a=(f=e.currentSong)==null?void 0:f.lyric;if(!a)return[];const n=a.split(`
`),u=[];return n.forEach(g=>{const y=g.match(/\[(\d{2}):(\d{2})\.?(\d{2,3})?\](.*)/);if(y){const D=parseInt(y[1]),A=parseInt(y[2]),E=y[3]?parseInt(y[3].padEnd(3,"0")):0,d=D*60+A+E/1e3,M=y[4].trim();M&&u.push({time:d,text:M})}else g.trim()&&!g.startsWith("[")&&u.push({time:0,text:g.trim()})}),u.sort((g,y)=>g.time-y.time)}),i=T(()=>{const a=e.currentTime;for(let n=I.value.length-1;n>=0;n--)if(a>=I.value[n].time)return n;return-1});K(i,async a=>{if(a>=0&&r.value){await ce();const n=r.value.querySelector(".lyric-line.active");n&&n.scrollIntoView({behavior:"smooth",block:"center"})}});const L=()=>{e.toggleLyric()};return W(()=>{h.value&&e.initAudio(h.value)}),(a,n)=>{var A,E;const u=p("el-icon"),f=p("el-button"),g=p("el-slider"),y=p("el-tooltip"),D=p("el-dialog");return Q((c(),m("div",pe,[s("audio",{ref_key:"audioRef",ref:h},null,512),s("div",fe,[s("div",ye,[s("img",{src:((A=t(e).currentSong)==null?void 0:A.cover)||He,alt:"封面",class:"song-cover",onClick:L},null,8,ve),s("div",ge,[s("div",he,_(((E=t(e).currentSong)==null?void 0:E.title)||"暂无播放"),1),s("div",ke,_(B(t(e).currentSong)),1)])]),s("div",Me,[s("div",Ce,[o(f,{circle:"",size:"small",disabled:!t(e).hasPrevSong,onClick:t(e).prev},{default:l(()=>[o(u,null,{default:l(()=>[o(t(Y))]),_:1})]),_:1},8,["disabled","onClick"]),o(f,{circle:"",type:"primary",size:"large",onClick:t(e).togglePlay,disabled:!t(e).currentSong},{default:l(()=>[t(e).isPlaying?(c(),b(u,{key:0},{default:l(()=>[o(t(Z))]),_:1})):(c(),b(u,{key:1},{default:l(()=>[o(t(ee))]),_:1}))]),_:1},8,["onClick","disabled"]),o(f,{circle:"",size:"small",disabled:!t(e).hasNextSong,onClick:t(e).next},{default:l(()=>[o(u,null,{default:l(()=>[o(t(te))]),_:1})]),_:1},8,["disabled","onClick"])]),s("div",be,[s("span",we,_(N(t(e).currentTime)),1),o(g,{modelValue:z.value,"onUpdate:modelValue":n[0]||(n[0]=d=>z.value=d),"show-tooltip":!1,onChange:k,class:"progress-slider"},null,8,["modelValue"]),s("span",Se,_(N(t(e).duration)),1)])]),s("div",xe,[o(y,{content:$.value,placement:"top"},{default:l(()=>[o(f,{circle:"",size:"small",onClick:t(e).togglePlayMode},{default:l(()=>[o(u,null,{default:l(()=>[t(e).playMode==="list"?(c(),b(t(oe),{key:0})):v("",!0),t(e).playMode==="random"?(c(),b(t(se),{key:1})):v("",!0),t(e).playMode==="single"?(c(),b(t(ne),{key:2})):v("",!0)]),_:1})]),_:1},8,["onClick"])]),_:1},8,["content"]),o(f,{circle:"",size:"small",type:t(e).showLyric?"primary":"",onClick:L},{default:l(()=>[o(u,null,{default:l(()=>[o(t(le))]),_:1})]),_:1},8,["type"]),s("div",Ve,[o(u,null,{default:l(()=>[o(t(ae))]),_:1}),o(g,{modelValue:w.value,"onUpdate:modelValue":n[1]||(n[1]=d=>w.value=d),"show-tooltip":!1,onInput:V,style:{width:"100px","margin-left":"10px"}},null,8,["modelValue"])]),o(f,{circle:"",size:"small",onClick:n[2]||(n[2]=d=>x.value=!0)},{default:l(()=>[o(u,null,{default:l(()=>[o(t(ie))]),_:1})]),_:1})])]),o(G,{name:"lyric-slide"},{default:l(()=>{var d,M;return[t(e).showLyric?(c(),m("div",Ie,[s("div",Le,[s("h3",null,_((d=t(e).currentSong)==null?void 0:d.title),1),o(f,{circle:"",size:"small",onClick:t(e).toggleLyric},{default:l(()=>[o(u,null,{default:l(()=>[o(t(re))]),_:1})]),_:1},8,["onClick"])]),s("div",{class:"lyric-content",ref_key:"lyricContentRef",ref:r},[(c(!0),m(H,null,R(I.value,(U,F)=>(c(),m("div",{key:F,class:q(["lyric-line",{active:F===i.value}])},_(U.text),3))),128)),(M=t(e).currentSong)!=null&&M.lyric?v("",!0):(c(),m("div",Pe," 暂无歌词 "))],512)])):v("",!0)]}),_:1}),o(D,{modelValue:x.value,"onUpdate:modelValue":n[3]||(n[3]=d=>x.value=d),title:"播放列表",width:"500px"},{default:l(()=>[s("div",Te,[(c(!0),m(H,null,R(t(e).playlist,(d,M)=>(c(),m("div",{key:d.id,class:q(["playlist-item",{active:M===t(e).currentIndex}]),onClick:U=>t(e).play(d)},[s("div",Ne,[s("span",Be,_(d.title),1),s("span",Ae,_(B(d)),1)]),o(f,{link:"",type:"danger",size:"small",onClick:J(U=>t(e).removeFromPlaylist(d.id),["stop"])},{default:l(()=>[...n[4]||(n[4]=[C(" 删除 ",-1)])]),_:1},8,["onClick"])],10,ze))),128)),t(e).playlist.length===0?(c(),m("div",Ee," 播放列表为空 ")):v("",!0)])]),_:1},8,["modelValue"])],512)),[[X,t(e).showPlayer]])}}},$e=j(Re,[["__scopeId","data-v-7c8a8b5e"]]),De={name:"Layout",components:{MusicPlayer:$e},setup(){const S=me(),e=de(),h=P(!1),r=T(()=>{const k=[{name:"首页",path:"/home",icon:"🏠"},{name:"发现",path:"/discover",icon:"✨"},{name:"搜索",path:"/search",icon:"🔍"},{name:"歌单广场",path:"/playlist",icon:"📃"},{name:"排行榜",path:"/rank",icon:"📊"},{name:"我的音乐",path:"/my-music"}];return e.isAdmin&&k.push({name:"管理后台",path:"/admin",icon:"🔧"}),k});return{userStore:e,menuItems:r,mobileMenuOpen:h,toggleMobileMenu:()=>{h.value=!h.value},goHome:()=>{S.push("/home")},handleCommand:async k=>{switch(k){case"profile":S.push("/profile");break;case"settings":O.info("设置功能待开发");break;case"logout":ue.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{e.logout(),O.success("已退出登录"),S.push("/login")}).catch(()=>{});break}}}}},Ue={class:"app-layout"},Fe={class:"app-header"},qe={class:"header-content"},Oe={class:"nav-menu desktop-menu"},je={key:0,class:"menu-icon"},Ge={class:"user-section"},Je={class:"user-info"},Ke={class:"username"},We={key:0,class:"admin-badge"},Qe={class:"mobile-menu-header"},Xe={key:0,class:"menu-icon"},Ye={class:"app-main"};function Ze(S,e,h,r,x,z){const w=p("router-link"),k=p("el-avatar"),V=p("el-dropdown-item"),N=p("el-dropdown-menu"),B=p("el-dropdown"),$=p("router-view"),I=p("MusicPlayer");return c(),m("div",Ue,[s("header",Fe,[s("div",qe,[s("div",{class:"logo",onClick:e[0]||(e[0]=(...i)=>r.goHome&&r.goHome(...i))},[...e[5]||(e[5]=[s("span",{class:"logo-icon"},"🎵",-1),s("span",{class:"logo-text"},"Sheep Music",-1)])]),s("nav",Oe,[(c(!0),m(H,null,R(r.menuItems,i=>(c(),b(w,{key:i.path,to:i.path,class:"nav-item","active-class":"active"},{default:l(()=>[i.icon?(c(),m("span",je,_(i.icon),1)):v("",!0),C(" "+_(i.name),1)]),_:2},1032,["to"]))),128))]),s("div",{class:"mobile-menu-btn",onClick:e[1]||(e[1]=(...i)=>r.toggleMobileMenu&&r.toggleMobileMenu(...i))},[...e[6]||(e[6]=[s("span",{class:"menu-icon"},"☰",-1)])]),s("div",Ge,[o(B,{onCommand:r.handleCommand},{dropdown:l(()=>[o(N,null,{default:l(()=>[o(V,{command:"profile"},{default:l(()=>[...e[7]||(e[7]=[C("个人中心",-1)])]),_:1}),o(V,{command:"settings"},{default:l(()=>[...e[8]||(e[8]=[C("设置",-1)])]),_:1}),o(V,{divided:"",command:"logout"},{default:l(()=>[...e[9]||(e[9]=[C("退出登录",-1)])]),_:1})]),_:1})]),default:l(()=>{var i,L;return[s("div",Je,[o(k,{src:(i=r.userStore.userInfo)==null?void 0:i.avatar,size:"default"},{default:l(()=>{var a,n;return[C(_((n=(a=r.userStore.userInfo)==null?void 0:a.nickname)==null?void 0:n.charAt(0)),1)]}),_:1},8,["src"]),s("span",Ke,_((L=r.userStore.userInfo)==null?void 0:L.nickname),1),r.userStore.isAdmin?(c(),m("span",We,"管理员")):v("",!0)])]}),_:1},8,["onCommand"])])])]),o(G,{name:"slide"},{default:l(()=>[r.mobileMenuOpen?(c(),m("div",{key:0,class:"mobile-menu-overlay",onClick:e[4]||(e[4]=(...i)=>r.toggleMobileMenu&&r.toggleMobileMenu(...i))},[s("nav",{class:"mobile-menu",onClick:e[3]||(e[3]=J(()=>{},["stop"]))},[s("div",Qe,[e[10]||(e[10]=s("span",{class:"menu-title"},"菜单",-1)),s("span",{class:"close-btn",onClick:e[2]||(e[2]=(...i)=>r.toggleMobileMenu&&r.toggleMobileMenu(...i))},"✕")]),(c(!0),m(H,null,R(r.menuItems,i=>(c(),b(w,{key:i.path,to:i.path,class:"mobile-nav-item","active-class":"active",onClick:r.toggleMobileMenu},{default:l(()=>[i.icon?(c(),m("span",Xe,_(i.icon),1)):v("",!0),C(" "+_(i.name),1)]),_:2},1032,["to","onClick"]))),128))])])):v("",!0)]),_:1}),s("main",Ye,[o($)]),o(I)])}const nt=j(De,[["render",Ze],["__scopeId","data-v-1a8517b8"]]);export{nt as default};
